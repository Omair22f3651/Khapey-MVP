Raw response for image_id d0bb4be4-a31b-4c56-abe0-44760a193cf4:
```json
[
  {
    "image_id": "d0bb4be4-a31b-4c56-abe0-44760a193cf4",
    "scene": "dish_closeup",
    "visual": {
      "description": "A plate with a large puffy bread, likely a puri, placed on top of something. On the side, there are two portions of food, one appears to be a minced meat curry and the other is a bright orange item, possibly a sweet vegetable or fruit.",
      "confidence": 0.85,
      "quality": 0.4,
      "appeal_score": 0.3
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.9
      },
      {
        "name": "minced meat curry",
        "confidence": 0.7
      },
      {
        "name": "sweet vegetable",
        "confidence": 0.6
      }
    ],
    "flag_type": "low_appeal",
    "penalty_score": 20,
    "keywords": [
      "puri",
      "curry",
      "sweet",
      "fried"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
Cleaned response for image_id d0bb4be4-a31b-4c56-abe0-44760a193cf4:
[
  {
    "image_id": "d0bb4be4-a31b-4c56-abe0-44760a193cf4",
    "scene": "dish_closeup",
    "visual": {
      "description": "A plate with a large puffy bread, likely a puri, placed on top of something. On the side, there are two portions of food, one appears to be a minced meat curry and the other is a bright orange item, possibly a sweet vegetable or fruit.",
      "confidence": 0.85,
      "quality": 0.4,
      "appeal_score": 0.3
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.9
      },
      {
        "name": "minced meat curry",
        "confidence": 0.7
      },
      {
        "name": "sweet vegetable",
        "confidence": 0.6
      }
    ],
    "flag_type": "low_appeal",
    "penalty_score": 20,
    "keywords": [
      "puri",
      "curry",
      "sweet",
      "fried"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
==================================================
Raw response for image_id bc479117-81f1-4c32-b29d-ec4887e0f69e:
```json
[
  {
    "image_id": "bc479117-81f1-4c32-b29d-ec4887e0f69e",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish served on a white plate. The dish features a puffy fried bread, possibly puri, placed on top of a portion of meat and vegetable curry. There are also some pieces of cooked carrots or sweet potatoes on the side. The lighting is warm and the food appears to be freshly prepared.",
      "confidence": 0.85,
      "quality": 0.70,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "Puri",
        "confidence": 0.90
      },
      {
        "name": "Keema Curry",
        "confidence": 0.75
      },
      {
        "name": "Carrot Sabzi",
        "confidence": 0.65
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "puri",
      "keema",
      "curry",
      "sabzi",
      "fried bread",
      "traditional"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
Cleaned response for image_id bc479117-81f1-4c32-b29d-ec4887e0f69e:
[
  {
    "image_id": "bc479117-81f1-4c32-b29d-ec4887e0f69e",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish served on a white plate. The dish features a puffy fried bread, possibly puri, placed on top of a portion of meat and vegetable curry. There are also some pieces of cooked carrots or sweet potatoes on the side. The lighting is warm and the food appears to be freshly prepared.",
      "confidence": 0.85,
      "quality": 0.70,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "Puri",
        "confidence": 0.90
      },
      {
        "name": "Keema Curry",
        "confidence": 0.75
      },
      {
        "name": "Carrot Sabzi",
        "confidence": 0.65
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "puri",
      "keema",
      "curry",
      "sabzi",
      "fried bread",
      "traditional"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
==================================================
Raw response for image_id 91e4319f-ea37-4cfa-b68f-fc480b826ddd:
```json
[
  {
    "image_id": "91e4319f-ea37-4cfa-b68f-fc480b826ddd",
    "scene": "dish_closeup",
    "visual": {
      "description": "A plate of food featuring a large, puffy flatbread served alongside what appears to be a minced meat dish and some pieces of cooked fruit or vegetables.",
      "confidence": 0.85,
      "quality": 0.3,
      "appeal_score": 0.4
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "Puri",
        "confidence": 0.9
      },
      {
        "name": "Keema",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "keema",
      "pakistani food",
      "flatbread",
      "minced meat"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
Cleaned response for image_id 91e4319f-ea37-4cfa-b68f-fc480b826ddd:
[
  {
    "image_id": "91e4319f-ea37-4cfa-b68f-fc480b826ddd",
    "scene": "dish_closeup",
    "visual": {
      "description": "A plate of food featuring a large, puffy flatbread served alongside what appears to be a minced meat dish and some pieces of cooked fruit or vegetables.",
      "confidence": 0.85,
      "quality": 0.3,
      "appeal_score": 0.4
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "Puri",
        "confidence": 0.9
      },
      {
        "name": "Keema",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "keema",
      "pakistani food",
      "flatbread",
      "minced meat"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
==================================================
Raw response for image_id d791553d-4850-4d63-8c53-1307c527e3ce:
```json
[
  {
    "image_id": "d791553d-4850-4d63-8c53-1307c527e3ce",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish featuring a golden-brown, puffed bread (puri) placed on top of what appears to be a serving of meat and vegetable curry. There are also slices of orange-colored fruit or vegetable on the side. The lighting is warm and somewhat dim, and the focus is on the food.",
      "confidence": 0.9,
      "quality": 0.6,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.95
      },
      {
        "name": "meat curry",
        "confidence": 0.7
      },
      {
        "name": "vegetable curry",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "pakistani food",
      "curry",
      "indian subcontinent",
      "breakfast",
      "snack"
    ],
    "ambience_features": [
      "warm lighting"
    ],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
Cleaned response for image_id d791553d-4850-4d63-8c53-1307c527e3ce:
[
  {
    "image_id": "d791553d-4850-4d63-8c53-1307c527e3ce",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish featuring a golden-brown, puffed bread (puri) placed on top of what appears to be a serving of meat and vegetable curry. There are also slices of orange-colored fruit or vegetable on the side. The lighting is warm and somewhat dim, and the focus is on the food.",
      "confidence": 0.9,
      "quality": 0.6,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.95
      },
      {
        "name": "meat curry",
        "confidence": 0.7
      },
      {
        "name": "vegetable curry",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "pakistani food",
      "curry",
      "indian subcontinent",
      "breakfast",
      "snack"
    ],
    "ambience_features": [
      "warm lighting"
    ],
    "thumbnail_rank": 0.8
  }
]
==================================================
Raw response for image_id 81917591-052a-4ccb-b42e-bf0106efbb6a:
```json
[
  {
    "image_id": "81917591-052a-4ccb-b42e-bf0106efbb6a",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a plate with what appears to be a large fried puri or bhatura, served with a side of what could be kheema (minced meat) and some apricot curry or sabzi.",
      "confidence": 0.85,
      "quality": 0.6,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.9
      },
      {
        "name": "kheema",
        "confidence": 0.75
      },
      {
        "name": "sabzi",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "kheema",
      "sabzi",
      "pakistani food",
      "fried bread",
      "minced meat",
      "curry"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
Cleaned response for image_id 81917591-052a-4ccb-b42e-bf0106efbb6a:
[
  {
    "image_id": "81917591-052a-4ccb-b42e-bf0106efbb6a",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a plate with what appears to be a large fried puri or bhatura, served with a side of what could be kheema (minced meat) and some apricot curry or sabzi.",
      "confidence": 0.85,
      "quality": 0.6,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.9
      },
      {
        "name": "kheema",
        "confidence": 0.75
      },
      {
        "name": "sabzi",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "kheema",
      "sabzi",
      "pakistani food",
      "fried bread",
      "minced meat",
      "curry"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
==================================================
Raw response for image_id f4679049-d645-4041-b354-65356b628bb4:
```json
[
  {
    "image_id": "f4679049-d645-4041-b354-65356b628bb4",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a large, juicy cheeseburger wrapped in foil. The burger is stacked with two beef patties, melted cheese, and a sprinkle of lettuce, all on a sesame seed bun. The cheese appears to be a vibrant orange cheddar. The background is blurred, showing what looks like a casual dining environment with other people and food items.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "cheeseburger",
        "confidence": 0.98
      },
      {
        "name": "burger",
        "confidence": 0.99
      },
      {
        "name": "fries",
        "confidence": 0.30
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "cheeseburger",
      "beef patty",
      "melted cheese",
      "sesame bun",
      "fast food",
      "street food"
    ],
    "ambience_features": [
      "casual dining",
      "food court"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
Cleaned response for image_id f4679049-d645-4041-b354-65356b628bb4:
[
  {
    "image_id": "f4679049-d645-4041-b354-65356b628bb4",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a large, juicy cheeseburger wrapped in foil. The burger is stacked with two beef patties, melted cheese, and a sprinkle of lettuce, all on a sesame seed bun. The cheese appears to be a vibrant orange cheddar. The background is blurred, showing what looks like a casual dining environment with other people and food items.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "cheeseburger",
        "confidence": 0.98
      },
      {
        "name": "burger",
        "confidence": 0.99
      },
      {
        "name": "fries",
        "confidence": 0.30
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "cheeseburger",
      "beef patty",
      "melted cheese",
      "sesame bun",
      "fast food",
      "street food"
    ],
    "ambience_features": [
      "casual dining",
      "food court"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
Raw response for image_id 900f24c4-83e6-4e22-9a8a-9b984e9ffd1f:
[
  {
    "image_id": "900f24c4-83e6-4e22-9a8a-9b984e9ffd1f",
    "scene": "ambiance",
    "visual": {
      "description": "A behind-the-scenes look at a Pakistani restaurant kitchen, with chefs in white uniforms preparing food. Shelves filled with round, wooden containers are visible, suggesting they might be used for steaming or serving.",
      "confidence": 0.95,
      "quality": 0.85,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {"name": "chef", "confidence": 0.99},
      {"name": "tomatoes", "confidence": 0.75},
      {"name": "kitchen", "confidence": 0.98}
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": ["kitchen", "chefs", "pakistani food", "restaurant", "preparation", "steaming", "wooden containers", "tomatoes", "behind the scenes"],
    "ambience_features": ["warm lighting", "clean kitchen", "organized shelves"],
    "thumbnail_rank": 1.0
  }
]
==================================================
Cleaned response for image_id 900f24c4-83e6-4e22-9a8a-9b984e9ffd1f:
[
  {
    "image_id": "900f24c4-83e6-4e22-9a8a-9b984e9ffd1f",
    "scene": "ambiance",
    "visual": {
      "description": "A behind-the-scenes look at a Pakistani restaurant kitchen, with chefs in white uniforms preparing food. Shelves filled with round, wooden containers are visible, suggesting they might be used for steaming or serving.",
      "confidence": 0.95,
      "quality": 0.85,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {"name": "chef", "confidence": 0.99},
      {"name": "tomatoes", "confidence": 0.75},
      {"name": "kitchen", "confidence": 0.98}
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": ["kitchen", "chefs", "pakistani food", "restaurant", "preparation", "steaming", "wooden containers", "tomatoes", "behind the scenes"],
    "ambience_features": ["warm lighting", "clean kitchen", "organized shelves"],
    "thumbnail_rank": 1.0
  }
]
==================================================
Raw response for image_id 18f791cd-1428-4a53-bca6-b5f073cd1587:
```json
[
  {
    "image_id": "18f791cd-1428-4a53-bca6-b5f073cd1587",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a rich, spicy curry dish, likely chicken karahi, served in a stainless steel bowl. The curry is a deep reddish-orange color, with visible pieces of tender chicken. It is garnished with fresh green chilies and chopped cilantro. A portion of naan bread is visible in the lower right corner.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.92
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "chicken karahi",
        "confidence": 0.90
      },
      {
        "name": "naan",
        "confidence": 0.75
      },
      {
        "name": "cilantro",
        "confidence": 0.85
      },
      {
        "name": "green chili",
        "confidence": 0.80
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "chicken",
      "spicy",
      "traditional",
      "pakistani food",
      "main course"
    ],
    "ambience_features": [
      "close-up",
      "appetizing"
    ],
    "thumbnail_rank": 0.85
  }
]
```
==================================================
Cleaned response for image_id 18f791cd-1428-4a53-bca6-b5f073cd1587:
[
  {
    "image_id": "18f791cd-1428-4a53-bca6-b5f073cd1587",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a rich, spicy curry dish, likely chicken karahi, served in a stainless steel bowl. The curry is a deep reddish-orange color, with visible pieces of tender chicken. It is garnished with fresh green chilies and chopped cilantro. A portion of naan bread is visible in the lower right corner.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.92
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "chicken karahi",
        "confidence": 0.90
      },
      {
        "name": "naan",
        "confidence": 0.75
      },
      {
        "name": "cilantro",
        "confidence": 0.85
      },
      {
        "name": "green chili",
        "confidence": 0.80
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "chicken",
      "spicy",
      "traditional",
      "pakistani food",
      "main course"
    ],
    "ambience_features": [
      "close-up",
      "appetizing"
    ],
    "thumbnail_rank": 0.85
  }
]
==================================================
Raw response for image_id 6080c71b-4b80-4dd5-99d1-b74b154821a8:
```json
[
  {
    "image_id": "6080c71b-4b80-4dd5-99d1-b74b154821a8",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a traditional Pakistani dish, likely chicken karahi, served in a metal bowl. The dish features tender pieces of chicken coated in a rich, spiced tomato-based gravy. Sliced green chilies and fresh cilantro are used as garnishes, adding a vibrant touch. A piece of naan bread is visible in the lower right corner.",
      "confidence": 0.95,
      "quality": 0.92,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "chicken karahi",
        "confidence": 0.90
      },
      {
        "name": "naan",
        "confidence": 0.75
      },
      {
        "name": "cilantro",
        "confidence": 0.88
      },
      {
        "name": "green chilies",
        "confidence": 0.80
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "chicken",
      "karahi",
      "spicy",
      "tomato gravy",
      "cilantro",
      "naan",
      "traditional"
    ],
    "ambience_features": [],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
Cleaned response for image_id 6080c71b-4b80-4dd5-99d1-b74b154821a8:
[
  {
    "image_id": "6080c71b-4b80-4dd5-99d1-b74b154821a8",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a traditional Pakistani dish, likely chicken karahi, served in a metal bowl. The dish features tender pieces of chicken coated in a rich, spiced tomato-based gravy. Sliced green chilies and fresh cilantro are used as garnishes, adding a vibrant touch. A piece of naan bread is visible in the lower right corner.",
      "confidence": 0.95,
      "quality": 0.92,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "chicken karahi",
        "confidence": 0.90
      },
      {
        "name": "naan",
        "confidence": 0.75
      },
      {
        "name": "cilantro",
        "confidence": 0.88
      },
      {
        "name": "green chilies",
        "confidence": 0.80
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "chicken",
      "karahi",
      "spicy",
      "tomato gravy",
      "cilantro",
      "naan",
      "traditional"
    ],
    "ambience_features": [],
    "thumbnail_rank": 1.0
  }
]
==================================================
Raw response for image_id 0de788f5-4f50-49f6-abea-02565894a300:
```json
[
  {
    "image_id": "0de788f5-4f50-49f6-abea-02565894a300",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a large, messy cheeseburger wrapped in foil. The burger has two patties, melted cheese, and appears to be topped with some kind of sauce and possibly chopped onions. The sesame seed bun is slightly golden. The burger is held in a hand, and another hand holding a similar burger is visible in the background.",
      "confidence": 0.9,
      "quality": 0.8,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "cheeseburger",
        "confidence": 0.95
      },
      {
        "name": "burger",
        "confidence": 0.98
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "cheeseburger",
      "fast food",
      "sandwich",
      "patties",
      "cheese",
      "messy",
      "foil"
    ],
    "ambience_features": [
      "indoor seating",
      "casual dining"
    ],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
Cleaned response for image_id 0de788f5-4f50-49f6-abea-02565894a300:
[
  {
    "image_id": "0de788f5-4f50-49f6-abea-02565894a300",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a large, messy cheeseburger wrapped in foil. The burger has two patties, melted cheese, and appears to be topped with some kind of sauce and possibly chopped onions. The sesame seed bun is slightly golden. The burger is held in a hand, and another hand holding a similar burger is visible in the background.",
      "confidence": 0.9,
      "quality": 0.8,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "cheeseburger",
        "confidence": 0.95
      },
      {
        "name": "burger",
        "confidence": 0.98
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "cheeseburger",
      "fast food",
      "sandwich",
      "patties",
      "cheese",
      "messy",
      "foil"
    ],
    "ambience_features": [
      "indoor seating",
      "casual dining"
    ],
    "thumbnail_rank": 0.8
  }
]
==================================================
Raw response for image_id 6fa1cf3d-8cfb-4d2a-8134-21cdb4666e6a:
```json
[
  {
    "image_id": "6fa1cf3d-8cfb-4d2a-8134-21cdb4666e6a",
    "scene": "ambiance",
    "visual": {
      "description": "The exterior of a modern burger joint called 'BRIM BIG JUICY BURGERS'. The storefront features large glass windows, a black facade with prominent white signage, and outdoor seating.",
      "confidence": 0.95,
      "quality": 0.85,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "burger joint",
        "confidence": 0.9
      },
      {
        "name": "coffee shop",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "restaurant",
      "exterior",
      "brim",
      "big juicy burgers",
      "coffee",
      "pakistani food"
    ],
    "ambience_features": [
      "modern",
      "outdoor seating",
      "street view"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
Cleaned response for image_id 6fa1cf3d-8cfb-4d2a-8134-21cdb4666e6a:
[
  {
    "image_id": "6fa1cf3d-8cfb-4d2a-8134-21cdb4666e6a",
    "scene": "ambiance",
    "visual": {
      "description": "The exterior of a modern burger joint called 'BRIM BIG JUICY BURGERS'. The storefront features large glass windows, a black facade with prominent white signage, and outdoor seating.",
      "confidence": 0.95,
      "quality": 0.85,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "burger joint",
        "confidence": 0.9
      },
      {
        "name": "coffee shop",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "restaurant",
      "exterior",
      "brim",
      "big juicy burgers",
      "coffee",
      "pakistani food"
    ],
    "ambience_features": [
      "modern",
      "outdoor seating",
      "street view"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
Raw response for image_id 2dce49c4-d693-4c71-a573-dd56cd7e7837:
```json
[
  {
    "image_id": "2dce49c4-d693-4c71-a573-dd56cd7e7837",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a double-patty cheeseburger, generously topped with melted orange cheese and visible pickles. The burger is wrapped in aluminum foil, with a sesame seed bun. The background is blurred, showing what appears to be an indoor restaurant setting with people and kitchen equipment.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "burger",
        "confidence": 0.98
      },
      {
        "name": "cheeseburger",
        "confidence": 0.92
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "cheeseburger",
      "fast food",
      "double patty",
      "cheese",
      "pickles",
      "sesame bun",
      "foil wrap"
    ],
    "ambience_features": [
      "indoor",
      "restaurant"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
Cleaned response for image_id 2dce49c4-d693-4c71-a573-dd56cd7e7837:
[
  {
    "image_id": "2dce49c4-d693-4c71-a573-dd56cd7e7837",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a double-patty cheeseburger, generously topped with melted orange cheese and visible pickles. The burger is wrapped in aluminum foil, with a sesame seed bun. The background is blurred, showing what appears to be an indoor restaurant setting with people and kitchen equipment.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "burger",
        "confidence": 0.98
      },
      {
        "name": "cheeseburger",
        "confidence": 0.92
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "cheeseburger",
      "fast food",
      "double patty",
      "cheese",
      "pickles",
      "sesame bun",
      "foil wrap"
    ],
    "ambience_features": [
      "indoor",
      "restaurant"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
Raw response for image_id 6f86fac1-1963-4fd7-b7a9-4f4fdcf170c7:
```json
[
  {
    "image_id": "6f86fac1-1963-4fd7-b7a9-4f4fdcf170c7",
    "scene": "beverage",
    "visual": {
      "description": "A hand holding a clear plastic cup filled with peach ice tea. The cup has a circular sticker with a peach logo and the text 'PEACHED ICE TEA' and 'BRIM'. A white straw is inserted into the drink. In the background, a sign with bright neon lights says 'WE SMASH IT RIGHT'. There are also some food items wrapped in foil and packets of condiments on a table.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "peach ice tea",
        "confidence": 0.98
      },
      {
        "name": "burger",
        "confidence": 0.65
      },
      {
        "name": "ketchup packet",
        "confidence": 0.70
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice tea",
      "peach",
      "drink",
      "beverage",
      "neon lights",
      "restaurant",
      "casual dining"
    ],
    "ambience_features": [
      "modern",
      "lit",
      "energetic"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
Cleaned response for image_id 6f86fac1-1963-4fd7-b7a9-4f4fdcf170c7:
[
  {
    "image_id": "6f86fac1-1963-4fd7-b7a9-4f4fdcf170c7",
    "scene": "beverage",
    "visual": {
      "description": "A hand holding a clear plastic cup filled with peach ice tea. The cup has a circular sticker with a peach logo and the text 'PEACHED ICE TEA' and 'BRIM'. A white straw is inserted into the drink. In the background, a sign with bright neon lights says 'WE SMASH IT RIGHT'. There are also some food items wrapped in foil and packets of condiments on a table.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "peach ice tea",
        "confidence": 0.98
      },
      {
        "name": "burger",
        "confidence": 0.65
      },
      {
        "name": "ketchup packet",
        "confidence": 0.70
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice tea",
      "peach",
      "drink",
      "beverage",
      "neon lights",
      "restaurant",
      "casual dining"
    ],
    "ambience_features": [
      "modern",
      "lit",
      "energetic"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002C1369FF910>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002C1368D16D0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002C137717C50>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:19:14 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001F0974D4C90>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001F0FFA716D0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001F0FFD13190>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:19:21 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 120-019-553
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:20:31] "[35m[1mGET / HTTP/1.1[0m" 500 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:20:31] "GET /?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:20:31] "GET /?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:20:32] "GET /?__debugger__=yes&cmd=resource&f=console.png&s=Rb8S8BsTSJHbkNm5KdHK HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:20:32] "GET /?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1" 200 -
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001FB7A980150>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001FB7A78D6D0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001FB7A903210>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:21:09 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002A241543B90>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002A2412416D0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002A24208D3D0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:21:16 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 120-019-553
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:21:16] "[35m[1mGET / HTTP/1.1[0m" 500 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:21:16] "[36mGET /?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1[0m" 304 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:21:16] "[36mGET /?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1[0m" 304 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:21:16] "GET /?__debugger__=yes&cmd=resource&f=console.png&s=vIePINoM9QgzR4j4piDW HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:21:17] "[36mGET /?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1[0m" 304 -
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001FA3F39A590>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001FA3F0696D0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001FA3F2FF650>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:21:56 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000013894177D50>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000138941616D0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000013894FB03D0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:22:03 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 120-019-553
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:22:04] "GET / HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:22:05] "[33mGET /favicon.ico HTTP/1.1[0m" 404 -
DEBUG:root:Review data prepared: {'restaurantName': 'Karachi Darbar', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 1500.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'Amazing chicken karahi with perfect spice level!', 'hashtags': ['karahi', 'spicy', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:PIL.Image:Importing BlpImagePlugin
DEBUG:PIL.Image:Importing BmpImagePlugin
DEBUG:PIL.Image:Importing BufrStubImagePlugin
DEBUG:PIL.Image:Importing CurImagePlugin
DEBUG:PIL.Image:Importing DcxImagePlugin
DEBUG:PIL.Image:Importing DdsImagePlugin
DEBUG:PIL.Image:Importing EpsImagePlugin
DEBUG:PIL.Image:Importing FitsImagePlugin
DEBUG:PIL.Image:Importing FliImagePlugin
DEBUG:PIL.Image:Importing FpxImagePlugin
DEBUG:PIL.Image:Image: failed to import FpxImagePlugin: No module named 'olefile'
DEBUG:PIL.Image:Importing FtexImagePlugin
DEBUG:PIL.Image:Importing GbrImagePlugin
DEBUG:PIL.Image:Importing GifImagePlugin
DEBUG:PIL.Image:Importing GribStubImagePlugin
DEBUG:PIL.Image:Importing Hdf5StubImagePlugin
DEBUG:PIL.Image:Importing IcnsImagePlugin
DEBUG:PIL.Image:Importing IcoImagePlugin
DEBUG:PIL.Image:Importing ImImagePlugin
DEBUG:PIL.Image:Importing ImtImagePlugin
DEBUG:PIL.Image:Importing IptcImagePlugin
DEBUG:PIL.Image:Importing JpegImagePlugin
DEBUG:PIL.Image:Importing Jpeg2KImagePlugin
DEBUG:PIL.Image:Importing McIdasImagePlugin
DEBUG:PIL.Image:Importing MicImagePlugin
DEBUG:PIL.Image:Image: failed to import MicImagePlugin: No module named 'olefile'
DEBUG:PIL.Image:Importing MpegImagePlugin
DEBUG:PIL.Image:Importing MpoImagePlugin
DEBUG:PIL.Image:Importing MspImagePlugin
DEBUG:PIL.Image:Importing PalmImagePlugin
DEBUG:PIL.Image:Importing PcdImagePlugin
DEBUG:PIL.Image:Importing PcxImagePlugin
DEBUG:PIL.Image:Importing PdfImagePlugin
DEBUG:PIL.Image:Importing PixarImagePlugin
DEBUG:PIL.Image:Importing PngImagePlugin
DEBUG:PIL.Image:Importing PpmImagePlugin
DEBUG:PIL.Image:Importing PsdImagePlugin
DEBUG:PIL.Image:Importing QoiImagePlugin
DEBUG:PIL.Image:Importing SgiImagePlugin
DEBUG:PIL.Image:Importing SpiderImagePlugin
DEBUG:PIL.Image:Importing SunImagePlugin
DEBUG:PIL.Image:Importing TgaImagePlugin
DEBUG:PIL.Image:Importing TiffImagePlugin
DEBUG:PIL.Image:Importing WebPImagePlugin
DEBUG:PIL.Image:Importing WmfImagePlugin
DEBUG:PIL.Image:Importing XbmImagePlugin
DEBUG:PIL.Image:Importing XpmImagePlugin
DEBUG:PIL.Image:Importing XVThumbImagePlugin
DEBUG:root:Analyzing image with image_id: 04ec48a3-d44b-422d-8459-50de27bab1db
DEBUG:root:Review data prepared: {'restaurantName': 'Karachi Darbar', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 1500.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'Amazing chicken karahi with perfect spice level!', 'hashtags': ['karahi', 'spicy', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:root:Analyzing image with image_id: 75cbd6a6-4e60-4bf6-9960-b46a9a8a22ad
DEBUG:root:Raw Gemini response for image_id 04ec48a3-d44b-422d-8459-50de27bab1db:
```json
[
  {
    "image_id": "04ec48a3-d44b-422d-8459-50de27bab1db",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand is using a ladle to stir a rich, golden broth in a large, ornate copper pot. The pot has intricate engravings and is placed on a foil base, suggesting it's being kept warm. The broth appears to be a savory, potentially meaty stew or curry.",
      "confidence": 0.9,
      "quality": 0.7,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.8
      },
      {
        "name": "stew",
        "confidence": 0.75
      },
      {
        "name": "nihari",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "copper pot",
      "ladle",
      "broth",
      "stew",
      "curry",
      "Pakistani food",
      "traditional",
      "warm"
    ],
    "ambience_features": [
      "ornate",
      "traditional"
    ],
    "thumbnail_rank": 0.8
  }
]
```
Raw response for image_id 04ec48a3-d44b-422d-8459-50de27bab1db:
```json
[
  {
    "image_id": "04ec48a3-d44b-422d-8459-50de27bab1db",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand is using a ladle to stir a rich, golden broth in a large, ornate copper pot. The pot has intricate engravings and is placed on a foil base, suggesting it's being kept warm. The broth appears to be a savory, potentially meaty stew or curry.",
      "confidence": 0.9,
      "quality": 0.7,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.8
      },
      {
        "name": "stew",
        "confidence": 0.75
      },
      {
        "name": "nihari",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "copper pot",
      "ladle",
      "broth",
      "stew",
      "curry",
      "Pakistani food",
      "traditional",
      "warm"
    ],
    "ambience_features": [
      "ornate",
      "traditional"
    ],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 04ec48a3-d44b-422d-8459-50de27bab1db:
[
  {
    "image_id": "04ec48a3-d44b-422d-8459-50de27bab1db",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand is using a ladle to stir a rich, golden broth in a large, ornate copper pot. The pot has intricate engravings and is placed on a foil base, suggesting it's being kept warm. The broth appears to be a savory, potentially meaty stew or curry.",
      "confidence": 0.9,
      "quality": 0.7,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.8
      },
      {
        "name": "stew",
        "confidence": 0.75
      },
      {
        "name": "nihari",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "copper pot",
      "ladle",
      "broth",
      "stew",
      "curry",
      "Pakistani food",
      "traditional",
      "warm"
    ],
    "ambience_features": [
      "ornate",
      "traditional"
    ],
    "thumbnail_rank": 0.8
  }
]
Cleaned response for image_id 04ec48a3-d44b-422d-8459-50de27bab1db:
[
  {
    "image_id": "04ec48a3-d44b-422d-8459-50de27bab1db",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand is using a ladle to stir a rich, golden broth in a large, ornate copper pot. The pot has intricate engravings and is placed on a foil base, suggesting it's being kept warm. The broth appears to be a savory, potentially meaty stew or curry.",
      "confidence": 0.9,
      "quality": 0.7,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.8
      },
      {
        "name": "stew",
        "confidence": 0.75
      },
      {
        "name": "nihari",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "copper pot",
      "ladle",
      "broth",
      "stew",
      "curry",
      "Pakistani food",
      "traditional",
      "warm"
    ],
    "ambience_features": [
      "ornate",
      "traditional"
    ],
    "thumbnail_rank": 0.8
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:root:Raw Gemini response for image_id 75cbd6a6-4e60-4bf6-9960-b46a9a8a22ad:
```json
[
  {
    "image_id": "75cbd6a6-4e60-4bf6-9960-b46a9a8a22ad",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a traditional copper pot with a ladle inside, containing a yellowish, oily curry or stew. The pot has intricate decorative carvings and is lined with foil at the bottom.",
      "confidence": 0.9,
      "quality": 0.7,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.7
      },
      {
        "name": "stew",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "copper pot",
      "curry",
      "stew",
      "traditional",
      "serving",
      "Pakistani food"
    ],
    "ambience_features": [
      "traditional cookware"
    ],
    "thumbnail_rank": 0.8
  }
]
```
Raw response for image_id 75cbd6a6-4e60-4bf6-9960-b46a9a8a22ad:
```json
[
  {
    "image_id": "75cbd6a6-4e60-4bf6-9960-b46a9a8a22ad",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a traditional copper pot with a ladle inside, containing a yellowish, oily curry or stew. The pot has intricate decorative carvings and is lined with foil at the bottom.",
      "confidence": 0.9,
      "quality": 0.7,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.7
      },
      {
        "name": "stew",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "copper pot",
      "curry",
      "stew",
      "traditional",
      "serving",
      "Pakistani food"
    ],
    "ambience_features": [
      "traditional cookware"
    ],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 75cbd6a6-4e60-4bf6-9960-b46a9a8a22ad:
[
  {
    "image_id": "75cbd6a6-4e60-4bf6-9960-b46a9a8a22ad",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a traditional copper pot with a ladle inside, containing a yellowish, oily curry or stew. The pot has intricate decorative carvings and is lined with foil at the bottom.",
      "confidence": 0.9,
      "quality": 0.7,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.7
      },
      {
        "name": "stew",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "copper pot",
      "curry",
      "stew",
      "traditional",
      "serving",
      "Pakistani food"
    ],
    "ambience_features": [
      "traditional cookware"
    ],
    "thumbnail_rank": 0.8
  }
]
Cleaned response for image_id 75cbd6a6-4e60-4bf6-9960-b46a9a8a22ad:
[
  {
    "image_id": "75cbd6a6-4e60-4bf6-9960-b46a9a8a22ad",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a traditional copper pot with a ladle inside, containing a yellowish, oily curry or stew. The pot has intricate decorative carvings and is lined with foil at the bottom.",
      "confidence": 0.9,
      "quality": 0.7,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.7
      },
      {
        "name": "stew",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "copper pot",
      "curry",
      "stew",
      "traditional",
      "serving",
      "Pakistani food"
    ],
    "ambience_features": [
      "traditional cookware"
    ],
    "thumbnail_rank": 0.8
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:root:Review data prepared: {'restaurantName': 'Karachi Darbar', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 1500.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'Amazing chicken karahi with perfect spice level!', 'hashtags': ['karahi', 'spicy', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:root:Analyzing image with image_id: bde3c2ab-0641-4cec-8708-a74902a8e615
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user HTTP/1.1" 307 0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user HTTP/1.1" 307 0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user/ HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user/ HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 04ec48a3-d44b-422d-8459-50de27bab1db, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Aggregated quality_score: 0.7
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 75cbd6a6-4e60-4bf6-9960-b46a9a8a22ad, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Aggregated quality_score: 0.7
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:root:Raw Gemini response for image_id bde3c2ab-0641-4cec-8708-a74902a8e615:
```json
[
  {
    "image_id": "bde3c2ab-0641-4cec-8708-a74902a8e615",
    "scene": "dish_closeup",
    "visual": {
      "description": "A traditional copper pot, often used for serving hearty stews, contains a rich, golden-brown curry. A hand is seen stirring the contents with a spoon, suggesting it's being served or prepared.",
      "confidence": 0.9,
      "quality": 0.75,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.85
      },
      {
        "name": "nihari",
        "confidence": 0.6
      },
      {
        "name": "haleem",
        "confidence": 0.5
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "stew",
      "copper pot",
      "traditional",
      "serving",
      "pakistani food"
    ],
    "ambience_features": [
      "warm lighting",
      "indoor setting",
      "traditional cookware"
    ],
    "thumbnail_rank": 1.0
  }
]
```
Raw response for image_id bde3c2ab-0641-4cec-8708-a74902a8e615:
```json
[
  {
    "image_id": "bde3c2ab-0641-4cec-8708-a74902a8e615",
    "scene": "dish_closeup",
    "visual": {
      "description": "A traditional copper pot, often used for serving hearty stews, contains a rich, golden-brown curry. A hand is seen stirring the contents with a spoon, suggesting it's being served or prepared.",
      "confidence": 0.9,
      "quality": 0.75,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.85
      },
      {
        "name": "nihari",
        "confidence": 0.6
      },
      {
        "name": "haleem",
        "confidence": 0.5
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "stew",
      "copper pot",
      "traditional",
      "serving",
      "pakistani food"
    ],
    "ambience_features": [
      "warm lighting",
      "indoor setting",
      "traditional cookware"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id bde3c2ab-0641-4cec-8708-a74902a8e615:
[
  {
    "image_id": "bde3c2ab-0641-4cec-8708-a74902a8e615",
    "scene": "dish_closeup",
    "visual": {
      "description": "A traditional copper pot, often used for serving hearty stews, contains a rich, golden-brown curry. A hand is seen stirring the contents with a spoon, suggesting it's being served or prepared.",
      "confidence": 0.9,
      "quality": 0.75,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.85
      },
      {
        "name": "nihari",
        "confidence": 0.6
      },
      {
        "name": "haleem",
        "confidence": 0.5
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "stew",
      "copper pot",
      "traditional",
      "serving",
      "pakistani food"
    ],
    "ambience_features": [
      "warm lighting",
      "indoor setting",
      "traditional cookware"
    ],
    "thumbnail_rank": 1.0
  }
]
Cleaned response for image_id bde3c2ab-0641-4cec-8708-a74902a8e615:
[
  {
    "image_id": "bde3c2ab-0641-4cec-8708-a74902a8e615",
    "scene": "dish_closeup",
    "visual": {
      "description": "A traditional copper pot, often used for serving hearty stews, contains a rich, golden-brown curry. A hand is seen stirring the contents with a spoon, suggesting it's being served or prepared.",
      "confidence": 0.9,
      "quality": 0.75,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.85
      },
      {
        "name": "nihari",
        "confidence": 0.6
      },
      {
        "name": "haleem",
        "confidence": 0.5
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "stew",
      "copper pot",
      "traditional",
      "serving",
      "pakistani food"
    ],
    "ambience_features": [
      "warm lighting",
      "indoor setting",
      "traditional cookware"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000013896523910>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000138941616D0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001389448B910>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000138941616D0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000138964B9FD0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000013896529310>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id bde3c2ab-0641-4cec-8708-a74902a8e615, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Aggregated quality_score: 0.75
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:22:30 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: 7358ad81-5ff3-40f4-956e-e528aebd03c8
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:22:30 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
DEBUG:root:Calculating reach...
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:root:Reach calculation - quality_score: 0.7, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.42, reach_level: Search-only (no feed distribution)
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:22:30] "POST /process_review HTTP/1.1" 200 -
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: fd403d47-7cfb-47c4-b338-d9ef6758f97a
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.7, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.42, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:22:30] "POST /process_review HTTP/1.1" 200 -
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000138FBE17D90>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000138941616D0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000138963CCC10>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:22:31] "[33mGET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1[0m" 404 -
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:22:31 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: da8a1091-7b39-42f1-a3b3-d82206f10145
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.75, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.44999999999999996, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:22:31] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: karahi, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'karahi' and search_type 'text'
DEBUG:root:Expanded synonyms for keywords ['karahi']: ['curry', 'stew']
DEBUG:root:Keywords: ['karahi'], Synonyms: ['curry', 'stew']
DEBUG:root:Generating text embedding for query 'karahi' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'karahi', length: 768
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000138965287D0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000138941616D0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000013896528350>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:23:02 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 6 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:23:06 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 5 keyword search results.
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.3393987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.06999999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.4253987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.075, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.4143987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.06999999999999999, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.22835820041666668, keyword_score: 0.3333333333333333, semantic_score: 0.036366135, quality_score: 0.088, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.85
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.2366582004166667, keyword_score: 0.3333333333333333, semantic_score: 0.036366135, quality_score: 0.092, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.109371238625, keyword_score: 0.0, semantic_score: 0.0092849545, quality_score: 0.08524999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.95
DEBUG:root:Search completed, returning 6 results.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:23:12] "POST /search HTTP/1.1" 200 -
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EE9EBAB7D0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001EE9E861F40> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EE9EB0F390>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:26:10 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 120-019-553
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:27:14] "GET / HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Chapli House', 'branchName': 'Johar town', 'serviceType': 'dineIn', 'totalBill': 1500.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'Best chapli kabab', 'hashtags': ['karahi', 'spicy', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:PIL.Image:Importing BlpImagePlugin
DEBUG:PIL.Image:Importing BmpImagePlugin
DEBUG:PIL.Image:Importing BufrStubImagePlugin
DEBUG:PIL.Image:Importing CurImagePlugin
DEBUG:PIL.Image:Importing DcxImagePlugin
DEBUG:PIL.Image:Importing DdsImagePlugin
DEBUG:PIL.Image:Importing EpsImagePlugin
DEBUG:PIL.Image:Importing FitsImagePlugin
DEBUG:PIL.Image:Importing FliImagePlugin
DEBUG:PIL.Image:Importing FpxImagePlugin
DEBUG:PIL.Image:Image: failed to import FpxImagePlugin: No module named 'olefile'
DEBUG:PIL.Image:Importing FtexImagePlugin
DEBUG:PIL.Image:Importing GbrImagePlugin
DEBUG:PIL.Image:Importing GifImagePlugin
DEBUG:PIL.Image:Importing GribStubImagePlugin
DEBUG:PIL.Image:Importing Hdf5StubImagePlugin
DEBUG:PIL.Image:Importing IcnsImagePlugin
DEBUG:PIL.Image:Importing IcoImagePlugin
DEBUG:PIL.Image:Importing ImImagePlugin
DEBUG:PIL.Image:Importing ImtImagePlugin
DEBUG:PIL.Image:Importing IptcImagePlugin
DEBUG:PIL.Image:Importing JpegImagePlugin
DEBUG:PIL.Image:Importing Jpeg2KImagePlugin
DEBUG:PIL.Image:Importing McIdasImagePlugin
DEBUG:PIL.Image:Importing MicImagePlugin
DEBUG:PIL.Image:Image: failed to import MicImagePlugin: No module named 'olefile'
DEBUG:PIL.Image:Importing MpegImagePlugin
DEBUG:PIL.Image:Importing MpoImagePlugin
DEBUG:PIL.Image:Importing MspImagePlugin
DEBUG:PIL.Image:Importing PalmImagePlugin
DEBUG:PIL.Image:Importing PcdImagePlugin
DEBUG:PIL.Image:Importing PcxImagePlugin
DEBUG:PIL.Image:Importing PdfImagePlugin
DEBUG:PIL.Image:Importing PixarImagePlugin
DEBUG:PIL.Image:Importing PngImagePlugin
DEBUG:PIL.Image:Importing PpmImagePlugin
DEBUG:PIL.Image:Importing PsdImagePlugin
DEBUG:PIL.Image:Importing QoiImagePlugin
DEBUG:PIL.Image:Importing SgiImagePlugin
DEBUG:PIL.Image:Importing SpiderImagePlugin
DEBUG:PIL.Image:Importing SunImagePlugin
DEBUG:PIL.Image:Importing TgaImagePlugin
DEBUG:PIL.Image:Importing TiffImagePlugin
DEBUG:PIL.Image:Importing WebPImagePlugin
DEBUG:PIL.Image:Importing WmfImagePlugin
DEBUG:PIL.Image:Importing XbmImagePlugin
DEBUG:PIL.Image:Importing XpmImagePlugin
DEBUG:PIL.Image:Importing XVThumbImagePlugin
DEBUG:root:Analyzing image with image_id: d5bea719-56bf-43c1-ad71-a05c9c365b86
DEBUG:root:Raw Gemini response for image_id d5bea719-56bf-43c1-ad71-a05c9c365b86:
```json
[
  {
    "image_id": "d5bea719-56bf-43c1-ad71-a05c9c365b86",
    "scene": "dish_closeup",
    "visual": {
      "description": "Several fried pakoras are arranged on a round griddle, with some appearing to be cooking in hot oil in the background.",
      "confidence": 0.9,
      "quality": 0.5,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.9
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "fried",
      "snack",
      "street food",
      "savory"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
```
Raw response for image_id d5bea719-56bf-43c1-ad71-a05c9c365b86:
```json
[
  {
    "image_id": "d5bea719-56bf-43c1-ad71-a05c9c365b86",
    "scene": "dish_closeup",
    "visual": {
      "description": "Several fried pakoras are arranged on a round griddle, with some appearing to be cooking in hot oil in the background.",
      "confidence": 0.9,
      "quality": 0.5,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.9
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "fried",
      "snack",
      "street food",
      "savory"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id d5bea719-56bf-43c1-ad71-a05c9c365b86:
[
  {
    "image_id": "d5bea719-56bf-43c1-ad71-a05c9c365b86",
    "scene": "dish_closeup",
    "visual": {
      "description": "Several fried pakoras are arranged on a round griddle, with some appearing to be cooking in hot oil in the background.",
      "confidence": 0.9,
      "quality": 0.5,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.9
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "fried",
      "snack",
      "street food",
      "savory"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
Cleaned response for image_id d5bea719-56bf-43c1-ad71-a05c9c365b86:
[
  {
    "image_id": "d5bea719-56bf-43c1-ad71-a05c9c365b86",
    "scene": "dish_closeup",
    "visual": {
      "description": "Several fried pakoras are arranged on a round griddle, with some appearing to be cooking in hot oil in the background.",
      "confidence": 0.9,
      "quality": 0.5,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.9
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "fried",
      "snack",
      "street food",
      "savory"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user HTTP/1.1" 307 0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user/ HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id d5bea719-56bf-43c1-ad71-a05c9c365b86, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Aggregated quality_score: 0.5
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EEA090F3D0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001EE9E861F40> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EEA090FF90>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:27:57 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: 240ce975-026d-4dbb-9360-54972a6ec3fb
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.5, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.3, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:27:57] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: chapli kabab, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'chapli kabab' and search_type 'text'
DEBUG:root:Expanded synonyms for keywords ['chapli', 'kabab']: []
DEBUG:root:Keywords: ['chapli', 'kabab'], Synonyms: []
DEBUG:root:Generating text embedding for query 'chapli kabab' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'chapli kabab', length: 768
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EEA0902750>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001EE9E861F40> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EEA0902910>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:28:16 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 7 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:28:19 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 0 keyword search results.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.10346392050000001, keyword_score: 0.0, semantic_score: 0.043855682, quality_score: 0.05, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.19314912, keyword_score: 0.0, semantic_score: 0.04259648, quality_score: 0.075, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.10714912000000001, keyword_score: 0.0, semantic_score: 0.04259648, quality_score: 0.06999999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.18214912, keyword_score: 0.0, semantic_score: 0.04259648, quality_score: 0.06999999999999999, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.1148670075, keyword_score: 0.0, semantic_score: 0.03126803, quality_score: 0.08524999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.95
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.11802490350000001, keyword_score: 0.0, semantic_score: 0.028499614, quality_score: 0.092, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.1097249035, keyword_score: 0.0, semantic_score: 0.028499614, quality_score: 0.088, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.85
DEBUG:root:Search completed, returning 7 results.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:28:23] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: chapli kabab, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'chapli kabab' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['chapli', 'kabab']: []
DEBUG:root:Keywords: ['chapli', 'kabab'], Synonyms: []
DEBUG:root:Generating text embedding for query 'chapli kabab' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'chapli kabab', length: 768
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EEA090D710>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001EE9E861F40> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EE9F14A190>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:28:36 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.failed exception=ReadTimeout(TimeoutError('The read operation timed out'))
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
ERROR:root:Error during search: The read operation timed out
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:28:45] "[35m[1mPOST /search HTTP/1.1[0m" 500 -
DEBUG:root:Search initiated with query: chapli kabab, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'chapli kabab' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['chapli', 'kabab']: []
DEBUG:root:Keywords: ['chapli', 'kabab'], Synonyms: []
DEBUG:root:Generating text embedding for query 'chapli kabab' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:root:Search initiated with query: chapli kabab, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'chapli kabab' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['chapli', 'kabab']: []
DEBUG:root:Keywords: ['chapli', 'kabab'], Synonyms: []
DEBUG:root:Generating text embedding for query 'chapli kabab' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'chapli kabab', length: 768
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EEA090C890>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001EE9E861F40> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'chapli kabab', length: 768
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EEA090E8D0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EEA090EB90>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001EE9E861F40> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:28:52 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EEA32BCD90>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:28:53 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:root:Search initiated with query: burger, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'burger' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['burger']: []
DEBUG:root:Keywords: ['burger'], Synonyms: []
DEBUG:root:Generating text embedding for query 'burger' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'burger', length: 768
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.failed exception=ConnectTimeout(TimeoutError('timed out'))
ERROR:root:Error during search: timed out
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:29:22] "[35m[1mPOST /search HTTP/1.1[0m" 500 -
DEBUG:httpcore.http11:receive_response_body.failed exception=ReadTimeout(TimeoutError('The read operation timed out'))
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
ERROR:root:Error during search: The read operation timed out
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:29:38] "[35m[1mPOST /search HTTP/1.1[0m" 500 -
DEBUG:httpcore.http11:receive_response_body.failed exception=ReadTimeout(TimeoutError('The read operation timed out'))
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
ERROR:root:Error during search: The read operation timed out
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:29:39] "[35m[1mPOST /search HTTP/1.1[0m" 500 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:29:46] "GET / HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:29:53] "GET / HTTP/1.1" 200 -
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000022D7909B890>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x0000022D79031F40> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000022D7909A150>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:30:14 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000018C0C421F90>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x0000018C0B5C1F40> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000018C0B804490>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:30:24 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 120-019-553
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:30:25] "GET / HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:30:39] "GET / HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Karachi Darbar', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 1500.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'Amazing chicken karahi with perfect spice level!', 'hashtags': ['karahi', 'spicy', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/5...
DEBUG:PIL.Image:Importing BlpImagePlugin
DEBUG:PIL.Image:Importing BmpImagePlugin
DEBUG:PIL.Image:Importing BufrStubImagePlugin
DEBUG:PIL.Image:Importing CurImagePlugin
DEBUG:PIL.Image:Importing DcxImagePlugin
DEBUG:PIL.Image:Importing DdsImagePlugin
DEBUG:PIL.Image:Importing EpsImagePlugin
DEBUG:PIL.Image:Importing FitsImagePlugin
DEBUG:PIL.Image:Importing FliImagePlugin
DEBUG:PIL.Image:Importing FpxImagePlugin
DEBUG:PIL.Image:Image: failed to import FpxImagePlugin: No module named 'olefile'
DEBUG:PIL.Image:Importing FtexImagePlugin
DEBUG:PIL.Image:Importing GbrImagePlugin
DEBUG:PIL.Image:Importing GifImagePlugin
DEBUG:PIL.Image:Importing GribStubImagePlugin
DEBUG:PIL.Image:Importing Hdf5StubImagePlugin
DEBUG:PIL.Image:Importing IcnsImagePlugin
DEBUG:PIL.Image:Importing IcoImagePlugin
DEBUG:PIL.Image:Importing ImImagePlugin
DEBUG:PIL.Image:Importing ImtImagePlugin
DEBUG:PIL.Image:Importing IptcImagePlugin
DEBUG:PIL.Image:Importing JpegImagePlugin
DEBUG:PIL.Image:Importing Jpeg2KImagePlugin
DEBUG:PIL.Image:Importing McIdasImagePlugin
DEBUG:PIL.Image:Importing MicImagePlugin
DEBUG:PIL.Image:Image: failed to import MicImagePlugin: No module named 'olefile'
DEBUG:PIL.Image:Importing MpegImagePlugin
DEBUG:PIL.Image:Importing MpoImagePlugin
DEBUG:PIL.Image:Importing MspImagePlugin
DEBUG:PIL.Image:Importing PalmImagePlugin
DEBUG:PIL.Image:Importing PcdImagePlugin
DEBUG:PIL.Image:Importing PcxImagePlugin
DEBUG:PIL.Image:Importing PdfImagePlugin
DEBUG:PIL.Image:Importing PixarImagePlugin
DEBUG:PIL.Image:Importing PngImagePlugin
DEBUG:PIL.Image:Importing PpmImagePlugin
DEBUG:PIL.Image:Importing PsdImagePlugin
DEBUG:PIL.Image:Importing QoiImagePlugin
DEBUG:PIL.Image:Importing SgiImagePlugin
DEBUG:PIL.Image:Importing SpiderImagePlugin
DEBUG:PIL.Image:Importing SunImagePlugin
DEBUG:PIL.Image:Importing TgaImagePlugin
DEBUG:PIL.Image:Importing TiffImagePlugin
DEBUG:PIL.Image:Importing WebPImagePlugin
DEBUG:PIL.Image:Importing WmfImagePlugin
DEBUG:PIL.Image:Importing XbmImagePlugin
DEBUG:PIL.Image:Importing XpmImagePlugin
DEBUG:PIL.Image:Importing XVThumbImagePlugin
DEBUG:root:Analyzing image with image_id: 77fca713-0f59-447f-8746-70e860462424
DEBUG:root:Raw Gemini response for image_id 77fca713-0f59-447f-8746-70e860462424:
```json
[
  {
    "image_id": "77fca713-0f59-447f-8746-70e860462424",
    "scene": "ambiance",
    "visual": {
      "description": "The exterior of a modern burger restaurant called 'BRIM Big Juicy Burgers'. The facade is black with prominent illuminated signage. A glass storefront reveals an indoor seating area. There's also an outdoor seating area with tables and chairs in the foreground. A person stands near the entrance, and another sign reads 'SHAGHF COFFEE'.",
      "confidence": 0.9,
      "quality": 0.8,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "mixed",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "restaurant",
      "burger",
      "exterior",
      "signage",
      "coffee",
      "seating",
      "modern"
    ],
    "ambience_features": [
      "modern exterior",
      "outdoor seating",
      "indoor seating",
      "illuminated signage"
    ],
    "thumbnail_rank": 1.0
  }
]
```
Raw response for image_id 77fca713-0f59-447f-8746-70e860462424:
```json
[
  {
    "image_id": "77fca713-0f59-447f-8746-70e860462424",
    "scene": "ambiance",
    "visual": {
      "description": "The exterior of a modern burger restaurant called 'BRIM Big Juicy Burgers'. The facade is black with prominent illuminated signage. A glass storefront reveals an indoor seating area. There's also an outdoor seating area with tables and chairs in the foreground. A person stands near the entrance, and another sign reads 'SHAGHF COFFEE'.",
      "confidence": 0.9,
      "quality": 0.8,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "mixed",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "restaurant",
      "burger",
      "exterior",
      "signage",
      "coffee",
      "seating",
      "modern"
    ],
    "ambience_features": [
      "modern exterior",
      "outdoor seating",
      "indoor seating",
      "illuminated signage"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 77fca713-0f59-447f-8746-70e860462424:
[
  {
    "image_id": "77fca713-0f59-447f-8746-70e860462424",
    "scene": "ambiance",
    "visual": {
      "description": "The exterior of a modern burger restaurant called 'BRIM Big Juicy Burgers'. The facade is black with prominent illuminated signage. A glass storefront reveals an indoor seating area. There's also an outdoor seating area with tables and chairs in the foreground. A person stands near the entrance, and another sign reads 'SHAGHF COFFEE'.",
      "confidence": 0.9,
      "quality": 0.8,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "mixed",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "restaurant",
      "burger",
      "exterior",
      "signage",
      "coffee",
      "seating",
      "modern"
    ],
    "ambience_features": [
      "modern exterior",
      "outdoor seating",
      "indoor seating",
      "illuminated signage"
    ],
    "thumbnail_rank": 1.0
  }
]
Cleaned response for image_id 77fca713-0f59-447f-8746-70e860462424:
[
  {
    "image_id": "77fca713-0f59-447f-8746-70e860462424",
    "scene": "ambiance",
    "visual": {
      "description": "The exterior of a modern burger restaurant called 'BRIM Big Juicy Burgers'. The facade is black with prominent illuminated signage. A glass storefront reveals an indoor seating area. There's also an outdoor seating area with tables and chairs in the foreground. A person stands near the entrance, and another sign reads 'SHAGHF COFFEE'.",
      "confidence": 0.9,
      "quality": 0.8,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "mixed",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "restaurant",
      "burger",
      "exterior",
      "signage",
      "coffee",
      "seating",
      "modern"
    ],
    "ambience_features": [
      "modern exterior",
      "outdoor seating",
      "indoor seating",
      "illuminated signage"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user HTTP/1.1" 307 0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user/ HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 77fca713-0f59-447f-8746-70e860462424, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Processing image 2/5...
DEBUG:root:Analyzing image with image_id: 90c993ca-bdf8-40bc-936f-08762b7d9cdc
DEBUG:root:Raw Gemini response for image_id 90c993ca-bdf8-40bc-936f-08762b7d9cdc:
{"image_id": "90c993ca-bdf8-40bc-936f-08762b7d9cdc", "scene": "dish_closeup", "visual": {"description": "A close-up shot of a loaded beef burger, wrapped in foil, with melted cheese and sesame seed bun. The burger appears to be a double patty with ample toppings.", "confidence": 0.92, "quality": 0.85, "appeal_score": 0.9}, "context": {"ambiance": "indoor", "lighting": "warm", "meal_timing": "any"}, "items": [{"name": "burger", "confidence": 0.98}, {"name": "beef patty", "confidence": 0.95}, {"name": "cheese", "confidence": 0.93}], "flag_type": "none", "penalty_score": 0, "keywords": ["burger", "beef", "cheese", "double patty", "sesame seed bun", "fast food"], "ambience_features": ["foil-wrapped"], "thumbnail_rank": 1.0}
Raw response for image_id 90c993ca-bdf8-40bc-936f-08762b7d9cdc:
{"image_id": "90c993ca-bdf8-40bc-936f-08762b7d9cdc", "scene": "dish_closeup", "visual": {"description": "A close-up shot of a loaded beef burger, wrapped in foil, with melted cheese and sesame seed bun. The burger appears to be a double patty with ample toppings.", "confidence": 0.92, "quality": 0.85, "appeal_score": 0.9}, "context": {"ambiance": "indoor", "lighting": "warm", "meal_timing": "any"}, "items": [{"name": "burger", "confidence": 0.98}, {"name": "beef patty", "confidence": 0.95}, {"name": "cheese", "confidence": 0.93}], "flag_type": "none", "penalty_score": 0, "keywords": ["burger", "beef", "cheese", "double patty", "sesame seed bun", "fast food"], "ambience_features": ["foil-wrapped"], "thumbnail_rank": 1.0}
==================================================
DEBUG:root:Cleaned response for image_id 90c993ca-bdf8-40bc-936f-08762b7d9cdc:
{"image_id": "90c993ca-bdf8-40bc-936f-08762b7d9cdc", "scene": "dish_closeup", "visual": {"description": "A close-up shot of a loaded beef burger, wrapped in foil, with melted cheese and sesame seed bun. The burger appears to be a double patty with ample toppings.", "confidence": 0.92, "quality": 0.85, "appeal_score": 0.9}, "context": {"ambiance": "indoor", "lighting": "warm", "meal_timing": "any"}, "items": [{"name": "burger", "confidence": 0.98}, {"name": "beef patty", "confidence": 0.95}, {"name": "cheese", "confidence": 0.93}], "flag_type": "none", "penalty_score": 0, "keywords": ["burger", "beef", "cheese", "double patty", "sesame seed bun", "fast food"], "ambience_features": ["foil-wrapped"], "thumbnail_rank": 1.0}
Cleaned response for image_id 90c993ca-bdf8-40bc-936f-08762b7d9cdc:
{"image_id": "90c993ca-bdf8-40bc-936f-08762b7d9cdc", "scene": "dish_closeup", "visual": {"description": "A close-up shot of a loaded beef burger, wrapped in foil, with melted cheese and sesame seed bun. The burger appears to be a double patty with ample toppings.", "confidence": 0.92, "quality": 0.85, "appeal_score": 0.9}, "context": {"ambiance": "indoor", "lighting": "warm", "meal_timing": "any"}, "items": [{"name": "burger", "confidence": 0.98}, {"name": "beef patty", "confidence": 0.95}, {"name": "cheese", "confidence": 0.93}], "flag_type": "none", "penalty_score": 0, "keywords": ["burger", "beef", "cheese", "double patty", "sesame seed bun", "fast food"], "ambience_features": ["foil-wrapped"], "thumbnail_rank": 1.0}
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 90c993ca-bdf8-40bc-936f-08762b7d9cdc, length: 768
DEBUG:root:Image 2 processed successfully.
DEBUG:root:Processing image 3/5...
DEBUG:root:Analyzing image with image_id: 5c35996e-d973-42ab-b2b3-7d6ee99a77f4
DEBUG:root:Raw Gemini response for image_id 5c35996e-d973-42ab-b2b3-7d6ee99a77f4:
```json
[
  {
    "image_id": "5c35996e-d973-42ab-b2b3-7d6ee99a77f4",
    "scene": "beverage",
    "visual": {
      "description": "A hand holds a plastic cup of peached ice tea with a straw. The cup has a label that says 'PEACHED ICE TEA' and 'BRIM'. In the background, a neon sign reads 'WE SMASH IT RIGHT'. There are also some food items wrapped in foil and paper napkins on the table.",
      "confidence": 0.95,
      "quality": 0.85,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "peached ice tea",
        "confidence": 0.98
      },
      {
        "name": "burger",
        "confidence": 0.65
      },
      {
        "name": "ketchup packets",
        "confidence": 0.8
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice tea",
      "peach",
      "drink",
      "beverage",
      "fast food",
      "restaurant"
    ],
    "ambience_features": [
      "neon sign",
      "indoor dining"
    ],
    "thumbnail_rank": 0.9
  }
]
```
Raw response for image_id 5c35996e-d973-42ab-b2b3-7d6ee99a77f4:
```json
[
  {
    "image_id": "5c35996e-d973-42ab-b2b3-7d6ee99a77f4",
    "scene": "beverage",
    "visual": {
      "description": "A hand holds a plastic cup of peached ice tea with a straw. The cup has a label that says 'PEACHED ICE TEA' and 'BRIM'. In the background, a neon sign reads 'WE SMASH IT RIGHT'. There are also some food items wrapped in foil and paper napkins on the table.",
      "confidence": 0.95,
      "quality": 0.85,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "peached ice tea",
        "confidence": 0.98
      },
      {
        "name": "burger",
        "confidence": 0.65
      },
      {
        "name": "ketchup packets",
        "confidence": 0.8
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice tea",
      "peach",
      "drink",
      "beverage",
      "fast food",
      "restaurant"
    ],
    "ambience_features": [
      "neon sign",
      "indoor dining"
    ],
    "thumbnail_rank": 0.9
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 5c35996e-d973-42ab-b2b3-7d6ee99a77f4:
[
  {
    "image_id": "5c35996e-d973-42ab-b2b3-7d6ee99a77f4",
    "scene": "beverage",
    "visual": {
      "description": "A hand holds a plastic cup of peached ice tea with a straw. The cup has a label that says 'PEACHED ICE TEA' and 'BRIM'. In the background, a neon sign reads 'WE SMASH IT RIGHT'. There are also some food items wrapped in foil and paper napkins on the table.",
      "confidence": 0.95,
      "quality": 0.85,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "peached ice tea",
        "confidence": 0.98
      },
      {
        "name": "burger",
        "confidence": 0.65
      },
      {
        "name": "ketchup packets",
        "confidence": 0.8
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice tea",
      "peach",
      "drink",
      "beverage",
      "fast food",
      "restaurant"
    ],
    "ambience_features": [
      "neon sign",
      "indoor dining"
    ],
    "thumbnail_rank": 0.9
  }
]
Cleaned response for image_id 5c35996e-d973-42ab-b2b3-7d6ee99a77f4:
[
  {
    "image_id": "5c35996e-d973-42ab-b2b3-7d6ee99a77f4",
    "scene": "beverage",
    "visual": {
      "description": "A hand holds a plastic cup of peached ice tea with a straw. The cup has a label that says 'PEACHED ICE TEA' and 'BRIM'. In the background, a neon sign reads 'WE SMASH IT RIGHT'. There are also some food items wrapped in foil and paper napkins on the table.",
      "confidence": 0.95,
      "quality": 0.85,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "peached ice tea",
        "confidence": 0.98
      },
      {
        "name": "burger",
        "confidence": 0.65
      },
      {
        "name": "ketchup packets",
        "confidence": 0.8
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice tea",
      "peach",
      "drink",
      "beverage",
      "fast food",
      "restaurant"
    ],
    "ambience_features": [
      "neon sign",
      "indoor dining"
    ],
    "thumbnail_rank": 0.9
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 5c35996e-d973-42ab-b2b3-7d6ee99a77f4, length: 768
DEBUG:root:Image 3 processed successfully.
DEBUG:root:Processing image 4/5...
DEBUG:root:Analyzing image with image_id: ef1bbd64-bccd-47c2-9e1b-d1619d40ab53
DEBUG:root:Raw Gemini response for image_id ef1bbd64-bccd-47c2-9e1b-d1619d40ab53:
```json
[
  {
    "image_id": "ef1bbd64-bccd-47c2-9e1b-d1619d40ab53",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a traditional copper pot filled with a rich, golden-brown curry. A hand is holding a ladle, about to scoop out the curry. The pot has intricate carvings and is resting on aluminum foil.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.9
      },
      {
        "name": "nihari",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "traditional pot",
      "copper",
      "Pakistani food",
      "slow cooked",
      "rich gravy",
      "spoon",
      "serving"
    ],
    "ambience_features": [
      "traditional",
      "warm lighting",
      "indoor"
    ],
    "thumbnail_rank": 1.0
  }
]
```
Raw response for image_id ef1bbd64-bccd-47c2-9e1b-d1619d40ab53:
```json
[
  {
    "image_id": "ef1bbd64-bccd-47c2-9e1b-d1619d40ab53",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a traditional copper pot filled with a rich, golden-brown curry. A hand is holding a ladle, about to scoop out the curry. The pot has intricate carvings and is resting on aluminum foil.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.9
      },
      {
        "name": "nihari",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "traditional pot",
      "copper",
      "Pakistani food",
      "slow cooked",
      "rich gravy",
      "spoon",
      "serving"
    ],
    "ambience_features": [
      "traditional",
      "warm lighting",
      "indoor"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id ef1bbd64-bccd-47c2-9e1b-d1619d40ab53:
[
  {
    "image_id": "ef1bbd64-bccd-47c2-9e1b-d1619d40ab53",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a traditional copper pot filled with a rich, golden-brown curry. A hand is holding a ladle, about to scoop out the curry. The pot has intricate carvings and is resting on aluminum foil.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.9
      },
      {
        "name": "nihari",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "traditional pot",
      "copper",
      "Pakistani food",
      "slow cooked",
      "rich gravy",
      "spoon",
      "serving"
    ],
    "ambience_features": [
      "traditional",
      "warm lighting",
      "indoor"
    ],
    "thumbnail_rank": 1.0
  }
]
Cleaned response for image_id ef1bbd64-bccd-47c2-9e1b-d1619d40ab53:
[
  {
    "image_id": "ef1bbd64-bccd-47c2-9e1b-d1619d40ab53",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a traditional copper pot filled with a rich, golden-brown curry. A hand is holding a ladle, about to scoop out the curry. The pot has intricate carvings and is resting on aluminum foil.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.9
      },
      {
        "name": "nihari",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "traditional pot",
      "copper",
      "Pakistani food",
      "slow cooked",
      "rich gravy",
      "spoon",
      "serving"
    ],
    "ambience_features": [
      "traditional",
      "warm lighting",
      "indoor"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id ef1bbd64-bccd-47c2-9e1b-d1619d40ab53, length: 768
DEBUG:root:Image 4 processed successfully.
DEBUG:root:Processing image 5/5...
DEBUG:root:Analyzing image with image_id: e9b7dfaa-c5e7-4238-b39f-b24ea7d6dae8
DEBUG:root:Raw Gemini response for image_id e9b7dfaa-c5e7-4238-b39f-b24ea7d6dae8:
```json
[
  {
    "image_id": "e9b7dfaa-c5e7-4238-b39f-b24ea7d6dae8",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of several fried patties, possibly pakoras or tikki, being cooked. In the background, oil is hot in a large wok with more items being fried.  A utensil is in the wok to flip the items.",
      "confidence": 0.9,
      "quality": 0.5,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.7
      },
      {
        "name": "tikki",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "fried",
      "pakora",
      "tikki",
      "snack",
      "cooking",
      "street food"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
```
Raw response for image_id e9b7dfaa-c5e7-4238-b39f-b24ea7d6dae8:
```json
[
  {
    "image_id": "e9b7dfaa-c5e7-4238-b39f-b24ea7d6dae8",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of several fried patties, possibly pakoras or tikki, being cooked. In the background, oil is hot in a large wok with more items being fried.  A utensil is in the wok to flip the items.",
      "confidence": 0.9,
      "quality": 0.5,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.7
      },
      {
        "name": "tikki",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "fried",
      "pakora",
      "tikki",
      "snack",
      "cooking",
      "street food"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id e9b7dfaa-c5e7-4238-b39f-b24ea7d6dae8:
[
  {
    "image_id": "e9b7dfaa-c5e7-4238-b39f-b24ea7d6dae8",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of several fried patties, possibly pakoras or tikki, being cooked. In the background, oil is hot in a large wok with more items being fried.  A utensil is in the wok to flip the items.",
      "confidence": 0.9,
      "quality": 0.5,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.7
      },
      {
        "name": "tikki",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "fried",
      "pakora",
      "tikki",
      "snack",
      "cooking",
      "street food"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
Cleaned response for image_id e9b7dfaa-c5e7-4238-b39f-b24ea7d6dae8:
[
  {
    "image_id": "e9b7dfaa-c5e7-4238-b39f-b24ea7d6dae8",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of several fried patties, possibly pakoras or tikki, being cooked. In the background, oil is hot in a large wok with more items being fried.  A utensil is in the wok to flip the items.",
      "confidence": 0.9,
      "quality": 0.5,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.7
      },
      {
        "name": "tikki",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "fried",
      "pakora",
      "tikki",
      "snack",
      "cooking",
      "street food"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id e9b7dfaa-c5e7-4238-b39f-b24ea7d6dae8, length: 768
DEBUG:root:Image 5 processed successfully.
DEBUG:root:Aggregated quality_score: 0.74
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000018C0D9A8C10>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x0000018C0B5C1F40> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000018C0D9AB250>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:32:27 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: a82f6cc5-b1b6-468c-8151-71bad554f123
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.74, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.444, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:32:27] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: karahi, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'karahi' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['karahi']: ['curry', 'stew']
DEBUG:root:Keywords: ['karahi'], Synonyms: ['stew', 'curry']
DEBUG:root:Generating text embedding for query 'karahi' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'karahi', length: 768
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000018C0D9B60D0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x0000018C0B5C1F40> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000018C0D9B6090>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:33:29 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 8 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:33:33 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 6 keyword search results.
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.4143987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.06999999999999999, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.4253987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.075, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.3393987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.06999999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.2366582004166667, keyword_score: 0.3333333333333333, semantic_score: 0.036366135, quality_score: 0.092, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.22835820041666668, keyword_score: 0.3333333333333333, semantic_score: 0.036366135, quality_score: 0.088, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.85
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.24007298566666668, keyword_score: 0.3333333333333333, semantic_score: 0.016425276, quality_score: 0.074, personal_score: 0.1, geo_score: 0.85, thumbnail_rank: 0.9400000000000001
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.09565325625000001, keyword_score: 0.0, semantic_score: 0.012613025, quality_score: 0.05, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.109371238625, keyword_score: 0.0, semantic_score: 0.0092849545, quality_score: 0.08524999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.95
DEBUG:root:Search completed, returning 8 results.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:33:39] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: burger, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'burger' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['burger']: []
DEBUG:root:Keywords: ['burger'], Synonyms: []
DEBUG:root:Generating text embedding for query 'burger' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'burger', length: 768
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000018C0D986CD0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x0000018C0B5C1F40> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000018C0D987110>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:34:04 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 8 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:34:14 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 2 keyword search results.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.1017507175, keyword_score: 0.0, semantic_score: 0.03700287, quality_score: 0.05, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.46491179124999993, keyword_score: 1.0, semantic_score: 0.031447165, quality_score: 0.08524999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.95
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.47540606924999995, keyword_score: 1.0, semantic_score: 0.024424277, quality_score: 0.074, personal_score: 0.1, geo_score: 0.85, thumbnail_rank: 0.9400000000000001
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.09783500525000001, keyword_score: 0.0, semantic_score: 0.005340021, quality_score: 0.06999999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.17283500525, keyword_score: 0.0, semantic_score: 0.005340021, quality_score: 0.06999999999999999, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.18383500525000002, keyword_score: 0.0, semantic_score: 0.005340021, quality_score: 0.075, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.111800646675, keyword_score: 0.0, semantic_score: 0.0036025867, quality_score: 0.092, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.103500646675, keyword_score: 0.0, semantic_score: 0.0036025867, quality_score: 0.088, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.85
DEBUG:root:Search completed, returning 8 results.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:34:19] "POST /search HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:36:04] "GET /?pakistani_cuisine=0.5&italian_cuisine=0.3&chinese_cuisine=0.2&quality_expectation=7 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:36:12] "GET /?pakistani_cuisine=0.5&italian_cuisine=0.6&chinese_cuisine=0.2&quality_expectation=7 HTTP/1.1" 200 -
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\numpy\\_typing\\_scalars.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000023FC40B9C90>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x0000023FC3E49EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000023FC3C19150>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:38:43 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 120-019-553
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:38:43] "GET /?pakistani_cuisine=0.5&italian_cuisine=0.6&chinese_cuisine=0.2&quality_expectation=7 HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: karahi, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'karahi' and search_type 'text'
DEBUG:root:Expanded synonyms for keywords ['karahi']: ['curry', 'stew']
DEBUG:root:Keywords: ['karahi'], Synonyms: ['stew', 'curry']
DEBUG:root:Generating text embedding for query 'karahi' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user HTTP/1.1" 307 0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user/ HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'karahi', length: 768
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000023FC4189E50>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x0000023FC3E49EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000023FC418ACD0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:38:58 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 8 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:39:08 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 6 keyword search results.
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.4143987783333333 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.4253987783333333 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.3393987783333333 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.2366582004166667 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.22835820041666668 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.24007298566666668 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09565325625000001 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.109371238625 (threshold: 0.5)
DEBUG:root:Search completed, returning 0 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:39:16] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: burger, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'burger' and search_type 'text'
DEBUG:root:Expanded synonyms for keywords ['burger']: []
DEBUG:root:Keywords: ['burger'], Synonyms: []
DEBUG:root:Generating text embedding for query 'burger' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'burger', length: 768
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000023FC4191290>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x0000023FC3E49EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000023FC3A56F90>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:39:38 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 8 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:39:53 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.failed exception=ReadTimeout(TimeoutError('The read operation timed out'))
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
ERROR:root:Error during search: The read operation timed out
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:40:26] "[35m[1mPOST /search HTTP/1.1[0m" 500 -
DEBUG:root:Search initiated with query: burger, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'burger' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['burger']: []
DEBUG:root:Keywords: ['burger'], Synonyms: []
DEBUG:root:Generating text embedding for query 'burger' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'burger', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000023FC5D28F10>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x0000023FC3E49EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000023FC4191290>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:40:34 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 8 text-to-image search results from Qdrant.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1017507175 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.46491179124999993 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.47540606924999995 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09783500525000001 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.17283500525 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.18383500525000002 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.111800646675 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.103500646675 (threshold: 0.5)
DEBUG:root:Search completed, returning 0 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:40:39] "POST /search HTTP/1.1" 200 -
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723AFEB710>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723AFEA590>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:41:48 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 120-019-553
DEBUG:root:Search initiated with query: burger, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'burger' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['burger']: []
DEBUG:root:Keywords: ['burger'], Synonyms: []
DEBUG:root:Generating text embedding for query 'burger' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user HTTP/1.1" 307 0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user/ HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'burger', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:41:50 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 8 text-to-image search results from Qdrant.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1017507175 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.46491179124999993, keyword_score: 1.0, semantic_score: 0.031447165, quality_score: 0.08524999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.95
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.47540606924999995, keyword_score: 1.0, semantic_score: 0.024424277, quality_score: 0.074, personal_score: 0.1, geo_score: 0.85, thumbnail_rank: 0.9400000000000001
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09783500525000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.17283500525 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.18383500525000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.111800646675 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.103500646675 (threshold: 0.2)
DEBUG:root:Search completed, returning 2 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:41:55] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: karahi, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'karahi' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['karahi']: ['curry', 'stew']
DEBUG:root:Keywords: ['karahi'], Synonyms: ['stew', 'curry']
DEBUG:root:Generating text embedding for query 'karahi' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'karahi', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723AD0D210>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723AD0E650>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:42:06 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 8 text-to-image search results from Qdrant.
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.4143987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.06999999999999999, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.4253987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.075, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.3393987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.06999999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.2366582004166667, keyword_score: 0.3333333333333333, semantic_score: 0.036366135, quality_score: 0.092, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.22835820041666668, keyword_score: 0.3333333333333333, semantic_score: 0.036366135, quality_score: 0.088, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.85
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.24007298566666668, keyword_score: 0.3333333333333333, semantic_score: 0.016425276, quality_score: 0.074, personal_score: 0.1, geo_score: 0.85, thumbnail_rank: 0.9400000000000001
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09565325625000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.109371238625 (threshold: 0.2)
DEBUG:root:Search completed, returning 6 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:42:19] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: icecream, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'icecream' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['icecream']: []
DEBUG:root:Keywords: ['icecream'], Synonyms: []
DEBUG:root:Generating text embedding for query 'icecream' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'icecream', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723AF58BD0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723BB4EA10>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:42:58 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 8 text-to-image search results from Qdrant.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09746501575000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12373608675 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1111405095 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1001601245 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.17516012450000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.18616012450000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11174018275 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10344018275 (threshold: 0.2)
DEBUG:root:Search completed, returning 0 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:43:04] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: halwa, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'halwa' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['halwa']: []
DEBUG:root:Keywords: ['halwa'], Synonyms: []
DEBUG:root:Generating text embedding for query 'halwa' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'halwa', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723CB78B90>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723CB78A50>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:43:17 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 8 text-to-image search results from Qdrant.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.19142704 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.18042704 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10542704000000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09933505375000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10920412300000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.117504123 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12536161625 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1108410305 (threshold: 0.2)
DEBUG:root:Search completed, returning 0 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:43:22] "POST /search HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Suleman Sweets', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 1500.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'best halwa puri !', 'hashtags': ['desi', 'breakfast']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:PIL.Image:Importing BlpImagePlugin
DEBUG:PIL.Image:Importing BmpImagePlugin
DEBUG:PIL.Image:Importing BufrStubImagePlugin
DEBUG:PIL.Image:Importing CurImagePlugin
DEBUG:PIL.Image:Importing DcxImagePlugin
DEBUG:PIL.Image:Importing DdsImagePlugin
DEBUG:PIL.Image:Importing EpsImagePlugin
DEBUG:PIL.Image:Importing FitsImagePlugin
DEBUG:PIL.Image:Importing FliImagePlugin
DEBUG:PIL.Image:Importing FpxImagePlugin
DEBUG:PIL.Image:Image: failed to import FpxImagePlugin: No module named 'olefile'
DEBUG:PIL.Image:Importing FtexImagePlugin
DEBUG:PIL.Image:Importing GbrImagePlugin
DEBUG:PIL.Image:Importing GifImagePlugin
DEBUG:PIL.Image:Importing GribStubImagePlugin
DEBUG:PIL.Image:Importing Hdf5StubImagePlugin
DEBUG:PIL.Image:Importing IcnsImagePlugin
DEBUG:PIL.Image:Importing IcoImagePlugin
DEBUG:PIL.Image:Importing ImImagePlugin
DEBUG:PIL.Image:Importing ImtImagePlugin
DEBUG:PIL.Image:Importing IptcImagePlugin
DEBUG:PIL.Image:Importing JpegImagePlugin
DEBUG:PIL.Image:Importing Jpeg2KImagePlugin
DEBUG:PIL.Image:Importing McIdasImagePlugin
DEBUG:PIL.Image:Importing MicImagePlugin
DEBUG:PIL.Image:Image: failed to import MicImagePlugin: No module named 'olefile'
DEBUG:PIL.Image:Importing MpegImagePlugin
DEBUG:PIL.Image:Importing MpoImagePlugin
DEBUG:PIL.Image:Importing MspImagePlugin
DEBUG:PIL.Image:Importing PalmImagePlugin
DEBUG:PIL.Image:Importing PcdImagePlugin
DEBUG:PIL.Image:Importing PcxImagePlugin
DEBUG:PIL.Image:Importing PdfImagePlugin
DEBUG:PIL.Image:Importing PixarImagePlugin
DEBUG:PIL.Image:Importing PngImagePlugin
DEBUG:PIL.Image:Importing PpmImagePlugin
DEBUG:PIL.Image:Importing PsdImagePlugin
DEBUG:PIL.Image:Importing QoiImagePlugin
DEBUG:PIL.Image:Importing SgiImagePlugin
DEBUG:PIL.Image:Importing SpiderImagePlugin
DEBUG:PIL.Image:Importing SunImagePlugin
DEBUG:PIL.Image:Importing TgaImagePlugin
DEBUG:PIL.Image:Importing TiffImagePlugin
DEBUG:PIL.Image:Importing WebPImagePlugin
DEBUG:PIL.Image:Importing WmfImagePlugin
DEBUG:PIL.Image:Importing XbmImagePlugin
DEBUG:PIL.Image:Importing XpmImagePlugin
DEBUG:PIL.Image:Importing XVThumbImagePlugin
DEBUG:root:Analyzing image with image_id: ae20b141-a598-45ac-8b83-96b4d6568937
DEBUG:root:Raw Gemini response for image_id ae20b141-a598-45ac-8b83-96b4d6568937:
```json
[
  {
    "image_id": "ae20b141-a598-45ac-8b83-96b4d6568937",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish featuring a puffed bread, possibly Puri, served with what appears to be keema (minced meat) and carrot halwa.",
      "confidence": 0.95,
      "quality": 0.6,
      "appeal_score": 0.65
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "Puri",
        "confidence": 0.8
      },
      {
        "name": "Keema",
        "confidence": 0.7
      },
      {
        "name": "Carrot Halwa",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "puri",
      "keema",
      "halwa",
      "breakfast",
      "snack"
    ],
    "ambience_features": [
      "warm lighting"
    ],
    "thumbnail_rank": 0.8
  }
]
```
Raw response for image_id ae20b141-a598-45ac-8b83-96b4d6568937:
```json
[
  {
    "image_id": "ae20b141-a598-45ac-8b83-96b4d6568937",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish featuring a puffed bread, possibly Puri, served with what appears to be keema (minced meat) and carrot halwa.",
      "confidence": 0.95,
      "quality": 0.6,
      "appeal_score": 0.65
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "Puri",
        "confidence": 0.8
      },
      {
        "name": "Keema",
        "confidence": 0.7
      },
      {
        "name": "Carrot Halwa",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "puri",
      "keema",
      "halwa",
      "breakfast",
      "snack"
    ],
    "ambience_features": [
      "warm lighting"
    ],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id ae20b141-a598-45ac-8b83-96b4d6568937:
[
  {
    "image_id": "ae20b141-a598-45ac-8b83-96b4d6568937",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish featuring a puffed bread, possibly Puri, served with what appears to be keema (minced meat) and carrot halwa.",
      "confidence": 0.95,
      "quality": 0.6,
      "appeal_score": 0.65
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "Puri",
        "confidence": 0.8
      },
      {
        "name": "Keema",
        "confidence": 0.7
      },
      {
        "name": "Carrot Halwa",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "puri",
      "keema",
      "halwa",
      "breakfast",
      "snack"
    ],
    "ambience_features": [
      "warm lighting"
    ],
    "thumbnail_rank": 0.8
  }
]
Cleaned response for image_id ae20b141-a598-45ac-8b83-96b4d6568937:
[
  {
    "image_id": "ae20b141-a598-45ac-8b83-96b4d6568937",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish featuring a puffed bread, possibly Puri, served with what appears to be keema (minced meat) and carrot halwa.",
      "confidence": 0.95,
      "quality": 0.6,
      "appeal_score": 0.65
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "Puri",
        "confidence": 0.8
      },
      {
        "name": "Keema",
        "confidence": 0.7
      },
      {
        "name": "Carrot Halwa",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "puri",
      "keema",
      "halwa",
      "breakfast",
      "snack"
    ],
    "ambience_features": [
      "warm lighting"
    ],
    "thumbnail_rank": 0.8
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id ae20b141-a598-45ac-8b83-96b4d6568937, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Aggregated quality_score: 0.6
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D2C8550>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D2C9C50>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:44:09 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: 4e2afc51-3d6b-4403-b074-2e0754ffb1b7
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.6, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.36, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:44:09] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: halwa, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'halwa' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['halwa']: []
DEBUG:root:Keywords: ['halwa'], Synonyms: []
DEBUG:root:Generating text embedding for query 'halwa' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'halwa', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723BB01A50>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D2C8090>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:44:21 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 9 text-to-image search results from Qdrant.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.18042704 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10542704000000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.19142704 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09933505375000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.117504123 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10920412300000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12536161625 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1108410305 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.44677927549999996, keyword_score: 1.0, semantic_score: 0.009117102, quality_score: 0.06, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Search completed, returning 1 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:44:29] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: halwa, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'halwa' and search_type 'text'
DEBUG:root:Expanded synonyms for keywords ['halwa']: []
DEBUG:root:Keywords: ['halwa'], Synonyms: []
DEBUG:root:Generating text embedding for query 'halwa' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'halwa', length: 768
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D2CAD10>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D2CA7D0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:44:41 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 9 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:44:49 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 1 keyword search results.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.18042704 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10542704000000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.19142704 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09933505375000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.117504123 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10920412300000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12536161625 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1108410305 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.44677927549999996, keyword_score: 1.0, semantic_score: 0.009117102, quality_score: 0.06, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Search completed, returning 1 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:44:58] "POST /search HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Chaman Icecream', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 200.0, 'rateUserExperience': {'foodTaste': 5, 'ambience': 4, 'staff': 5, 'willRecommend': 4}, 'averageRating': 4.5, 'userThoughts': 'Very fruity icecream', 'hashtags': ['icecream', 'chaman']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:PIL.PngImagePlugin:STREAM b'IHDR' 16 13
DEBUG:PIL.PngImagePlugin:STREAM b'sRGB' 41 1
DEBUG:PIL.PngImagePlugin:STREAM b'gAMA' 54 4
DEBUG:PIL.PngImagePlugin:STREAM b'pHYs' 70 9
DEBUG:PIL.PngImagePlugin:STREAM b'IDAT' 91 65445
ERROR:root:Error processing review: cannot access local variable 'image_id' where it is not associated with a value
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:48:14] "[35m[1mPOST /process_review HTTP/1.1[0m" 500 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:48:35] "GET /?pakistani_cuisine=0.5&italian_cuisine=0.6&chinese_cuisine=0.2&quality_expectation=7 HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Chaman Icecream', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 200.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'icecream', 'hashtags': ['icecream', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:PIL.PngImagePlugin:STREAM b'IHDR' 16 13
DEBUG:PIL.PngImagePlugin:STREAM b'sRGB' 41 1
DEBUG:PIL.PngImagePlugin:STREAM b'gAMA' 54 4
DEBUG:PIL.PngImagePlugin:STREAM b'pHYs' 70 9
DEBUG:PIL.PngImagePlugin:STREAM b'IDAT' 91 65445
ERROR:root:Error processing review: cannot access local variable 'image_id' where it is not associated with a value
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:49:09] "[35m[1mPOST /process_review HTTP/1.1[0m" 500 -
DEBUG:root:Review data prepared: {'restaurantName': 'Chaman Icecream', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 200.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'icecream', 'hashtags': ['icecream', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:root:Analyzing image with image_id: 521f94a4-2fbd-46c8-8ad2-49c2f12ff5dc
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:49:36] "GET /?pakistani_cuisine=0.5&italian_cuisine=0.6&chinese_cuisine=0.2&quality_expectation=7 HTTP/1.1" 200 -
DEBUG:root:Raw Gemini response for image_id 521f94a4-2fbd-46c8-8ad2-49c2f12ff5dc:
```json
[
  {
    "image_id": "521f94a4-2fbd-46c8-8ad2-49c2f12ff5dc",
    "scene": "dish_closeup",
    "visual": {
      "description": "A double patty cheeseburger, generously topped with melted cheese and possibly some diced onions or relish, is held in foil. The sesame seed bun is slightly compressed. The background shows a busy, indoor restaurant setting with blurred lights and people.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "cheeseburger",
        "confidence": 0.98
      },
      {
        "name": "burger patty",
        "confidence": 0.95
      },
      {
        "name": "sesame seed bun",
        "confidence": 0.92
      },
      {
        "name": "melted cheese",
        "confidence": 0.90
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "cheeseburger",
      "fast food",
      "double patty",
      "cheese",
      "sesame bun",
      "foil wrapped",
      "delicious",
      "food porn"
    ],
    "ambience_features": [
      "indoor dining",
      "restaurant",
      "busy"
    ],
    "thumbnail_rank": 0.9
  }
]
```
Raw response for image_id 521f94a4-2fbd-46c8-8ad2-49c2f12ff5dc:
```json
[
  {
    "image_id": "521f94a4-2fbd-46c8-8ad2-49c2f12ff5dc",
    "scene": "dish_closeup",
    "visual": {
      "description": "A double patty cheeseburger, generously topped with melted cheese and possibly some diced onions or relish, is held in foil. The sesame seed bun is slightly compressed. The background shows a busy, indoor restaurant setting with blurred lights and people.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "cheeseburger",
        "confidence": 0.98
      },
      {
        "name": "burger patty",
        "confidence": 0.95
      },
      {
        "name": "sesame seed bun",
        "confidence": 0.92
      },
      {
        "name": "melted cheese",
        "confidence": 0.90
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "cheeseburger",
      "fast food",
      "double patty",
      "cheese",
      "sesame bun",
      "foil wrapped",
      "delicious",
      "food porn"
    ],
    "ambience_features": [
      "indoor dining",
      "restaurant",
      "busy"
    ],
    "thumbnail_rank": 0.9
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 521f94a4-2fbd-46c8-8ad2-49c2f12ff5dc:
[
  {
    "image_id": "521f94a4-2fbd-46c8-8ad2-49c2f12ff5dc",
    "scene": "dish_closeup",
    "visual": {
      "description": "A double patty cheeseburger, generously topped with melted cheese and possibly some diced onions or relish, is held in foil. The sesame seed bun is slightly compressed. The background shows a busy, indoor restaurant setting with blurred lights and people.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "cheeseburger",
        "confidence": 0.98
      },
      {
        "name": "burger patty",
        "confidence": 0.95
      },
      {
        "name": "sesame seed bun",
        "confidence": 0.92
      },
      {
        "name": "melted cheese",
        "confidence": 0.90
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "cheeseburger",
      "fast food",
      "double patty",
      "cheese",
      "sesame bun",
      "foil wrapped",
      "delicious",
      "food porn"
    ],
    "ambience_features": [
      "indoor dining",
      "restaurant",
      "busy"
    ],
    "thumbnail_rank": 0.9
  }
]
Cleaned response for image_id 521f94a4-2fbd-46c8-8ad2-49c2f12ff5dc:
[
  {
    "image_id": "521f94a4-2fbd-46c8-8ad2-49c2f12ff5dc",
    "scene": "dish_closeup",
    "visual": {
      "description": "A double patty cheeseburger, generously topped with melted cheese and possibly some diced onions or relish, is held in foil. The sesame seed bun is slightly compressed. The background shows a busy, indoor restaurant setting with blurred lights and people.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "cheeseburger",
        "confidence": 0.98
      },
      {
        "name": "burger patty",
        "confidence": 0.95
      },
      {
        "name": "sesame seed bun",
        "confidence": 0.92
      },
      {
        "name": "melted cheese",
        "confidence": 0.90
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "cheeseburger",
      "fast food",
      "double patty",
      "cheese",
      "sesame bun",
      "foil wrapped",
      "delicious",
      "food porn"
    ],
    "ambience_features": [
      "indoor dining",
      "restaurant",
      "busy"
    ],
    "thumbnail_rank": 0.9
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:root:Review data prepared: {'restaurantName': 'Karachi Darbar', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 1500.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'Amazing chicken karahi with perfect spice level!', 'hashtags': ['karahi', 'spicy', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:root:Analyzing image with image_id: 4545853c-7086-4914-9115-54b010a6b4f5
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 521f94a4-2fbd-46c8-8ad2-49c2f12ff5dc, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Aggregated quality_score: 0.88
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D10CCD0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D10D2D0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:root:Raw Gemini response for image_id 4545853c-7086-4914-9115-54b010a6b4f5:
```json
[
  {
    "image_id": "4545853c-7086-4914-9115-54b010a6b4f5",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish featuring a large, fluffy puri, accompanied by what appears to be a meat preparation (like keema) and some sliced cooked vegetables, possibly carrots or sweet potatoes, on a white plate.",
      "confidence": 0.85,
      "quality": 0.55,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.95
      },
      {
        "name": "keema",
        "confidence": 0.7
      },
      {
        "name": "vegetables",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "keema",
      "pakistani food",
      "indian subcontinent",
      "breakfast",
      "snack"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.9
  }
]
```
Raw response for image_id 4545853c-7086-4914-9115-54b010a6b4f5:
```json
[
  {
    "image_id": "4545853c-7086-4914-9115-54b010a6b4f5",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish featuring a large, fluffy puri, accompanied by what appears to be a meat preparation (like keema) and some sliced cooked vegetables, possibly carrots or sweet potatoes, on a white plate.",
      "confidence": 0.85,
      "quality": 0.55,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.95
      },
      {
        "name": "keema",
        "confidence": 0.7
      },
      {
        "name": "vegetables",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "keema",
      "pakistani food",
      "indian subcontinent",
      "breakfast",
      "snack"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.9
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 4545853c-7086-4914-9115-54b010a6b4f5:
[
  {
    "image_id": "4545853c-7086-4914-9115-54b010a6b4f5",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish featuring a large, fluffy puri, accompanied by what appears to be a meat preparation (like keema) and some sliced cooked vegetables, possibly carrots or sweet potatoes, on a white plate.",
      "confidence": 0.85,
      "quality": 0.55,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.95
      },
      {
        "name": "keema",
        "confidence": 0.7
      },
      {
        "name": "vegetables",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "keema",
      "pakistani food",
      "indian subcontinent",
      "breakfast",
      "snack"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.9
  }
]
Cleaned response for image_id 4545853c-7086-4914-9115-54b010a6b4f5:
[
  {
    "image_id": "4545853c-7086-4914-9115-54b010a6b4f5",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish featuring a large, fluffy puri, accompanied by what appears to be a meat preparation (like keema) and some sliced cooked vegetables, possibly carrots or sweet potatoes, on a white plate.",
      "confidence": 0.85,
      "quality": 0.55,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.95
      },
      {
        "name": "keema",
        "confidence": 0.7
      },
      {
        "name": "vegetables",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "keema",
      "pakistani food",
      "indian subcontinent",
      "breakfast",
      "snack"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.9
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 4545853c-7086-4914-9115-54b010a6b4f5, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Aggregated quality_score: 0.55
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D10C8D0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:49:44 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: fffb8329-f1f6-45ee-ada3-d398fb9bffe4
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723CB75DD0>
DEBUG:root:Calculating reach...
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:root:Reach calculation - quality_score: 0.88, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.528, reach_level: Search-only (no feed distribution)
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:root:Reach calculation completed.
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:49:44] "POST /process_review HTTP/1.1" 200 -
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:49:44 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: a8e1b619-4ae5-424b-aca7-39657bd1a414
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.55, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.33, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:49:44] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Karachi Darbar', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 1500.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'Amazing chicken karahi with perfect spice level!', 'hashtags': ['karahi', 'spicy', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:PIL.PngImagePlugin:STREAM b'IHDR' 16 13
DEBUG:PIL.PngImagePlugin:STREAM b'sRGB' 41 1
DEBUG:PIL.PngImagePlugin:STREAM b'gAMA' 54 4
DEBUG:PIL.PngImagePlugin:STREAM b'pHYs' 70 9
DEBUG:PIL.PngImagePlugin:STREAM b'IDAT' 91 65445
ERROR:root:Error processing review: cannot access local variable 'image_id' where it is not associated with a value
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:50:02] "[35m[1mPOST /process_review HTTP/1.1[0m" 500 -
DEBUG:root:Review data prepared: {'restaurantName': 'Karachi Darbar', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 1500.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'Amazing chicken karahi with perfect spice level!', 'hashtags': ['karahi', 'spicy', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:root:Analyzing image with image_id: 19e87061-92f9-40d3-bc6b-66281ba8ac04
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:52:28] "GET /?pakistani_cuisine=0.5&italian_cuisine=0.6&chinese_cuisine=0.2&quality_expectation=7 HTTP/1.1" 200 -
DEBUG:root:Raw Gemini response for image_id 19e87061-92f9-40d3-bc6b-66281ba8ac04:
```json
[
  {
    "image_id": "19e87061-92f9-40d3-bc6b-66281ba8ac04",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand holding a multi-colored soft-serve ice cream cone against a blurred background of greenery and neutral-colored planters. The ice cream has layers of pink, orange, yellow, light blue, and white. The cone is wrapped in a white paper with pink dots. The hand has bright pink nail polish.",
      "confidence": 0.98,
      "quality": 0.95,
      "appeal_score": 0.9
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.99
      },
      {
        "name": "soft serve",
        "confidence": 0.98
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "soft serve",
      "cone",
      "dessert",
      "sweet",
      "colorful",
      "hand",
      "summer",
      "treat"
    ],
    "ambience_features": [
      "greenery",
      "outdoor setting",
      "planters"
    ],
    "thumbnail_rank": 0.85
  }
]
```
Raw response for image_id 19e87061-92f9-40d3-bc6b-66281ba8ac04:
```json
[
  {
    "image_id": "19e87061-92f9-40d3-bc6b-66281ba8ac04",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand holding a multi-colored soft-serve ice cream cone against a blurred background of greenery and neutral-colored planters. The ice cream has layers of pink, orange, yellow, light blue, and white. The cone is wrapped in a white paper with pink dots. The hand has bright pink nail polish.",
      "confidence": 0.98,
      "quality": 0.95,
      "appeal_score": 0.9
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.99
      },
      {
        "name": "soft serve",
        "confidence": 0.98
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "soft serve",
      "cone",
      "dessert",
      "sweet",
      "colorful",
      "hand",
      "summer",
      "treat"
    ],
    "ambience_features": [
      "greenery",
      "outdoor setting",
      "planters"
    ],
    "thumbnail_rank": 0.85
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 19e87061-92f9-40d3-bc6b-66281ba8ac04:
[
  {
    "image_id": "19e87061-92f9-40d3-bc6b-66281ba8ac04",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand holding a multi-colored soft-serve ice cream cone against a blurred background of greenery and neutral-colored planters. The ice cream has layers of pink, orange, yellow, light blue, and white. The cone is wrapped in a white paper with pink dots. The hand has bright pink nail polish.",
      "confidence": 0.98,
      "quality": 0.95,
      "appeal_score": 0.9
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.99
      },
      {
        "name": "soft serve",
        "confidence": 0.98
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "soft serve",
      "cone",
      "dessert",
      "sweet",
      "colorful",
      "hand",
      "summer",
      "treat"
    ],
    "ambience_features": [
      "greenery",
      "outdoor setting",
      "planters"
    ],
    "thumbnail_rank": 0.85
  }
]
Cleaned response for image_id 19e87061-92f9-40d3-bc6b-66281ba8ac04:
[
  {
    "image_id": "19e87061-92f9-40d3-bc6b-66281ba8ac04",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand holding a multi-colored soft-serve ice cream cone against a blurred background of greenery and neutral-colored planters. The ice cream has layers of pink, orange, yellow, light blue, and white. The cone is wrapped in a white paper with pink dots. The hand has bright pink nail polish.",
      "confidence": 0.98,
      "quality": 0.95,
      "appeal_score": 0.9
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.99
      },
      {
        "name": "soft serve",
        "confidence": 0.98
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "soft serve",
      "cone",
      "dessert",
      "sweet",
      "colorful",
      "hand",
      "summer",
      "treat"
    ],
    "ambience_features": [
      "greenery",
      "outdoor setting",
      "planters"
    ],
    "thumbnail_rank": 0.85
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 19e87061-92f9-40d3-bc6b-66281ba8ac04, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Aggregated quality_score: 0.95
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D2DE290>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D2DEA10>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:52:31 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: 28164788-3635-4ab5-afbb-a2b4580fbe84
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.95, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.57, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:52:32] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Chaman Icecream', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 200.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'best icecream', 'hashtags': ['family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:root:Analyzing image with image_id: 7922828e-d4e7-4286-8c15-011bc5b62c05
DEBUG:root:Raw Gemini response for image_id 7922828e-d4e7-4286-8c15-011bc5b62c05:
```json
[
  {
    "image_id": "7922828e-d4e7-4286-8c15-011bc5b62c05",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand holds a colorful soft-serve ice cream cone with multiple swirled layers of pink, orange, yellow, and blue. The ice cream is in a waffle cone wrapped with a pink and white patterned paper. The background is blurred with green foliage and large planters.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.9
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.98
      },
      {
        "name": "soft serve",
        "confidence": 0.95
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "dessert",
      "sweet",
      "treat",
      "colorful",
      "summer",
      "refreshing"
    ],
    "ambience_features": [
      "outdoor",
      "natural light",
      "greenery"
    ],
    "thumbnail_rank": 1.0
  }
]
```
Raw response for image_id 7922828e-d4e7-4286-8c15-011bc5b62c05:
```json
[
  {
    "image_id": "7922828e-d4e7-4286-8c15-011bc5b62c05",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand holds a colorful soft-serve ice cream cone with multiple swirled layers of pink, orange, yellow, and blue. The ice cream is in a waffle cone wrapped with a pink and white patterned paper. The background is blurred with green foliage and large planters.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.9
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.98
      },
      {
        "name": "soft serve",
        "confidence": 0.95
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "dessert",
      "sweet",
      "treat",
      "colorful",
      "summer",
      "refreshing"
    ],
    "ambience_features": [
      "outdoor",
      "natural light",
      "greenery"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 7922828e-d4e7-4286-8c15-011bc5b62c05:
[
  {
    "image_id": "7922828e-d4e7-4286-8c15-011bc5b62c05",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand holds a colorful soft-serve ice cream cone with multiple swirled layers of pink, orange, yellow, and blue. The ice cream is in a waffle cone wrapped with a pink and white patterned paper. The background is blurred with green foliage and large planters.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.9
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.98
      },
      {
        "name": "soft serve",
        "confidence": 0.95
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "dessert",
      "sweet",
      "treat",
      "colorful",
      "summer",
      "refreshing"
    ],
    "ambience_features": [
      "outdoor",
      "natural light",
      "greenery"
    ],
    "thumbnail_rank": 1.0
  }
]
Cleaned response for image_id 7922828e-d4e7-4286-8c15-011bc5b62c05:
[
  {
    "image_id": "7922828e-d4e7-4286-8c15-011bc5b62c05",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand holds a colorful soft-serve ice cream cone with multiple swirled layers of pink, orange, yellow, and blue. The ice cream is in a waffle cone wrapped with a pink and white patterned paper. The background is blurred with green foliage and large planters.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.9
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.98
      },
      {
        "name": "soft serve",
        "confidence": 0.95
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "dessert",
      "sweet",
      "treat",
      "colorful",
      "summer",
      "refreshing"
    ],
    "ambience_features": [
      "outdoor",
      "natural light",
      "greenery"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
