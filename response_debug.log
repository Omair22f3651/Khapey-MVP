Raw response for image_id d0bb4be4-a31b-4c56-abe0-44760a193cf4:
```json
[
  {
    "image_id": "d0bb4be4-a31b-4c56-abe0-44760a193cf4",
    "scene": "dish_closeup",
    "visual": {
      "description": "A plate with a large puffy bread, likely a puri, placed on top of something. On the side, there are two portions of food, one appears to be a minced meat curry and the other is a bright orange item, possibly a sweet vegetable or fruit.",
      "confidence": 0.85,
      "quality": 0.4,
      "appeal_score": 0.3
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.9
      },
      {
        "name": "minced meat curry",
        "confidence": 0.7
      },
      {
        "name": "sweet vegetable",
        "confidence": 0.6
      }
    ],
    "flag_type": "low_appeal",
    "penalty_score": 20,
    "keywords": [
      "puri",
      "curry",
      "sweet",
      "fried"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
Cleaned response for image_id d0bb4be4-a31b-4c56-abe0-44760a193cf4:
[
  {
    "image_id": "d0bb4be4-a31b-4c56-abe0-44760a193cf4",
    "scene": "dish_closeup",
    "visual": {
      "description": "A plate with a large puffy bread, likely a puri, placed on top of something. On the side, there are two portions of food, one appears to be a minced meat curry and the other is a bright orange item, possibly a sweet vegetable or fruit.",
      "confidence": 0.85,
      "quality": 0.4,
      "appeal_score": 0.3
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.9
      },
      {
        "name": "minced meat curry",
        "confidence": 0.7
      },
      {
        "name": "sweet vegetable",
        "confidence": 0.6
      }
    ],
    "flag_type": "low_appeal",
    "penalty_score": 20,
    "keywords": [
      "puri",
      "curry",
      "sweet",
      "fried"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
==================================================
Raw response for image_id bc479117-81f1-4c32-b29d-ec4887e0f69e:
```json
[
  {
    "image_id": "bc479117-81f1-4c32-b29d-ec4887e0f69e",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish served on a white plate. The dish features a puffy fried bread, possibly puri, placed on top of a portion of meat and vegetable curry. There are also some pieces of cooked carrots or sweet potatoes on the side. The lighting is warm and the food appears to be freshly prepared.",
      "confidence": 0.85,
      "quality": 0.70,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "Puri",
        "confidence": 0.90
      },
      {
        "name": "Keema Curry",
        "confidence": 0.75
      },
      {
        "name": "Carrot Sabzi",
        "confidence": 0.65
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "puri",
      "keema",
      "curry",
      "sabzi",
      "fried bread",
      "traditional"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
Cleaned response for image_id bc479117-81f1-4c32-b29d-ec4887e0f69e:
[
  {
    "image_id": "bc479117-81f1-4c32-b29d-ec4887e0f69e",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish served on a white plate. The dish features a puffy fried bread, possibly puri, placed on top of a portion of meat and vegetable curry. There are also some pieces of cooked carrots or sweet potatoes on the side. The lighting is warm and the food appears to be freshly prepared.",
      "confidence": 0.85,
      "quality": 0.70,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "Puri",
        "confidence": 0.90
      },
      {
        "name": "Keema Curry",
        "confidence": 0.75
      },
      {
        "name": "Carrot Sabzi",
        "confidence": 0.65
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "puri",
      "keema",
      "curry",
      "sabzi",
      "fried bread",
      "traditional"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
==================================================
Raw response for image_id 91e4319f-ea37-4cfa-b68f-fc480b826ddd:
```json
[
  {
    "image_id": "91e4319f-ea37-4cfa-b68f-fc480b826ddd",
    "scene": "dish_closeup",
    "visual": {
      "description": "A plate of food featuring a large, puffy flatbread served alongside what appears to be a minced meat dish and some pieces of cooked fruit or vegetables.",
      "confidence": 0.85,
      "quality": 0.3,
      "appeal_score": 0.4
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "Puri",
        "confidence": 0.9
      },
      {
        "name": "Keema",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "keema",
      "pakistani food",
      "flatbread",
      "minced meat"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
Cleaned response for image_id 91e4319f-ea37-4cfa-b68f-fc480b826ddd:
[
  {
    "image_id": "91e4319f-ea37-4cfa-b68f-fc480b826ddd",
    "scene": "dish_closeup",
    "visual": {
      "description": "A plate of food featuring a large, puffy flatbread served alongside what appears to be a minced meat dish and some pieces of cooked fruit or vegetables.",
      "confidence": 0.85,
      "quality": 0.3,
      "appeal_score": 0.4
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "Puri",
        "confidence": 0.9
      },
      {
        "name": "Keema",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "keema",
      "pakistani food",
      "flatbread",
      "minced meat"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
==================================================
Raw response for image_id d791553d-4850-4d63-8c53-1307c527e3ce:
```json
[
  {
    "image_id": "d791553d-4850-4d63-8c53-1307c527e3ce",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish featuring a golden-brown, puffed bread (puri) placed on top of what appears to be a serving of meat and vegetable curry. There are also slices of orange-colored fruit or vegetable on the side. The lighting is warm and somewhat dim, and the focus is on the food.",
      "confidence": 0.9,
      "quality": 0.6,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.95
      },
      {
        "name": "meat curry",
        "confidence": 0.7
      },
      {
        "name": "vegetable curry",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "pakistani food",
      "curry",
      "indian subcontinent",
      "breakfast",
      "snack"
    ],
    "ambience_features": [
      "warm lighting"
    ],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
Cleaned response for image_id d791553d-4850-4d63-8c53-1307c527e3ce:
[
  {
    "image_id": "d791553d-4850-4d63-8c53-1307c527e3ce",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish featuring a golden-brown, puffed bread (puri) placed on top of what appears to be a serving of meat and vegetable curry. There are also slices of orange-colored fruit or vegetable on the side. The lighting is warm and somewhat dim, and the focus is on the food.",
      "confidence": 0.9,
      "quality": 0.6,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.95
      },
      {
        "name": "meat curry",
        "confidence": 0.7
      },
      {
        "name": "vegetable curry",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "pakistani food",
      "curry",
      "indian subcontinent",
      "breakfast",
      "snack"
    ],
    "ambience_features": [
      "warm lighting"
    ],
    "thumbnail_rank": 0.8
  }
]
==================================================
Raw response for image_id 81917591-052a-4ccb-b42e-bf0106efbb6a:
```json
[
  {
    "image_id": "81917591-052a-4ccb-b42e-bf0106efbb6a",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a plate with what appears to be a large fried puri or bhatura, served with a side of what could be kheema (minced meat) and some apricot curry or sabzi.",
      "confidence": 0.85,
      "quality": 0.6,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.9
      },
      {
        "name": "kheema",
        "confidence": 0.75
      },
      {
        "name": "sabzi",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "kheema",
      "sabzi",
      "pakistani food",
      "fried bread",
      "minced meat",
      "curry"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
Cleaned response for image_id 81917591-052a-4ccb-b42e-bf0106efbb6a:
[
  {
    "image_id": "81917591-052a-4ccb-b42e-bf0106efbb6a",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a plate with what appears to be a large fried puri or bhatura, served with a side of what could be kheema (minced meat) and some apricot curry or sabzi.",
      "confidence": 0.85,
      "quality": 0.6,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.9
      },
      {
        "name": "kheema",
        "confidence": 0.75
      },
      {
        "name": "sabzi",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "kheema",
      "sabzi",
      "pakistani food",
      "fried bread",
      "minced meat",
      "curry"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
==================================================
Raw response for image_id f4679049-d645-4041-b354-65356b628bb4:
```json
[
  {
    "image_id": "f4679049-d645-4041-b354-65356b628bb4",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a large, juicy cheeseburger wrapped in foil. The burger is stacked with two beef patties, melted cheese, and a sprinkle of lettuce, all on a sesame seed bun. The cheese appears to be a vibrant orange cheddar. The background is blurred, showing what looks like a casual dining environment with other people and food items.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "cheeseburger",
        "confidence": 0.98
      },
      {
        "name": "burger",
        "confidence": 0.99
      },
      {
        "name": "fries",
        "confidence": 0.30
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "cheeseburger",
      "beef patty",
      "melted cheese",
      "sesame bun",
      "fast food",
      "street food"
    ],
    "ambience_features": [
      "casual dining",
      "food court"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
Cleaned response for image_id f4679049-d645-4041-b354-65356b628bb4:
[
  {
    "image_id": "f4679049-d645-4041-b354-65356b628bb4",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a large, juicy cheeseburger wrapped in foil. The burger is stacked with two beef patties, melted cheese, and a sprinkle of lettuce, all on a sesame seed bun. The cheese appears to be a vibrant orange cheddar. The background is blurred, showing what looks like a casual dining environment with other people and food items.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "cheeseburger",
        "confidence": 0.98
      },
      {
        "name": "burger",
        "confidence": 0.99
      },
      {
        "name": "fries",
        "confidence": 0.30
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "cheeseburger",
      "beef patty",
      "melted cheese",
      "sesame bun",
      "fast food",
      "street food"
    ],
    "ambience_features": [
      "casual dining",
      "food court"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
Raw response for image_id 900f24c4-83e6-4e22-9a8a-9b984e9ffd1f:
[
  {
    "image_id": "900f24c4-83e6-4e22-9a8a-9b984e9ffd1f",
    "scene": "ambiance",
    "visual": {
      "description": "A behind-the-scenes look at a Pakistani restaurant kitchen, with chefs in white uniforms preparing food. Shelves filled with round, wooden containers are visible, suggesting they might be used for steaming or serving.",
      "confidence": 0.95,
      "quality": 0.85,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {"name": "chef", "confidence": 0.99},
      {"name": "tomatoes", "confidence": 0.75},
      {"name": "kitchen", "confidence": 0.98}
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": ["kitchen", "chefs", "pakistani food", "restaurant", "preparation", "steaming", "wooden containers", "tomatoes", "behind the scenes"],
    "ambience_features": ["warm lighting", "clean kitchen", "organized shelves"],
    "thumbnail_rank": 1.0
  }
]
==================================================
Cleaned response for image_id 900f24c4-83e6-4e22-9a8a-9b984e9ffd1f:
[
  {
    "image_id": "900f24c4-83e6-4e22-9a8a-9b984e9ffd1f",
    "scene": "ambiance",
    "visual": {
      "description": "A behind-the-scenes look at a Pakistani restaurant kitchen, with chefs in white uniforms preparing food. Shelves filled with round, wooden containers are visible, suggesting they might be used for steaming or serving.",
      "confidence": 0.95,
      "quality": 0.85,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {"name": "chef", "confidence": 0.99},
      {"name": "tomatoes", "confidence": 0.75},
      {"name": "kitchen", "confidence": 0.98}
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": ["kitchen", "chefs", "pakistani food", "restaurant", "preparation", "steaming", "wooden containers", "tomatoes", "behind the scenes"],
    "ambience_features": ["warm lighting", "clean kitchen", "organized shelves"],
    "thumbnail_rank": 1.0
  }
]
==================================================
Raw response for image_id 18f791cd-1428-4a53-bca6-b5f073cd1587:
```json
[
  {
    "image_id": "18f791cd-1428-4a53-bca6-b5f073cd1587",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a rich, spicy curry dish, likely chicken karahi, served in a stainless steel bowl. The curry is a deep reddish-orange color, with visible pieces of tender chicken. It is garnished with fresh green chilies and chopped cilantro. A portion of naan bread is visible in the lower right corner.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.92
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "chicken karahi",
        "confidence": 0.90
      },
      {
        "name": "naan",
        "confidence": 0.75
      },
      {
        "name": "cilantro",
        "confidence": 0.85
      },
      {
        "name": "green chili",
        "confidence": 0.80
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "chicken",
      "spicy",
      "traditional",
      "pakistani food",
      "main course"
    ],
    "ambience_features": [
      "close-up",
      "appetizing"
    ],
    "thumbnail_rank": 0.85
  }
]
```
==================================================
Cleaned response for image_id 18f791cd-1428-4a53-bca6-b5f073cd1587:
[
  {
    "image_id": "18f791cd-1428-4a53-bca6-b5f073cd1587",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a rich, spicy curry dish, likely chicken karahi, served in a stainless steel bowl. The curry is a deep reddish-orange color, with visible pieces of tender chicken. It is garnished with fresh green chilies and chopped cilantro. A portion of naan bread is visible in the lower right corner.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.92
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "chicken karahi",
        "confidence": 0.90
      },
      {
        "name": "naan",
        "confidence": 0.75
      },
      {
        "name": "cilantro",
        "confidence": 0.85
      },
      {
        "name": "green chili",
        "confidence": 0.80
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "chicken",
      "spicy",
      "traditional",
      "pakistani food",
      "main course"
    ],
    "ambience_features": [
      "close-up",
      "appetizing"
    ],
    "thumbnail_rank": 0.85
  }
]
==================================================
Raw response for image_id 6080c71b-4b80-4dd5-99d1-b74b154821a8:
```json
[
  {
    "image_id": "6080c71b-4b80-4dd5-99d1-b74b154821a8",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a traditional Pakistani dish, likely chicken karahi, served in a metal bowl. The dish features tender pieces of chicken coated in a rich, spiced tomato-based gravy. Sliced green chilies and fresh cilantro are used as garnishes, adding a vibrant touch. A piece of naan bread is visible in the lower right corner.",
      "confidence": 0.95,
      "quality": 0.92,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "chicken karahi",
        "confidence": 0.90
      },
      {
        "name": "naan",
        "confidence": 0.75
      },
      {
        "name": "cilantro",
        "confidence": 0.88
      },
      {
        "name": "green chilies",
        "confidence": 0.80
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "chicken",
      "karahi",
      "spicy",
      "tomato gravy",
      "cilantro",
      "naan",
      "traditional"
    ],
    "ambience_features": [],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
Cleaned response for image_id 6080c71b-4b80-4dd5-99d1-b74b154821a8:
[
  {
    "image_id": "6080c71b-4b80-4dd5-99d1-b74b154821a8",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a traditional Pakistani dish, likely chicken karahi, served in a metal bowl. The dish features tender pieces of chicken coated in a rich, spiced tomato-based gravy. Sliced green chilies and fresh cilantro are used as garnishes, adding a vibrant touch. A piece of naan bread is visible in the lower right corner.",
      "confidence": 0.95,
      "quality": 0.92,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "chicken karahi",
        "confidence": 0.90
      },
      {
        "name": "naan",
        "confidence": 0.75
      },
      {
        "name": "cilantro",
        "confidence": 0.88
      },
      {
        "name": "green chilies",
        "confidence": 0.80
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "chicken",
      "karahi",
      "spicy",
      "tomato gravy",
      "cilantro",
      "naan",
      "traditional"
    ],
    "ambience_features": [],
    "thumbnail_rank": 1.0
  }
]
==================================================
Raw response for image_id 0de788f5-4f50-49f6-abea-02565894a300:
```json
[
  {
    "image_id": "0de788f5-4f50-49f6-abea-02565894a300",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a large, messy cheeseburger wrapped in foil. The burger has two patties, melted cheese, and appears to be topped with some kind of sauce and possibly chopped onions. The sesame seed bun is slightly golden. The burger is held in a hand, and another hand holding a similar burger is visible in the background.",
      "confidence": 0.9,
      "quality": 0.8,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "cheeseburger",
        "confidence": 0.95
      },
      {
        "name": "burger",
        "confidence": 0.98
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "cheeseburger",
      "fast food",
      "sandwich",
      "patties",
      "cheese",
      "messy",
      "foil"
    ],
    "ambience_features": [
      "indoor seating",
      "casual dining"
    ],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
Cleaned response for image_id 0de788f5-4f50-49f6-abea-02565894a300:
[
  {
    "image_id": "0de788f5-4f50-49f6-abea-02565894a300",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a large, messy cheeseburger wrapped in foil. The burger has two patties, melted cheese, and appears to be topped with some kind of sauce and possibly chopped onions. The sesame seed bun is slightly golden. The burger is held in a hand, and another hand holding a similar burger is visible in the background.",
      "confidence": 0.9,
      "quality": 0.8,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "cheeseburger",
        "confidence": 0.95
      },
      {
        "name": "burger",
        "confidence": 0.98
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "cheeseburger",
      "fast food",
      "sandwich",
      "patties",
      "cheese",
      "messy",
      "foil"
    ],
    "ambience_features": [
      "indoor seating",
      "casual dining"
    ],
    "thumbnail_rank": 0.8
  }
]
==================================================
Raw response for image_id 6fa1cf3d-8cfb-4d2a-8134-21cdb4666e6a:
```json
[
  {
    "image_id": "6fa1cf3d-8cfb-4d2a-8134-21cdb4666e6a",
    "scene": "ambiance",
    "visual": {
      "description": "The exterior of a modern burger joint called 'BRIM BIG JUICY BURGERS'. The storefront features large glass windows, a black facade with prominent white signage, and outdoor seating.",
      "confidence": 0.95,
      "quality": 0.85,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "burger joint",
        "confidence": 0.9
      },
      {
        "name": "coffee shop",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "restaurant",
      "exterior",
      "brim",
      "big juicy burgers",
      "coffee",
      "pakistani food"
    ],
    "ambience_features": [
      "modern",
      "outdoor seating",
      "street view"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
Cleaned response for image_id 6fa1cf3d-8cfb-4d2a-8134-21cdb4666e6a:
[
  {
    "image_id": "6fa1cf3d-8cfb-4d2a-8134-21cdb4666e6a",
    "scene": "ambiance",
    "visual": {
      "description": "The exterior of a modern burger joint called 'BRIM BIG JUICY BURGERS'. The storefront features large glass windows, a black facade with prominent white signage, and outdoor seating.",
      "confidence": 0.95,
      "quality": 0.85,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "burger joint",
        "confidence": 0.9
      },
      {
        "name": "coffee shop",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "restaurant",
      "exterior",
      "brim",
      "big juicy burgers",
      "coffee",
      "pakistani food"
    ],
    "ambience_features": [
      "modern",
      "outdoor seating",
      "street view"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
Raw response for image_id 2dce49c4-d693-4c71-a573-dd56cd7e7837:
```json
[
  {
    "image_id": "2dce49c4-d693-4c71-a573-dd56cd7e7837",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a double-patty cheeseburger, generously topped with melted orange cheese and visible pickles. The burger is wrapped in aluminum foil, with a sesame seed bun. The background is blurred, showing what appears to be an indoor restaurant setting with people and kitchen equipment.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "burger",
        "confidence": 0.98
      },
      {
        "name": "cheeseburger",
        "confidence": 0.92
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "cheeseburger",
      "fast food",
      "double patty",
      "cheese",
      "pickles",
      "sesame bun",
      "foil wrap"
    ],
    "ambience_features": [
      "indoor",
      "restaurant"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
Cleaned response for image_id 2dce49c4-d693-4c71-a573-dd56cd7e7837:
[
  {
    "image_id": "2dce49c4-d693-4c71-a573-dd56cd7e7837",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a double-patty cheeseburger, generously topped with melted orange cheese and visible pickles. The burger is wrapped in aluminum foil, with a sesame seed bun. The background is blurred, showing what appears to be an indoor restaurant setting with people and kitchen equipment.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "burger",
        "confidence": 0.98
      },
      {
        "name": "cheeseburger",
        "confidence": 0.92
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "cheeseburger",
      "fast food",
      "double patty",
      "cheese",
      "pickles",
      "sesame bun",
      "foil wrap"
    ],
    "ambience_features": [
      "indoor",
      "restaurant"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
Raw response for image_id 6f86fac1-1963-4fd7-b7a9-4f4fdcf170c7:
```json
[
  {
    "image_id": "6f86fac1-1963-4fd7-b7a9-4f4fdcf170c7",
    "scene": "beverage",
    "visual": {
      "description": "A hand holding a clear plastic cup filled with peach ice tea. The cup has a circular sticker with a peach logo and the text 'PEACHED ICE TEA' and 'BRIM'. A white straw is inserted into the drink. In the background, a sign with bright neon lights says 'WE SMASH IT RIGHT'. There are also some food items wrapped in foil and packets of condiments on a table.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "peach ice tea",
        "confidence": 0.98
      },
      {
        "name": "burger",
        "confidence": 0.65
      },
      {
        "name": "ketchup packet",
        "confidence": 0.70
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice tea",
      "peach",
      "drink",
      "beverage",
      "neon lights",
      "restaurant",
      "casual dining"
    ],
    "ambience_features": [
      "modern",
      "lit",
      "energetic"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
Cleaned response for image_id 6f86fac1-1963-4fd7-b7a9-4f4fdcf170c7:
[
  {
    "image_id": "6f86fac1-1963-4fd7-b7a9-4f4fdcf170c7",
    "scene": "beverage",
    "visual": {
      "description": "A hand holding a clear plastic cup filled with peach ice tea. The cup has a circular sticker with a peach logo and the text 'PEACHED ICE TEA' and 'BRIM'. A white straw is inserted into the drink. In the background, a sign with bright neon lights says 'WE SMASH IT RIGHT'. There are also some food items wrapped in foil and packets of condiments on a table.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "peach ice tea",
        "confidence": 0.98
      },
      {
        "name": "burger",
        "confidence": 0.65
      },
      {
        "name": "ketchup packet",
        "confidence": 0.70
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice tea",
      "peach",
      "drink",
      "beverage",
      "neon lights",
      "restaurant",
      "casual dining"
    ],
    "ambience_features": [
      "modern",
      "lit",
      "energetic"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002C1369FF910>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002C1368D16D0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002C137717C50>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:19:14 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001F0974D4C90>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001F0FFA716D0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001F0FFD13190>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:19:21 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 120-019-553
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:20:31] "[35m[1mGET / HTTP/1.1[0m" 500 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:20:31] "GET /?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:20:31] "GET /?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:20:32] "GET /?__debugger__=yes&cmd=resource&f=console.png&s=Rb8S8BsTSJHbkNm5KdHK HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:20:32] "GET /?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1" 200 -
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001FB7A980150>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001FB7A78D6D0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001FB7A903210>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:21:09 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002A241543B90>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002A2412416D0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002A24208D3D0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:21:16 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 120-019-553
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:21:16] "[35m[1mGET / HTTP/1.1[0m" 500 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:21:16] "[36mGET /?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1[0m" 304 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:21:16] "[36mGET /?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1[0m" 304 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:21:16] "GET /?__debugger__=yes&cmd=resource&f=console.png&s=vIePINoM9QgzR4j4piDW HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:21:17] "[36mGET /?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1[0m" 304 -
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001FA3F39A590>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001FA3F0696D0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001FA3F2FF650>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:21:56 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000013894177D50>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000138941616D0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000013894FB03D0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:22:03 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 120-019-553
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:22:04] "GET / HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:22:05] "[33mGET /favicon.ico HTTP/1.1[0m" 404 -
DEBUG:root:Review data prepared: {'restaurantName': 'Karachi Darbar', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 1500.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'Amazing chicken karahi with perfect spice level!', 'hashtags': ['karahi', 'spicy', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:PIL.Image:Importing BlpImagePlugin
DEBUG:PIL.Image:Importing BmpImagePlugin
DEBUG:PIL.Image:Importing BufrStubImagePlugin
DEBUG:PIL.Image:Importing CurImagePlugin
DEBUG:PIL.Image:Importing DcxImagePlugin
DEBUG:PIL.Image:Importing DdsImagePlugin
DEBUG:PIL.Image:Importing EpsImagePlugin
DEBUG:PIL.Image:Importing FitsImagePlugin
DEBUG:PIL.Image:Importing FliImagePlugin
DEBUG:PIL.Image:Importing FpxImagePlugin
DEBUG:PIL.Image:Image: failed to import FpxImagePlugin: No module named 'olefile'
DEBUG:PIL.Image:Importing FtexImagePlugin
DEBUG:PIL.Image:Importing GbrImagePlugin
DEBUG:PIL.Image:Importing GifImagePlugin
DEBUG:PIL.Image:Importing GribStubImagePlugin
DEBUG:PIL.Image:Importing Hdf5StubImagePlugin
DEBUG:PIL.Image:Importing IcnsImagePlugin
DEBUG:PIL.Image:Importing IcoImagePlugin
DEBUG:PIL.Image:Importing ImImagePlugin
DEBUG:PIL.Image:Importing ImtImagePlugin
DEBUG:PIL.Image:Importing IptcImagePlugin
DEBUG:PIL.Image:Importing JpegImagePlugin
DEBUG:PIL.Image:Importing Jpeg2KImagePlugin
DEBUG:PIL.Image:Importing McIdasImagePlugin
DEBUG:PIL.Image:Importing MicImagePlugin
DEBUG:PIL.Image:Image: failed to import MicImagePlugin: No module named 'olefile'
DEBUG:PIL.Image:Importing MpegImagePlugin
DEBUG:PIL.Image:Importing MpoImagePlugin
DEBUG:PIL.Image:Importing MspImagePlugin
DEBUG:PIL.Image:Importing PalmImagePlugin
DEBUG:PIL.Image:Importing PcdImagePlugin
DEBUG:PIL.Image:Importing PcxImagePlugin
DEBUG:PIL.Image:Importing PdfImagePlugin
DEBUG:PIL.Image:Importing PixarImagePlugin
DEBUG:PIL.Image:Importing PngImagePlugin
DEBUG:PIL.Image:Importing PpmImagePlugin
DEBUG:PIL.Image:Importing PsdImagePlugin
DEBUG:PIL.Image:Importing QoiImagePlugin
DEBUG:PIL.Image:Importing SgiImagePlugin
DEBUG:PIL.Image:Importing SpiderImagePlugin
DEBUG:PIL.Image:Importing SunImagePlugin
DEBUG:PIL.Image:Importing TgaImagePlugin
DEBUG:PIL.Image:Importing TiffImagePlugin
DEBUG:PIL.Image:Importing WebPImagePlugin
DEBUG:PIL.Image:Importing WmfImagePlugin
DEBUG:PIL.Image:Importing XbmImagePlugin
DEBUG:PIL.Image:Importing XpmImagePlugin
DEBUG:PIL.Image:Importing XVThumbImagePlugin
DEBUG:root:Analyzing image with image_id: 04ec48a3-d44b-422d-8459-50de27bab1db
DEBUG:root:Review data prepared: {'restaurantName': 'Karachi Darbar', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 1500.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'Amazing chicken karahi with perfect spice level!', 'hashtags': ['karahi', 'spicy', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:root:Analyzing image with image_id: 75cbd6a6-4e60-4bf6-9960-b46a9a8a22ad
DEBUG:root:Raw Gemini response for image_id 04ec48a3-d44b-422d-8459-50de27bab1db:
```json
[
  {
    "image_id": "04ec48a3-d44b-422d-8459-50de27bab1db",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand is using a ladle to stir a rich, golden broth in a large, ornate copper pot. The pot has intricate engravings and is placed on a foil base, suggesting it's being kept warm. The broth appears to be a savory, potentially meaty stew or curry.",
      "confidence": 0.9,
      "quality": 0.7,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.8
      },
      {
        "name": "stew",
        "confidence": 0.75
      },
      {
        "name": "nihari",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "copper pot",
      "ladle",
      "broth",
      "stew",
      "curry",
      "Pakistani food",
      "traditional",
      "warm"
    ],
    "ambience_features": [
      "ornate",
      "traditional"
    ],
    "thumbnail_rank": 0.8
  }
]
```
Raw response for image_id 04ec48a3-d44b-422d-8459-50de27bab1db:
```json
[
  {
    "image_id": "04ec48a3-d44b-422d-8459-50de27bab1db",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand is using a ladle to stir a rich, golden broth in a large, ornate copper pot. The pot has intricate engravings and is placed on a foil base, suggesting it's being kept warm. The broth appears to be a savory, potentially meaty stew or curry.",
      "confidence": 0.9,
      "quality": 0.7,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.8
      },
      {
        "name": "stew",
        "confidence": 0.75
      },
      {
        "name": "nihari",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "copper pot",
      "ladle",
      "broth",
      "stew",
      "curry",
      "Pakistani food",
      "traditional",
      "warm"
    ],
    "ambience_features": [
      "ornate",
      "traditional"
    ],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 04ec48a3-d44b-422d-8459-50de27bab1db:
[
  {
    "image_id": "04ec48a3-d44b-422d-8459-50de27bab1db",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand is using a ladle to stir a rich, golden broth in a large, ornate copper pot. The pot has intricate engravings and is placed on a foil base, suggesting it's being kept warm. The broth appears to be a savory, potentially meaty stew or curry.",
      "confidence": 0.9,
      "quality": 0.7,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.8
      },
      {
        "name": "stew",
        "confidence": 0.75
      },
      {
        "name": "nihari",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "copper pot",
      "ladle",
      "broth",
      "stew",
      "curry",
      "Pakistani food",
      "traditional",
      "warm"
    ],
    "ambience_features": [
      "ornate",
      "traditional"
    ],
    "thumbnail_rank": 0.8
  }
]
Cleaned response for image_id 04ec48a3-d44b-422d-8459-50de27bab1db:
[
  {
    "image_id": "04ec48a3-d44b-422d-8459-50de27bab1db",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand is using a ladle to stir a rich, golden broth in a large, ornate copper pot. The pot has intricate engravings and is placed on a foil base, suggesting it's being kept warm. The broth appears to be a savory, potentially meaty stew or curry.",
      "confidence": 0.9,
      "quality": 0.7,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.8
      },
      {
        "name": "stew",
        "confidence": 0.75
      },
      {
        "name": "nihari",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "copper pot",
      "ladle",
      "broth",
      "stew",
      "curry",
      "Pakistani food",
      "traditional",
      "warm"
    ],
    "ambience_features": [
      "ornate",
      "traditional"
    ],
    "thumbnail_rank": 0.8
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:root:Raw Gemini response for image_id 75cbd6a6-4e60-4bf6-9960-b46a9a8a22ad:
```json
[
  {
    "image_id": "75cbd6a6-4e60-4bf6-9960-b46a9a8a22ad",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a traditional copper pot with a ladle inside, containing a yellowish, oily curry or stew. The pot has intricate decorative carvings and is lined with foil at the bottom.",
      "confidence": 0.9,
      "quality": 0.7,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.7
      },
      {
        "name": "stew",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "copper pot",
      "curry",
      "stew",
      "traditional",
      "serving",
      "Pakistani food"
    ],
    "ambience_features": [
      "traditional cookware"
    ],
    "thumbnail_rank": 0.8
  }
]
```
Raw response for image_id 75cbd6a6-4e60-4bf6-9960-b46a9a8a22ad:
```json
[
  {
    "image_id": "75cbd6a6-4e60-4bf6-9960-b46a9a8a22ad",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a traditional copper pot with a ladle inside, containing a yellowish, oily curry or stew. The pot has intricate decorative carvings and is lined with foil at the bottom.",
      "confidence": 0.9,
      "quality": 0.7,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.7
      },
      {
        "name": "stew",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "copper pot",
      "curry",
      "stew",
      "traditional",
      "serving",
      "Pakistani food"
    ],
    "ambience_features": [
      "traditional cookware"
    ],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 75cbd6a6-4e60-4bf6-9960-b46a9a8a22ad:
[
  {
    "image_id": "75cbd6a6-4e60-4bf6-9960-b46a9a8a22ad",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a traditional copper pot with a ladle inside, containing a yellowish, oily curry or stew. The pot has intricate decorative carvings and is lined with foil at the bottom.",
      "confidence": 0.9,
      "quality": 0.7,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.7
      },
      {
        "name": "stew",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "copper pot",
      "curry",
      "stew",
      "traditional",
      "serving",
      "Pakistani food"
    ],
    "ambience_features": [
      "traditional cookware"
    ],
    "thumbnail_rank": 0.8
  }
]
Cleaned response for image_id 75cbd6a6-4e60-4bf6-9960-b46a9a8a22ad:
[
  {
    "image_id": "75cbd6a6-4e60-4bf6-9960-b46a9a8a22ad",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a traditional copper pot with a ladle inside, containing a yellowish, oily curry or stew. The pot has intricate decorative carvings and is lined with foil at the bottom.",
      "confidence": 0.9,
      "quality": 0.7,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.7
      },
      {
        "name": "stew",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "copper pot",
      "curry",
      "stew",
      "traditional",
      "serving",
      "Pakistani food"
    ],
    "ambience_features": [
      "traditional cookware"
    ],
    "thumbnail_rank": 0.8
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:root:Review data prepared: {'restaurantName': 'Karachi Darbar', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 1500.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'Amazing chicken karahi with perfect spice level!', 'hashtags': ['karahi', 'spicy', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:root:Analyzing image with image_id: bde3c2ab-0641-4cec-8708-a74902a8e615
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user HTTP/1.1" 307 0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user HTTP/1.1" 307 0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user/ HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user/ HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 04ec48a3-d44b-422d-8459-50de27bab1db, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Aggregated quality_score: 0.7
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 75cbd6a6-4e60-4bf6-9960-b46a9a8a22ad, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Aggregated quality_score: 0.7
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:root:Raw Gemini response for image_id bde3c2ab-0641-4cec-8708-a74902a8e615:
```json
[
  {
    "image_id": "bde3c2ab-0641-4cec-8708-a74902a8e615",
    "scene": "dish_closeup",
    "visual": {
      "description": "A traditional copper pot, often used for serving hearty stews, contains a rich, golden-brown curry. A hand is seen stirring the contents with a spoon, suggesting it's being served or prepared.",
      "confidence": 0.9,
      "quality": 0.75,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.85
      },
      {
        "name": "nihari",
        "confidence": 0.6
      },
      {
        "name": "haleem",
        "confidence": 0.5
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "stew",
      "copper pot",
      "traditional",
      "serving",
      "pakistani food"
    ],
    "ambience_features": [
      "warm lighting",
      "indoor setting",
      "traditional cookware"
    ],
    "thumbnail_rank": 1.0
  }
]
```
Raw response for image_id bde3c2ab-0641-4cec-8708-a74902a8e615:
```json
[
  {
    "image_id": "bde3c2ab-0641-4cec-8708-a74902a8e615",
    "scene": "dish_closeup",
    "visual": {
      "description": "A traditional copper pot, often used for serving hearty stews, contains a rich, golden-brown curry. A hand is seen stirring the contents with a spoon, suggesting it's being served or prepared.",
      "confidence": 0.9,
      "quality": 0.75,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.85
      },
      {
        "name": "nihari",
        "confidence": 0.6
      },
      {
        "name": "haleem",
        "confidence": 0.5
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "stew",
      "copper pot",
      "traditional",
      "serving",
      "pakistani food"
    ],
    "ambience_features": [
      "warm lighting",
      "indoor setting",
      "traditional cookware"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id bde3c2ab-0641-4cec-8708-a74902a8e615:
[
  {
    "image_id": "bde3c2ab-0641-4cec-8708-a74902a8e615",
    "scene": "dish_closeup",
    "visual": {
      "description": "A traditional copper pot, often used for serving hearty stews, contains a rich, golden-brown curry. A hand is seen stirring the contents with a spoon, suggesting it's being served or prepared.",
      "confidence": 0.9,
      "quality": 0.75,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.85
      },
      {
        "name": "nihari",
        "confidence": 0.6
      },
      {
        "name": "haleem",
        "confidence": 0.5
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "stew",
      "copper pot",
      "traditional",
      "serving",
      "pakistani food"
    ],
    "ambience_features": [
      "warm lighting",
      "indoor setting",
      "traditional cookware"
    ],
    "thumbnail_rank": 1.0
  }
]
Cleaned response for image_id bde3c2ab-0641-4cec-8708-a74902a8e615:
[
  {
    "image_id": "bde3c2ab-0641-4cec-8708-a74902a8e615",
    "scene": "dish_closeup",
    "visual": {
      "description": "A traditional copper pot, often used for serving hearty stews, contains a rich, golden-brown curry. A hand is seen stirring the contents with a spoon, suggesting it's being served or prepared.",
      "confidence": 0.9,
      "quality": 0.75,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.85
      },
      {
        "name": "nihari",
        "confidence": 0.6
      },
      {
        "name": "haleem",
        "confidence": 0.5
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "stew",
      "copper pot",
      "traditional",
      "serving",
      "pakistani food"
    ],
    "ambience_features": [
      "warm lighting",
      "indoor setting",
      "traditional cookware"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000013896523910>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000138941616D0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001389448B910>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000138941616D0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000138964B9FD0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000013896529310>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id bde3c2ab-0641-4cec-8708-a74902a8e615, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Aggregated quality_score: 0.75
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:22:30 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: 7358ad81-5ff3-40f4-956e-e528aebd03c8
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:22:30 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
DEBUG:root:Calculating reach...
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:root:Reach calculation - quality_score: 0.7, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.42, reach_level: Search-only (no feed distribution)
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:22:30] "POST /process_review HTTP/1.1" 200 -
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: fd403d47-7cfb-47c4-b338-d9ef6758f97a
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.7, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.42, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:22:30] "POST /process_review HTTP/1.1" 200 -
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000138FBE17D90>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000138941616D0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000138963CCC10>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:22:31] "[33mGET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1[0m" 404 -
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:22:31 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: da8a1091-7b39-42f1-a3b3-d82206f10145
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.75, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.44999999999999996, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:22:31] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: karahi, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'karahi' and search_type 'text'
DEBUG:root:Expanded synonyms for keywords ['karahi']: ['curry', 'stew']
DEBUG:root:Keywords: ['karahi'], Synonyms: ['curry', 'stew']
DEBUG:root:Generating text embedding for query 'karahi' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'karahi', length: 768
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000138965287D0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000138941616D0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000013896528350>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:23:02 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 6 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:23:06 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 5 keyword search results.
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.3393987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.06999999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.4253987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.075, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.4143987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.06999999999999999, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.22835820041666668, keyword_score: 0.3333333333333333, semantic_score: 0.036366135, quality_score: 0.088, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.85
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.2366582004166667, keyword_score: 0.3333333333333333, semantic_score: 0.036366135, quality_score: 0.092, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.109371238625, keyword_score: 0.0, semantic_score: 0.0092849545, quality_score: 0.08524999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.95
DEBUG:root:Search completed, returning 6 results.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:23:12] "POST /search HTTP/1.1" 200 -
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EE9EBAB7D0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001EE9E861F40> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EE9EB0F390>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:26:10 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 120-019-553
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:27:14] "GET / HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Chapli House', 'branchName': 'Johar town', 'serviceType': 'dineIn', 'totalBill': 1500.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'Best chapli kabab', 'hashtags': ['karahi', 'spicy', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:PIL.Image:Importing BlpImagePlugin
DEBUG:PIL.Image:Importing BmpImagePlugin
DEBUG:PIL.Image:Importing BufrStubImagePlugin
DEBUG:PIL.Image:Importing CurImagePlugin
DEBUG:PIL.Image:Importing DcxImagePlugin
DEBUG:PIL.Image:Importing DdsImagePlugin
DEBUG:PIL.Image:Importing EpsImagePlugin
DEBUG:PIL.Image:Importing FitsImagePlugin
DEBUG:PIL.Image:Importing FliImagePlugin
DEBUG:PIL.Image:Importing FpxImagePlugin
DEBUG:PIL.Image:Image: failed to import FpxImagePlugin: No module named 'olefile'
DEBUG:PIL.Image:Importing FtexImagePlugin
DEBUG:PIL.Image:Importing GbrImagePlugin
DEBUG:PIL.Image:Importing GifImagePlugin
DEBUG:PIL.Image:Importing GribStubImagePlugin
DEBUG:PIL.Image:Importing Hdf5StubImagePlugin
DEBUG:PIL.Image:Importing IcnsImagePlugin
DEBUG:PIL.Image:Importing IcoImagePlugin
DEBUG:PIL.Image:Importing ImImagePlugin
DEBUG:PIL.Image:Importing ImtImagePlugin
DEBUG:PIL.Image:Importing IptcImagePlugin
DEBUG:PIL.Image:Importing JpegImagePlugin
DEBUG:PIL.Image:Importing Jpeg2KImagePlugin
DEBUG:PIL.Image:Importing McIdasImagePlugin
DEBUG:PIL.Image:Importing MicImagePlugin
DEBUG:PIL.Image:Image: failed to import MicImagePlugin: No module named 'olefile'
DEBUG:PIL.Image:Importing MpegImagePlugin
DEBUG:PIL.Image:Importing MpoImagePlugin
DEBUG:PIL.Image:Importing MspImagePlugin
DEBUG:PIL.Image:Importing PalmImagePlugin
DEBUG:PIL.Image:Importing PcdImagePlugin
DEBUG:PIL.Image:Importing PcxImagePlugin
DEBUG:PIL.Image:Importing PdfImagePlugin
DEBUG:PIL.Image:Importing PixarImagePlugin
DEBUG:PIL.Image:Importing PngImagePlugin
DEBUG:PIL.Image:Importing PpmImagePlugin
DEBUG:PIL.Image:Importing PsdImagePlugin
DEBUG:PIL.Image:Importing QoiImagePlugin
DEBUG:PIL.Image:Importing SgiImagePlugin
DEBUG:PIL.Image:Importing SpiderImagePlugin
DEBUG:PIL.Image:Importing SunImagePlugin
DEBUG:PIL.Image:Importing TgaImagePlugin
DEBUG:PIL.Image:Importing TiffImagePlugin
DEBUG:PIL.Image:Importing WebPImagePlugin
DEBUG:PIL.Image:Importing WmfImagePlugin
DEBUG:PIL.Image:Importing XbmImagePlugin
DEBUG:PIL.Image:Importing XpmImagePlugin
DEBUG:PIL.Image:Importing XVThumbImagePlugin
DEBUG:root:Analyzing image with image_id: d5bea719-56bf-43c1-ad71-a05c9c365b86
DEBUG:root:Raw Gemini response for image_id d5bea719-56bf-43c1-ad71-a05c9c365b86:
```json
[
  {
    "image_id": "d5bea719-56bf-43c1-ad71-a05c9c365b86",
    "scene": "dish_closeup",
    "visual": {
      "description": "Several fried pakoras are arranged on a round griddle, with some appearing to be cooking in hot oil in the background.",
      "confidence": 0.9,
      "quality": 0.5,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.9
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "fried",
      "snack",
      "street food",
      "savory"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
```
Raw response for image_id d5bea719-56bf-43c1-ad71-a05c9c365b86:
```json
[
  {
    "image_id": "d5bea719-56bf-43c1-ad71-a05c9c365b86",
    "scene": "dish_closeup",
    "visual": {
      "description": "Several fried pakoras are arranged on a round griddle, with some appearing to be cooking in hot oil in the background.",
      "confidence": 0.9,
      "quality": 0.5,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.9
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "fried",
      "snack",
      "street food",
      "savory"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id d5bea719-56bf-43c1-ad71-a05c9c365b86:
[
  {
    "image_id": "d5bea719-56bf-43c1-ad71-a05c9c365b86",
    "scene": "dish_closeup",
    "visual": {
      "description": "Several fried pakoras are arranged on a round griddle, with some appearing to be cooking in hot oil in the background.",
      "confidence": 0.9,
      "quality": 0.5,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.9
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "fried",
      "snack",
      "street food",
      "savory"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
Cleaned response for image_id d5bea719-56bf-43c1-ad71-a05c9c365b86:
[
  {
    "image_id": "d5bea719-56bf-43c1-ad71-a05c9c365b86",
    "scene": "dish_closeup",
    "visual": {
      "description": "Several fried pakoras are arranged on a round griddle, with some appearing to be cooking in hot oil in the background.",
      "confidence": 0.9,
      "quality": 0.5,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.9
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "fried",
      "snack",
      "street food",
      "savory"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user HTTP/1.1" 307 0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user/ HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id d5bea719-56bf-43c1-ad71-a05c9c365b86, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Aggregated quality_score: 0.5
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EEA090F3D0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001EE9E861F40> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EEA090FF90>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:27:57 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: 240ce975-026d-4dbb-9360-54972a6ec3fb
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.5, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.3, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:27:57] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: chapli kabab, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'chapli kabab' and search_type 'text'
DEBUG:root:Expanded synonyms for keywords ['chapli', 'kabab']: []
DEBUG:root:Keywords: ['chapli', 'kabab'], Synonyms: []
DEBUG:root:Generating text embedding for query 'chapli kabab' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'chapli kabab', length: 768
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EEA0902750>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001EE9E861F40> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EEA0902910>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:28:16 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 7 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:28:19 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 0 keyword search results.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.10346392050000001, keyword_score: 0.0, semantic_score: 0.043855682, quality_score: 0.05, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.19314912, keyword_score: 0.0, semantic_score: 0.04259648, quality_score: 0.075, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.10714912000000001, keyword_score: 0.0, semantic_score: 0.04259648, quality_score: 0.06999999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.18214912, keyword_score: 0.0, semantic_score: 0.04259648, quality_score: 0.06999999999999999, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.1148670075, keyword_score: 0.0, semantic_score: 0.03126803, quality_score: 0.08524999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.95
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.11802490350000001, keyword_score: 0.0, semantic_score: 0.028499614, quality_score: 0.092, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.1097249035, keyword_score: 0.0, semantic_score: 0.028499614, quality_score: 0.088, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.85
DEBUG:root:Search completed, returning 7 results.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:28:23] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: chapli kabab, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'chapli kabab' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['chapli', 'kabab']: []
DEBUG:root:Keywords: ['chapli', 'kabab'], Synonyms: []
DEBUG:root:Generating text embedding for query 'chapli kabab' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'chapli kabab', length: 768
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EEA090D710>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001EE9E861F40> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EE9F14A190>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:28:36 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.failed exception=ReadTimeout(TimeoutError('The read operation timed out'))
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
ERROR:root:Error during search: The read operation timed out
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:28:45] "[35m[1mPOST /search HTTP/1.1[0m" 500 -
DEBUG:root:Search initiated with query: chapli kabab, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'chapli kabab' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['chapli', 'kabab']: []
DEBUG:root:Keywords: ['chapli', 'kabab'], Synonyms: []
DEBUG:root:Generating text embedding for query 'chapli kabab' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:root:Search initiated with query: chapli kabab, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'chapli kabab' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['chapli', 'kabab']: []
DEBUG:root:Keywords: ['chapli', 'kabab'], Synonyms: []
DEBUG:root:Generating text embedding for query 'chapli kabab' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'chapli kabab', length: 768
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EEA090C890>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001EE9E861F40> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'chapli kabab', length: 768
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EEA090E8D0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EEA090EB90>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001EE9E861F40> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:28:52 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EEA32BCD90>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:28:53 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:root:Search initiated with query: burger, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'burger' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['burger']: []
DEBUG:root:Keywords: ['burger'], Synonyms: []
DEBUG:root:Generating text embedding for query 'burger' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'burger', length: 768
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.failed exception=ConnectTimeout(TimeoutError('timed out'))
ERROR:root:Error during search: timed out
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:29:22] "[35m[1mPOST /search HTTP/1.1[0m" 500 -
DEBUG:httpcore.http11:receive_response_body.failed exception=ReadTimeout(TimeoutError('The read operation timed out'))
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
ERROR:root:Error during search: The read operation timed out
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:29:38] "[35m[1mPOST /search HTTP/1.1[0m" 500 -
DEBUG:httpcore.http11:receive_response_body.failed exception=ReadTimeout(TimeoutError('The read operation timed out'))
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
ERROR:root:Error during search: The read operation timed out
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:29:39] "[35m[1mPOST /search HTTP/1.1[0m" 500 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:29:46] "GET / HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:29:53] "GET / HTTP/1.1" 200 -
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000022D7909B890>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x0000022D79031F40> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000022D7909A150>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:30:14 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000018C0C421F90>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x0000018C0B5C1F40> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000018C0B804490>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:30:24 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 120-019-553
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:30:25] "GET / HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:30:39] "GET / HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Karachi Darbar', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 1500.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'Amazing chicken karahi with perfect spice level!', 'hashtags': ['karahi', 'spicy', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/5...
DEBUG:PIL.Image:Importing BlpImagePlugin
DEBUG:PIL.Image:Importing BmpImagePlugin
DEBUG:PIL.Image:Importing BufrStubImagePlugin
DEBUG:PIL.Image:Importing CurImagePlugin
DEBUG:PIL.Image:Importing DcxImagePlugin
DEBUG:PIL.Image:Importing DdsImagePlugin
DEBUG:PIL.Image:Importing EpsImagePlugin
DEBUG:PIL.Image:Importing FitsImagePlugin
DEBUG:PIL.Image:Importing FliImagePlugin
DEBUG:PIL.Image:Importing FpxImagePlugin
DEBUG:PIL.Image:Image: failed to import FpxImagePlugin: No module named 'olefile'
DEBUG:PIL.Image:Importing FtexImagePlugin
DEBUG:PIL.Image:Importing GbrImagePlugin
DEBUG:PIL.Image:Importing GifImagePlugin
DEBUG:PIL.Image:Importing GribStubImagePlugin
DEBUG:PIL.Image:Importing Hdf5StubImagePlugin
DEBUG:PIL.Image:Importing IcnsImagePlugin
DEBUG:PIL.Image:Importing IcoImagePlugin
DEBUG:PIL.Image:Importing ImImagePlugin
DEBUG:PIL.Image:Importing ImtImagePlugin
DEBUG:PIL.Image:Importing IptcImagePlugin
DEBUG:PIL.Image:Importing JpegImagePlugin
DEBUG:PIL.Image:Importing Jpeg2KImagePlugin
DEBUG:PIL.Image:Importing McIdasImagePlugin
DEBUG:PIL.Image:Importing MicImagePlugin
DEBUG:PIL.Image:Image: failed to import MicImagePlugin: No module named 'olefile'
DEBUG:PIL.Image:Importing MpegImagePlugin
DEBUG:PIL.Image:Importing MpoImagePlugin
DEBUG:PIL.Image:Importing MspImagePlugin
DEBUG:PIL.Image:Importing PalmImagePlugin
DEBUG:PIL.Image:Importing PcdImagePlugin
DEBUG:PIL.Image:Importing PcxImagePlugin
DEBUG:PIL.Image:Importing PdfImagePlugin
DEBUG:PIL.Image:Importing PixarImagePlugin
DEBUG:PIL.Image:Importing PngImagePlugin
DEBUG:PIL.Image:Importing PpmImagePlugin
DEBUG:PIL.Image:Importing PsdImagePlugin
DEBUG:PIL.Image:Importing QoiImagePlugin
DEBUG:PIL.Image:Importing SgiImagePlugin
DEBUG:PIL.Image:Importing SpiderImagePlugin
DEBUG:PIL.Image:Importing SunImagePlugin
DEBUG:PIL.Image:Importing TgaImagePlugin
DEBUG:PIL.Image:Importing TiffImagePlugin
DEBUG:PIL.Image:Importing WebPImagePlugin
DEBUG:PIL.Image:Importing WmfImagePlugin
DEBUG:PIL.Image:Importing XbmImagePlugin
DEBUG:PIL.Image:Importing XpmImagePlugin
DEBUG:PIL.Image:Importing XVThumbImagePlugin
DEBUG:root:Analyzing image with image_id: 77fca713-0f59-447f-8746-70e860462424
DEBUG:root:Raw Gemini response for image_id 77fca713-0f59-447f-8746-70e860462424:
```json
[
  {
    "image_id": "77fca713-0f59-447f-8746-70e860462424",
    "scene": "ambiance",
    "visual": {
      "description": "The exterior of a modern burger restaurant called 'BRIM Big Juicy Burgers'. The facade is black with prominent illuminated signage. A glass storefront reveals an indoor seating area. There's also an outdoor seating area with tables and chairs in the foreground. A person stands near the entrance, and another sign reads 'SHAGHF COFFEE'.",
      "confidence": 0.9,
      "quality": 0.8,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "mixed",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "restaurant",
      "burger",
      "exterior",
      "signage",
      "coffee",
      "seating",
      "modern"
    ],
    "ambience_features": [
      "modern exterior",
      "outdoor seating",
      "indoor seating",
      "illuminated signage"
    ],
    "thumbnail_rank": 1.0
  }
]
```
Raw response for image_id 77fca713-0f59-447f-8746-70e860462424:
```json
[
  {
    "image_id": "77fca713-0f59-447f-8746-70e860462424",
    "scene": "ambiance",
    "visual": {
      "description": "The exterior of a modern burger restaurant called 'BRIM Big Juicy Burgers'. The facade is black with prominent illuminated signage. A glass storefront reveals an indoor seating area. There's also an outdoor seating area with tables and chairs in the foreground. A person stands near the entrance, and another sign reads 'SHAGHF COFFEE'.",
      "confidence": 0.9,
      "quality": 0.8,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "mixed",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "restaurant",
      "burger",
      "exterior",
      "signage",
      "coffee",
      "seating",
      "modern"
    ],
    "ambience_features": [
      "modern exterior",
      "outdoor seating",
      "indoor seating",
      "illuminated signage"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 77fca713-0f59-447f-8746-70e860462424:
[
  {
    "image_id": "77fca713-0f59-447f-8746-70e860462424",
    "scene": "ambiance",
    "visual": {
      "description": "The exterior of a modern burger restaurant called 'BRIM Big Juicy Burgers'. The facade is black with prominent illuminated signage. A glass storefront reveals an indoor seating area. There's also an outdoor seating area with tables and chairs in the foreground. A person stands near the entrance, and another sign reads 'SHAGHF COFFEE'.",
      "confidence": 0.9,
      "quality": 0.8,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "mixed",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "restaurant",
      "burger",
      "exterior",
      "signage",
      "coffee",
      "seating",
      "modern"
    ],
    "ambience_features": [
      "modern exterior",
      "outdoor seating",
      "indoor seating",
      "illuminated signage"
    ],
    "thumbnail_rank": 1.0
  }
]
Cleaned response for image_id 77fca713-0f59-447f-8746-70e860462424:
[
  {
    "image_id": "77fca713-0f59-447f-8746-70e860462424",
    "scene": "ambiance",
    "visual": {
      "description": "The exterior of a modern burger restaurant called 'BRIM Big Juicy Burgers'. The facade is black with prominent illuminated signage. A glass storefront reveals an indoor seating area. There's also an outdoor seating area with tables and chairs in the foreground. A person stands near the entrance, and another sign reads 'SHAGHF COFFEE'.",
      "confidence": 0.9,
      "quality": 0.8,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "mixed",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "restaurant",
      "burger",
      "exterior",
      "signage",
      "coffee",
      "seating",
      "modern"
    ],
    "ambience_features": [
      "modern exterior",
      "outdoor seating",
      "indoor seating",
      "illuminated signage"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user HTTP/1.1" 307 0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user/ HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 77fca713-0f59-447f-8746-70e860462424, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Processing image 2/5...
DEBUG:root:Analyzing image with image_id: 90c993ca-bdf8-40bc-936f-08762b7d9cdc
DEBUG:root:Raw Gemini response for image_id 90c993ca-bdf8-40bc-936f-08762b7d9cdc:
{"image_id": "90c993ca-bdf8-40bc-936f-08762b7d9cdc", "scene": "dish_closeup", "visual": {"description": "A close-up shot of a loaded beef burger, wrapped in foil, with melted cheese and sesame seed bun. The burger appears to be a double patty with ample toppings.", "confidence": 0.92, "quality": 0.85, "appeal_score": 0.9}, "context": {"ambiance": "indoor", "lighting": "warm", "meal_timing": "any"}, "items": [{"name": "burger", "confidence": 0.98}, {"name": "beef patty", "confidence": 0.95}, {"name": "cheese", "confidence": 0.93}], "flag_type": "none", "penalty_score": 0, "keywords": ["burger", "beef", "cheese", "double patty", "sesame seed bun", "fast food"], "ambience_features": ["foil-wrapped"], "thumbnail_rank": 1.0}
Raw response for image_id 90c993ca-bdf8-40bc-936f-08762b7d9cdc:
{"image_id": "90c993ca-bdf8-40bc-936f-08762b7d9cdc", "scene": "dish_closeup", "visual": {"description": "A close-up shot of a loaded beef burger, wrapped in foil, with melted cheese and sesame seed bun. The burger appears to be a double patty with ample toppings.", "confidence": 0.92, "quality": 0.85, "appeal_score": 0.9}, "context": {"ambiance": "indoor", "lighting": "warm", "meal_timing": "any"}, "items": [{"name": "burger", "confidence": 0.98}, {"name": "beef patty", "confidence": 0.95}, {"name": "cheese", "confidence": 0.93}], "flag_type": "none", "penalty_score": 0, "keywords": ["burger", "beef", "cheese", "double patty", "sesame seed bun", "fast food"], "ambience_features": ["foil-wrapped"], "thumbnail_rank": 1.0}
==================================================
DEBUG:root:Cleaned response for image_id 90c993ca-bdf8-40bc-936f-08762b7d9cdc:
{"image_id": "90c993ca-bdf8-40bc-936f-08762b7d9cdc", "scene": "dish_closeup", "visual": {"description": "A close-up shot of a loaded beef burger, wrapped in foil, with melted cheese and sesame seed bun. The burger appears to be a double patty with ample toppings.", "confidence": 0.92, "quality": 0.85, "appeal_score": 0.9}, "context": {"ambiance": "indoor", "lighting": "warm", "meal_timing": "any"}, "items": [{"name": "burger", "confidence": 0.98}, {"name": "beef patty", "confidence": 0.95}, {"name": "cheese", "confidence": 0.93}], "flag_type": "none", "penalty_score": 0, "keywords": ["burger", "beef", "cheese", "double patty", "sesame seed bun", "fast food"], "ambience_features": ["foil-wrapped"], "thumbnail_rank": 1.0}
Cleaned response for image_id 90c993ca-bdf8-40bc-936f-08762b7d9cdc:
{"image_id": "90c993ca-bdf8-40bc-936f-08762b7d9cdc", "scene": "dish_closeup", "visual": {"description": "A close-up shot of a loaded beef burger, wrapped in foil, with melted cheese and sesame seed bun. The burger appears to be a double patty with ample toppings.", "confidence": 0.92, "quality": 0.85, "appeal_score": 0.9}, "context": {"ambiance": "indoor", "lighting": "warm", "meal_timing": "any"}, "items": [{"name": "burger", "confidence": 0.98}, {"name": "beef patty", "confidence": 0.95}, {"name": "cheese", "confidence": 0.93}], "flag_type": "none", "penalty_score": 0, "keywords": ["burger", "beef", "cheese", "double patty", "sesame seed bun", "fast food"], "ambience_features": ["foil-wrapped"], "thumbnail_rank": 1.0}
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 90c993ca-bdf8-40bc-936f-08762b7d9cdc, length: 768
DEBUG:root:Image 2 processed successfully.
DEBUG:root:Processing image 3/5...
DEBUG:root:Analyzing image with image_id: 5c35996e-d973-42ab-b2b3-7d6ee99a77f4
DEBUG:root:Raw Gemini response for image_id 5c35996e-d973-42ab-b2b3-7d6ee99a77f4:
```json
[
  {
    "image_id": "5c35996e-d973-42ab-b2b3-7d6ee99a77f4",
    "scene": "beverage",
    "visual": {
      "description": "A hand holds a plastic cup of peached ice tea with a straw. The cup has a label that says 'PEACHED ICE TEA' and 'BRIM'. In the background, a neon sign reads 'WE SMASH IT RIGHT'. There are also some food items wrapped in foil and paper napkins on the table.",
      "confidence": 0.95,
      "quality": 0.85,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "peached ice tea",
        "confidence": 0.98
      },
      {
        "name": "burger",
        "confidence": 0.65
      },
      {
        "name": "ketchup packets",
        "confidence": 0.8
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice tea",
      "peach",
      "drink",
      "beverage",
      "fast food",
      "restaurant"
    ],
    "ambience_features": [
      "neon sign",
      "indoor dining"
    ],
    "thumbnail_rank": 0.9
  }
]
```
Raw response for image_id 5c35996e-d973-42ab-b2b3-7d6ee99a77f4:
```json
[
  {
    "image_id": "5c35996e-d973-42ab-b2b3-7d6ee99a77f4",
    "scene": "beverage",
    "visual": {
      "description": "A hand holds a plastic cup of peached ice tea with a straw. The cup has a label that says 'PEACHED ICE TEA' and 'BRIM'. In the background, a neon sign reads 'WE SMASH IT RIGHT'. There are also some food items wrapped in foil and paper napkins on the table.",
      "confidence": 0.95,
      "quality": 0.85,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "peached ice tea",
        "confidence": 0.98
      },
      {
        "name": "burger",
        "confidence": 0.65
      },
      {
        "name": "ketchup packets",
        "confidence": 0.8
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice tea",
      "peach",
      "drink",
      "beverage",
      "fast food",
      "restaurant"
    ],
    "ambience_features": [
      "neon sign",
      "indoor dining"
    ],
    "thumbnail_rank": 0.9
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 5c35996e-d973-42ab-b2b3-7d6ee99a77f4:
[
  {
    "image_id": "5c35996e-d973-42ab-b2b3-7d6ee99a77f4",
    "scene": "beverage",
    "visual": {
      "description": "A hand holds a plastic cup of peached ice tea with a straw. The cup has a label that says 'PEACHED ICE TEA' and 'BRIM'. In the background, a neon sign reads 'WE SMASH IT RIGHT'. There are also some food items wrapped in foil and paper napkins on the table.",
      "confidence": 0.95,
      "quality": 0.85,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "peached ice tea",
        "confidence": 0.98
      },
      {
        "name": "burger",
        "confidence": 0.65
      },
      {
        "name": "ketchup packets",
        "confidence": 0.8
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice tea",
      "peach",
      "drink",
      "beverage",
      "fast food",
      "restaurant"
    ],
    "ambience_features": [
      "neon sign",
      "indoor dining"
    ],
    "thumbnail_rank": 0.9
  }
]
Cleaned response for image_id 5c35996e-d973-42ab-b2b3-7d6ee99a77f4:
[
  {
    "image_id": "5c35996e-d973-42ab-b2b3-7d6ee99a77f4",
    "scene": "beverage",
    "visual": {
      "description": "A hand holds a plastic cup of peached ice tea with a straw. The cup has a label that says 'PEACHED ICE TEA' and 'BRIM'. In the background, a neon sign reads 'WE SMASH IT RIGHT'. There are also some food items wrapped in foil and paper napkins on the table.",
      "confidence": 0.95,
      "quality": 0.85,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "peached ice tea",
        "confidence": 0.98
      },
      {
        "name": "burger",
        "confidence": 0.65
      },
      {
        "name": "ketchup packets",
        "confidence": 0.8
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice tea",
      "peach",
      "drink",
      "beverage",
      "fast food",
      "restaurant"
    ],
    "ambience_features": [
      "neon sign",
      "indoor dining"
    ],
    "thumbnail_rank": 0.9
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 5c35996e-d973-42ab-b2b3-7d6ee99a77f4, length: 768
DEBUG:root:Image 3 processed successfully.
DEBUG:root:Processing image 4/5...
DEBUG:root:Analyzing image with image_id: ef1bbd64-bccd-47c2-9e1b-d1619d40ab53
DEBUG:root:Raw Gemini response for image_id ef1bbd64-bccd-47c2-9e1b-d1619d40ab53:
```json
[
  {
    "image_id": "ef1bbd64-bccd-47c2-9e1b-d1619d40ab53",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a traditional copper pot filled with a rich, golden-brown curry. A hand is holding a ladle, about to scoop out the curry. The pot has intricate carvings and is resting on aluminum foil.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.9
      },
      {
        "name": "nihari",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "traditional pot",
      "copper",
      "Pakistani food",
      "slow cooked",
      "rich gravy",
      "spoon",
      "serving"
    ],
    "ambience_features": [
      "traditional",
      "warm lighting",
      "indoor"
    ],
    "thumbnail_rank": 1.0
  }
]
```
Raw response for image_id ef1bbd64-bccd-47c2-9e1b-d1619d40ab53:
```json
[
  {
    "image_id": "ef1bbd64-bccd-47c2-9e1b-d1619d40ab53",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a traditional copper pot filled with a rich, golden-brown curry. A hand is holding a ladle, about to scoop out the curry. The pot has intricate carvings and is resting on aluminum foil.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.9
      },
      {
        "name": "nihari",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "traditional pot",
      "copper",
      "Pakistani food",
      "slow cooked",
      "rich gravy",
      "spoon",
      "serving"
    ],
    "ambience_features": [
      "traditional",
      "warm lighting",
      "indoor"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id ef1bbd64-bccd-47c2-9e1b-d1619d40ab53:
[
  {
    "image_id": "ef1bbd64-bccd-47c2-9e1b-d1619d40ab53",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a traditional copper pot filled with a rich, golden-brown curry. A hand is holding a ladle, about to scoop out the curry. The pot has intricate carvings and is resting on aluminum foil.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.9
      },
      {
        "name": "nihari",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "traditional pot",
      "copper",
      "Pakistani food",
      "slow cooked",
      "rich gravy",
      "spoon",
      "serving"
    ],
    "ambience_features": [
      "traditional",
      "warm lighting",
      "indoor"
    ],
    "thumbnail_rank": 1.0
  }
]
Cleaned response for image_id ef1bbd64-bccd-47c2-9e1b-d1619d40ab53:
[
  {
    "image_id": "ef1bbd64-bccd-47c2-9e1b-d1619d40ab53",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a traditional copper pot filled with a rich, golden-brown curry. A hand is holding a ladle, about to scoop out the curry. The pot has intricate carvings and is resting on aluminum foil.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.9
      },
      {
        "name": "nihari",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "traditional pot",
      "copper",
      "Pakistani food",
      "slow cooked",
      "rich gravy",
      "spoon",
      "serving"
    ],
    "ambience_features": [
      "traditional",
      "warm lighting",
      "indoor"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id ef1bbd64-bccd-47c2-9e1b-d1619d40ab53, length: 768
DEBUG:root:Image 4 processed successfully.
DEBUG:root:Processing image 5/5...
DEBUG:root:Analyzing image with image_id: e9b7dfaa-c5e7-4238-b39f-b24ea7d6dae8
DEBUG:root:Raw Gemini response for image_id e9b7dfaa-c5e7-4238-b39f-b24ea7d6dae8:
```json
[
  {
    "image_id": "e9b7dfaa-c5e7-4238-b39f-b24ea7d6dae8",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of several fried patties, possibly pakoras or tikki, being cooked. In the background, oil is hot in a large wok with more items being fried.  A utensil is in the wok to flip the items.",
      "confidence": 0.9,
      "quality": 0.5,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.7
      },
      {
        "name": "tikki",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "fried",
      "pakora",
      "tikki",
      "snack",
      "cooking",
      "street food"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
```
Raw response for image_id e9b7dfaa-c5e7-4238-b39f-b24ea7d6dae8:
```json
[
  {
    "image_id": "e9b7dfaa-c5e7-4238-b39f-b24ea7d6dae8",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of several fried patties, possibly pakoras or tikki, being cooked. In the background, oil is hot in a large wok with more items being fried.  A utensil is in the wok to flip the items.",
      "confidence": 0.9,
      "quality": 0.5,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.7
      },
      {
        "name": "tikki",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "fried",
      "pakora",
      "tikki",
      "snack",
      "cooking",
      "street food"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id e9b7dfaa-c5e7-4238-b39f-b24ea7d6dae8:
[
  {
    "image_id": "e9b7dfaa-c5e7-4238-b39f-b24ea7d6dae8",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of several fried patties, possibly pakoras or tikki, being cooked. In the background, oil is hot in a large wok with more items being fried.  A utensil is in the wok to flip the items.",
      "confidence": 0.9,
      "quality": 0.5,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.7
      },
      {
        "name": "tikki",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "fried",
      "pakora",
      "tikki",
      "snack",
      "cooking",
      "street food"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
Cleaned response for image_id e9b7dfaa-c5e7-4238-b39f-b24ea7d6dae8:
[
  {
    "image_id": "e9b7dfaa-c5e7-4238-b39f-b24ea7d6dae8",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of several fried patties, possibly pakoras or tikki, being cooked. In the background, oil is hot in a large wok with more items being fried.  A utensil is in the wok to flip the items.",
      "confidence": 0.9,
      "quality": 0.5,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.7
      },
      {
        "name": "tikki",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "fried",
      "pakora",
      "tikki",
      "snack",
      "cooking",
      "street food"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.8
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id e9b7dfaa-c5e7-4238-b39f-b24ea7d6dae8, length: 768
DEBUG:root:Image 5 processed successfully.
DEBUG:root:Aggregated quality_score: 0.74
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000018C0D9A8C10>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x0000018C0B5C1F40> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000018C0D9AB250>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:32:27 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: a82f6cc5-b1b6-468c-8151-71bad554f123
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.74, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.444, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:32:27] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: karahi, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'karahi' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['karahi']: ['curry', 'stew']
DEBUG:root:Keywords: ['karahi'], Synonyms: ['stew', 'curry']
DEBUG:root:Generating text embedding for query 'karahi' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'karahi', length: 768
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000018C0D9B60D0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x0000018C0B5C1F40> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000018C0D9B6090>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:33:29 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 8 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:33:33 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 6 keyword search results.
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.4143987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.06999999999999999, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.4253987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.075, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.3393987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.06999999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.2366582004166667, keyword_score: 0.3333333333333333, semantic_score: 0.036366135, quality_score: 0.092, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.22835820041666668, keyword_score: 0.3333333333333333, semantic_score: 0.036366135, quality_score: 0.088, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.85
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.24007298566666668, keyword_score: 0.3333333333333333, semantic_score: 0.016425276, quality_score: 0.074, personal_score: 0.1, geo_score: 0.85, thumbnail_rank: 0.9400000000000001
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.09565325625000001, keyword_score: 0.0, semantic_score: 0.012613025, quality_score: 0.05, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.109371238625, keyword_score: 0.0, semantic_score: 0.0092849545, quality_score: 0.08524999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.95
DEBUG:root:Search completed, returning 8 results.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:33:39] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: burger, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'burger' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['burger']: []
DEBUG:root:Keywords: ['burger'], Synonyms: []
DEBUG:root:Generating text embedding for query 'burger' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'burger', length: 768
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000018C0D986CD0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x0000018C0B5C1F40> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000018C0D987110>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:34:04 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 8 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:34:14 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 2 keyword search results.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.1017507175, keyword_score: 0.0, semantic_score: 0.03700287, quality_score: 0.05, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.46491179124999993, keyword_score: 1.0, semantic_score: 0.031447165, quality_score: 0.08524999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.95
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.47540606924999995, keyword_score: 1.0, semantic_score: 0.024424277, quality_score: 0.074, personal_score: 0.1, geo_score: 0.85, thumbnail_rank: 0.9400000000000001
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.09783500525000001, keyword_score: 0.0, semantic_score: 0.005340021, quality_score: 0.06999999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.17283500525, keyword_score: 0.0, semantic_score: 0.005340021, quality_score: 0.06999999999999999, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.18383500525000002, keyword_score: 0.0, semantic_score: 0.005340021, quality_score: 0.075, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.111800646675, keyword_score: 0.0, semantic_score: 0.0036025867, quality_score: 0.092, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.103500646675, keyword_score: 0.0, semantic_score: 0.0036025867, quality_score: 0.088, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.85
DEBUG:root:Search completed, returning 8 results.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:34:19] "POST /search HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:36:04] "GET /?pakistani_cuisine=0.5&italian_cuisine=0.3&chinese_cuisine=0.2&quality_expectation=7 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:36:12] "GET /?pakistani_cuisine=0.5&italian_cuisine=0.6&chinese_cuisine=0.2&quality_expectation=7 HTTP/1.1" 200 -
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\numpy\\_typing\\_scalars.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000023FC40B9C90>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x0000023FC3E49EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000023FC3C19150>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:38:43 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 120-019-553
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:38:43] "GET /?pakistani_cuisine=0.5&italian_cuisine=0.6&chinese_cuisine=0.2&quality_expectation=7 HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: karahi, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'karahi' and search_type 'text'
DEBUG:root:Expanded synonyms for keywords ['karahi']: ['curry', 'stew']
DEBUG:root:Keywords: ['karahi'], Synonyms: ['stew', 'curry']
DEBUG:root:Generating text embedding for query 'karahi' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user HTTP/1.1" 307 0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user/ HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'karahi', length: 768
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000023FC4189E50>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x0000023FC3E49EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000023FC418ACD0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:38:58 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 8 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:39:08 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 6 keyword search results.
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.4143987783333333 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.4253987783333333 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.3393987783333333 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.2366582004166667 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.22835820041666668 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.24007298566666668 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09565325625000001 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.109371238625 (threshold: 0.5)
DEBUG:root:Search completed, returning 0 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:39:16] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: burger, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'burger' and search_type 'text'
DEBUG:root:Expanded synonyms for keywords ['burger']: []
DEBUG:root:Keywords: ['burger'], Synonyms: []
DEBUG:root:Generating text embedding for query 'burger' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'burger', length: 768
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000023FC4191290>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x0000023FC3E49EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000023FC3A56F90>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:39:38 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 8 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:39:53 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.failed exception=ReadTimeout(TimeoutError('The read operation timed out'))
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
ERROR:root:Error during search: The read operation timed out
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:40:26] "[35m[1mPOST /search HTTP/1.1[0m" 500 -
DEBUG:root:Search initiated with query: burger, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'burger' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['burger']: []
DEBUG:root:Keywords: ['burger'], Synonyms: []
DEBUG:root:Generating text embedding for query 'burger' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'burger', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000023FC5D28F10>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x0000023FC3E49EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000023FC4191290>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:40:34 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 8 text-to-image search results from Qdrant.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1017507175 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.46491179124999993 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.47540606924999995 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09783500525000001 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.17283500525 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.18383500525000002 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.111800646675 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.103500646675 (threshold: 0.5)
DEBUG:root:Search completed, returning 0 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:40:39] "POST /search HTTP/1.1" 200 -
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723AFEB710>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723AFEA590>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:41:48 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 120-019-553
DEBUG:root:Search initiated with query: burger, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'burger' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['burger']: []
DEBUG:root:Keywords: ['burger'], Synonyms: []
DEBUG:root:Generating text embedding for query 'burger' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user HTTP/1.1" 307 0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user/ HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'burger', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:41:50 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 8 text-to-image search results from Qdrant.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1017507175 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.46491179124999993, keyword_score: 1.0, semantic_score: 0.031447165, quality_score: 0.08524999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.95
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.47540606924999995, keyword_score: 1.0, semantic_score: 0.024424277, quality_score: 0.074, personal_score: 0.1, geo_score: 0.85, thumbnail_rank: 0.9400000000000001
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09783500525000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.17283500525 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.18383500525000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.111800646675 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.103500646675 (threshold: 0.2)
DEBUG:root:Search completed, returning 2 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:41:55] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: karahi, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'karahi' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['karahi']: ['curry', 'stew']
DEBUG:root:Keywords: ['karahi'], Synonyms: ['stew', 'curry']
DEBUG:root:Generating text embedding for query 'karahi' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'karahi', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723AD0D210>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723AD0E650>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:42:06 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 8 text-to-image search results from Qdrant.
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.4143987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.06999999999999999, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.4253987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.075, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.3393987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.06999999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.2366582004166667, keyword_score: 0.3333333333333333, semantic_score: 0.036366135, quality_score: 0.092, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.22835820041666668, keyword_score: 0.3333333333333333, semantic_score: 0.036366135, quality_score: 0.088, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.85
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.24007298566666668, keyword_score: 0.3333333333333333, semantic_score: 0.016425276, quality_score: 0.074, personal_score: 0.1, geo_score: 0.85, thumbnail_rank: 0.9400000000000001
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09565325625000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.109371238625 (threshold: 0.2)
DEBUG:root:Search completed, returning 6 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:42:19] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: icecream, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'icecream' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['icecream']: []
DEBUG:root:Keywords: ['icecream'], Synonyms: []
DEBUG:root:Generating text embedding for query 'icecream' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'icecream', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723AF58BD0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723BB4EA10>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:42:58 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 8 text-to-image search results from Qdrant.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09746501575000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12373608675 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1111405095 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1001601245 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.17516012450000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.18616012450000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11174018275 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10344018275 (threshold: 0.2)
DEBUG:root:Search completed, returning 0 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:43:04] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: halwa, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'halwa' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['halwa']: []
DEBUG:root:Keywords: ['halwa'], Synonyms: []
DEBUG:root:Generating text embedding for query 'halwa' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'halwa', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723CB78B90>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723CB78A50>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:43:17 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 8 text-to-image search results from Qdrant.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.19142704 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.18042704 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10542704000000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09933505375000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10920412300000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.117504123 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12536161625 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1108410305 (threshold: 0.2)
DEBUG:root:Search completed, returning 0 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:43:22] "POST /search HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Suleman Sweets', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 1500.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'best halwa puri !', 'hashtags': ['desi', 'breakfast']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:PIL.Image:Importing BlpImagePlugin
DEBUG:PIL.Image:Importing BmpImagePlugin
DEBUG:PIL.Image:Importing BufrStubImagePlugin
DEBUG:PIL.Image:Importing CurImagePlugin
DEBUG:PIL.Image:Importing DcxImagePlugin
DEBUG:PIL.Image:Importing DdsImagePlugin
DEBUG:PIL.Image:Importing EpsImagePlugin
DEBUG:PIL.Image:Importing FitsImagePlugin
DEBUG:PIL.Image:Importing FliImagePlugin
DEBUG:PIL.Image:Importing FpxImagePlugin
DEBUG:PIL.Image:Image: failed to import FpxImagePlugin: No module named 'olefile'
DEBUG:PIL.Image:Importing FtexImagePlugin
DEBUG:PIL.Image:Importing GbrImagePlugin
DEBUG:PIL.Image:Importing GifImagePlugin
DEBUG:PIL.Image:Importing GribStubImagePlugin
DEBUG:PIL.Image:Importing Hdf5StubImagePlugin
DEBUG:PIL.Image:Importing IcnsImagePlugin
DEBUG:PIL.Image:Importing IcoImagePlugin
DEBUG:PIL.Image:Importing ImImagePlugin
DEBUG:PIL.Image:Importing ImtImagePlugin
DEBUG:PIL.Image:Importing IptcImagePlugin
DEBUG:PIL.Image:Importing JpegImagePlugin
DEBUG:PIL.Image:Importing Jpeg2KImagePlugin
DEBUG:PIL.Image:Importing McIdasImagePlugin
DEBUG:PIL.Image:Importing MicImagePlugin
DEBUG:PIL.Image:Image: failed to import MicImagePlugin: No module named 'olefile'
DEBUG:PIL.Image:Importing MpegImagePlugin
DEBUG:PIL.Image:Importing MpoImagePlugin
DEBUG:PIL.Image:Importing MspImagePlugin
DEBUG:PIL.Image:Importing PalmImagePlugin
DEBUG:PIL.Image:Importing PcdImagePlugin
DEBUG:PIL.Image:Importing PcxImagePlugin
DEBUG:PIL.Image:Importing PdfImagePlugin
DEBUG:PIL.Image:Importing PixarImagePlugin
DEBUG:PIL.Image:Importing PngImagePlugin
DEBUG:PIL.Image:Importing PpmImagePlugin
DEBUG:PIL.Image:Importing PsdImagePlugin
DEBUG:PIL.Image:Importing QoiImagePlugin
DEBUG:PIL.Image:Importing SgiImagePlugin
DEBUG:PIL.Image:Importing SpiderImagePlugin
DEBUG:PIL.Image:Importing SunImagePlugin
DEBUG:PIL.Image:Importing TgaImagePlugin
DEBUG:PIL.Image:Importing TiffImagePlugin
DEBUG:PIL.Image:Importing WebPImagePlugin
DEBUG:PIL.Image:Importing WmfImagePlugin
DEBUG:PIL.Image:Importing XbmImagePlugin
DEBUG:PIL.Image:Importing XpmImagePlugin
DEBUG:PIL.Image:Importing XVThumbImagePlugin
DEBUG:root:Analyzing image with image_id: ae20b141-a598-45ac-8b83-96b4d6568937
DEBUG:root:Raw Gemini response for image_id ae20b141-a598-45ac-8b83-96b4d6568937:
```json
[
  {
    "image_id": "ae20b141-a598-45ac-8b83-96b4d6568937",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish featuring a puffed bread, possibly Puri, served with what appears to be keema (minced meat) and carrot halwa.",
      "confidence": 0.95,
      "quality": 0.6,
      "appeal_score": 0.65
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "Puri",
        "confidence": 0.8
      },
      {
        "name": "Keema",
        "confidence": 0.7
      },
      {
        "name": "Carrot Halwa",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "puri",
      "keema",
      "halwa",
      "breakfast",
      "snack"
    ],
    "ambience_features": [
      "warm lighting"
    ],
    "thumbnail_rank": 0.8
  }
]
```
Raw response for image_id ae20b141-a598-45ac-8b83-96b4d6568937:
```json
[
  {
    "image_id": "ae20b141-a598-45ac-8b83-96b4d6568937",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish featuring a puffed bread, possibly Puri, served with what appears to be keema (minced meat) and carrot halwa.",
      "confidence": 0.95,
      "quality": 0.6,
      "appeal_score": 0.65
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "Puri",
        "confidence": 0.8
      },
      {
        "name": "Keema",
        "confidence": 0.7
      },
      {
        "name": "Carrot Halwa",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "puri",
      "keema",
      "halwa",
      "breakfast",
      "snack"
    ],
    "ambience_features": [
      "warm lighting"
    ],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id ae20b141-a598-45ac-8b83-96b4d6568937:
[
  {
    "image_id": "ae20b141-a598-45ac-8b83-96b4d6568937",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish featuring a puffed bread, possibly Puri, served with what appears to be keema (minced meat) and carrot halwa.",
      "confidence": 0.95,
      "quality": 0.6,
      "appeal_score": 0.65
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "Puri",
        "confidence": 0.8
      },
      {
        "name": "Keema",
        "confidence": 0.7
      },
      {
        "name": "Carrot Halwa",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "puri",
      "keema",
      "halwa",
      "breakfast",
      "snack"
    ],
    "ambience_features": [
      "warm lighting"
    ],
    "thumbnail_rank": 0.8
  }
]
Cleaned response for image_id ae20b141-a598-45ac-8b83-96b4d6568937:
[
  {
    "image_id": "ae20b141-a598-45ac-8b83-96b4d6568937",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish featuring a puffed bread, possibly Puri, served with what appears to be keema (minced meat) and carrot halwa.",
      "confidence": 0.95,
      "quality": 0.6,
      "appeal_score": 0.65
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "Puri",
        "confidence": 0.8
      },
      {
        "name": "Keema",
        "confidence": 0.7
      },
      {
        "name": "Carrot Halwa",
        "confidence": 0.7
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "puri",
      "keema",
      "halwa",
      "breakfast",
      "snack"
    ],
    "ambience_features": [
      "warm lighting"
    ],
    "thumbnail_rank": 0.8
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id ae20b141-a598-45ac-8b83-96b4d6568937, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Aggregated quality_score: 0.6
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D2C8550>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D2C9C50>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:44:09 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: 4e2afc51-3d6b-4403-b074-2e0754ffb1b7
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.6, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.36, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:44:09] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: halwa, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'halwa' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['halwa']: []
DEBUG:root:Keywords: ['halwa'], Synonyms: []
DEBUG:root:Generating text embedding for query 'halwa' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'halwa', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723BB01A50>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D2C8090>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:44:21 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 9 text-to-image search results from Qdrant.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.18042704 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10542704000000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.19142704 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09933505375000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.117504123 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10920412300000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12536161625 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1108410305 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.44677927549999996, keyword_score: 1.0, semantic_score: 0.009117102, quality_score: 0.06, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Search completed, returning 1 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:44:29] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: halwa, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'halwa' and search_type 'text'
DEBUG:root:Expanded synonyms for keywords ['halwa']: []
DEBUG:root:Keywords: ['halwa'], Synonyms: []
DEBUG:root:Generating text embedding for query 'halwa' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'halwa', length: 768
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D2CAD10>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D2CA7D0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:44:41 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 9 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:44:49 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 1 keyword search results.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.18042704 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10542704000000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.19142704 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09933505375000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.117504123 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10920412300000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12536161625 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1108410305 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.44677927549999996, keyword_score: 1.0, semantic_score: 0.009117102, quality_score: 0.06, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Search completed, returning 1 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:44:58] "POST /search HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Chaman Icecream', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 200.0, 'rateUserExperience': {'foodTaste': 5, 'ambience': 4, 'staff': 5, 'willRecommend': 4}, 'averageRating': 4.5, 'userThoughts': 'Very fruity icecream', 'hashtags': ['icecream', 'chaman']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:PIL.PngImagePlugin:STREAM b'IHDR' 16 13
DEBUG:PIL.PngImagePlugin:STREAM b'sRGB' 41 1
DEBUG:PIL.PngImagePlugin:STREAM b'gAMA' 54 4
DEBUG:PIL.PngImagePlugin:STREAM b'pHYs' 70 9
DEBUG:PIL.PngImagePlugin:STREAM b'IDAT' 91 65445
ERROR:root:Error processing review: cannot access local variable 'image_id' where it is not associated with a value
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:48:14] "[35m[1mPOST /process_review HTTP/1.1[0m" 500 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:48:35] "GET /?pakistani_cuisine=0.5&italian_cuisine=0.6&chinese_cuisine=0.2&quality_expectation=7 HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Chaman Icecream', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 200.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'icecream', 'hashtags': ['icecream', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:PIL.PngImagePlugin:STREAM b'IHDR' 16 13
DEBUG:PIL.PngImagePlugin:STREAM b'sRGB' 41 1
DEBUG:PIL.PngImagePlugin:STREAM b'gAMA' 54 4
DEBUG:PIL.PngImagePlugin:STREAM b'pHYs' 70 9
DEBUG:PIL.PngImagePlugin:STREAM b'IDAT' 91 65445
ERROR:root:Error processing review: cannot access local variable 'image_id' where it is not associated with a value
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:49:09] "[35m[1mPOST /process_review HTTP/1.1[0m" 500 -
DEBUG:root:Review data prepared: {'restaurantName': 'Chaman Icecream', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 200.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'icecream', 'hashtags': ['icecream', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:root:Analyzing image with image_id: 521f94a4-2fbd-46c8-8ad2-49c2f12ff5dc
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:49:36] "GET /?pakistani_cuisine=0.5&italian_cuisine=0.6&chinese_cuisine=0.2&quality_expectation=7 HTTP/1.1" 200 -
DEBUG:root:Raw Gemini response for image_id 521f94a4-2fbd-46c8-8ad2-49c2f12ff5dc:
```json
[
  {
    "image_id": "521f94a4-2fbd-46c8-8ad2-49c2f12ff5dc",
    "scene": "dish_closeup",
    "visual": {
      "description": "A double patty cheeseburger, generously topped with melted cheese and possibly some diced onions or relish, is held in foil. The sesame seed bun is slightly compressed. The background shows a busy, indoor restaurant setting with blurred lights and people.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "cheeseburger",
        "confidence": 0.98
      },
      {
        "name": "burger patty",
        "confidence": 0.95
      },
      {
        "name": "sesame seed bun",
        "confidence": 0.92
      },
      {
        "name": "melted cheese",
        "confidence": 0.90
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "cheeseburger",
      "fast food",
      "double patty",
      "cheese",
      "sesame bun",
      "foil wrapped",
      "delicious",
      "food porn"
    ],
    "ambience_features": [
      "indoor dining",
      "restaurant",
      "busy"
    ],
    "thumbnail_rank": 0.9
  }
]
```
Raw response for image_id 521f94a4-2fbd-46c8-8ad2-49c2f12ff5dc:
```json
[
  {
    "image_id": "521f94a4-2fbd-46c8-8ad2-49c2f12ff5dc",
    "scene": "dish_closeup",
    "visual": {
      "description": "A double patty cheeseburger, generously topped with melted cheese and possibly some diced onions or relish, is held in foil. The sesame seed bun is slightly compressed. The background shows a busy, indoor restaurant setting with blurred lights and people.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "cheeseburger",
        "confidence": 0.98
      },
      {
        "name": "burger patty",
        "confidence": 0.95
      },
      {
        "name": "sesame seed bun",
        "confidence": 0.92
      },
      {
        "name": "melted cheese",
        "confidence": 0.90
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "cheeseburger",
      "fast food",
      "double patty",
      "cheese",
      "sesame bun",
      "foil wrapped",
      "delicious",
      "food porn"
    ],
    "ambience_features": [
      "indoor dining",
      "restaurant",
      "busy"
    ],
    "thumbnail_rank": 0.9
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 521f94a4-2fbd-46c8-8ad2-49c2f12ff5dc:
[
  {
    "image_id": "521f94a4-2fbd-46c8-8ad2-49c2f12ff5dc",
    "scene": "dish_closeup",
    "visual": {
      "description": "A double patty cheeseburger, generously topped with melted cheese and possibly some diced onions or relish, is held in foil. The sesame seed bun is slightly compressed. The background shows a busy, indoor restaurant setting with blurred lights and people.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "cheeseburger",
        "confidence": 0.98
      },
      {
        "name": "burger patty",
        "confidence": 0.95
      },
      {
        "name": "sesame seed bun",
        "confidence": 0.92
      },
      {
        "name": "melted cheese",
        "confidence": 0.90
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "cheeseburger",
      "fast food",
      "double patty",
      "cheese",
      "sesame bun",
      "foil wrapped",
      "delicious",
      "food porn"
    ],
    "ambience_features": [
      "indoor dining",
      "restaurant",
      "busy"
    ],
    "thumbnail_rank": 0.9
  }
]
Cleaned response for image_id 521f94a4-2fbd-46c8-8ad2-49c2f12ff5dc:
[
  {
    "image_id": "521f94a4-2fbd-46c8-8ad2-49c2f12ff5dc",
    "scene": "dish_closeup",
    "visual": {
      "description": "A double patty cheeseburger, generously topped with melted cheese and possibly some diced onions or relish, is held in foil. The sesame seed bun is slightly compressed. The background shows a busy, indoor restaurant setting with blurred lights and people.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "cheeseburger",
        "confidence": 0.98
      },
      {
        "name": "burger patty",
        "confidence": 0.95
      },
      {
        "name": "sesame seed bun",
        "confidence": 0.92
      },
      {
        "name": "melted cheese",
        "confidence": 0.90
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "burger",
      "cheeseburger",
      "fast food",
      "double patty",
      "cheese",
      "sesame bun",
      "foil wrapped",
      "delicious",
      "food porn"
    ],
    "ambience_features": [
      "indoor dining",
      "restaurant",
      "busy"
    ],
    "thumbnail_rank": 0.9
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:root:Review data prepared: {'restaurantName': 'Karachi Darbar', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 1500.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'Amazing chicken karahi with perfect spice level!', 'hashtags': ['karahi', 'spicy', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:root:Analyzing image with image_id: 4545853c-7086-4914-9115-54b010a6b4f5
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 521f94a4-2fbd-46c8-8ad2-49c2f12ff5dc, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Aggregated quality_score: 0.88
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D10CCD0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D10D2D0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:root:Raw Gemini response for image_id 4545853c-7086-4914-9115-54b010a6b4f5:
```json
[
  {
    "image_id": "4545853c-7086-4914-9115-54b010a6b4f5",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish featuring a large, fluffy puri, accompanied by what appears to be a meat preparation (like keema) and some sliced cooked vegetables, possibly carrots or sweet potatoes, on a white plate.",
      "confidence": 0.85,
      "quality": 0.55,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.95
      },
      {
        "name": "keema",
        "confidence": 0.7
      },
      {
        "name": "vegetables",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "keema",
      "pakistani food",
      "indian subcontinent",
      "breakfast",
      "snack"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.9
  }
]
```
Raw response for image_id 4545853c-7086-4914-9115-54b010a6b4f5:
```json
[
  {
    "image_id": "4545853c-7086-4914-9115-54b010a6b4f5",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish featuring a large, fluffy puri, accompanied by what appears to be a meat preparation (like keema) and some sliced cooked vegetables, possibly carrots or sweet potatoes, on a white plate.",
      "confidence": 0.85,
      "quality": 0.55,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.95
      },
      {
        "name": "keema",
        "confidence": 0.7
      },
      {
        "name": "vegetables",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "keema",
      "pakistani food",
      "indian subcontinent",
      "breakfast",
      "snack"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.9
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 4545853c-7086-4914-9115-54b010a6b4f5:
[
  {
    "image_id": "4545853c-7086-4914-9115-54b010a6b4f5",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish featuring a large, fluffy puri, accompanied by what appears to be a meat preparation (like keema) and some sliced cooked vegetables, possibly carrots or sweet potatoes, on a white plate.",
      "confidence": 0.85,
      "quality": 0.55,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.95
      },
      {
        "name": "keema",
        "confidence": 0.7
      },
      {
        "name": "vegetables",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "keema",
      "pakistani food",
      "indian subcontinent",
      "breakfast",
      "snack"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.9
  }
]
Cleaned response for image_id 4545853c-7086-4914-9115-54b010a6b4f5:
[
  {
    "image_id": "4545853c-7086-4914-9115-54b010a6b4f5",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a Pakistani dish featuring a large, fluffy puri, accompanied by what appears to be a meat preparation (like keema) and some sliced cooked vegetables, possibly carrots or sweet potatoes, on a white plate.",
      "confidence": 0.85,
      "quality": 0.55,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.95
      },
      {
        "name": "keema",
        "confidence": 0.7
      },
      {
        "name": "vegetables",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "keema",
      "pakistani food",
      "indian subcontinent",
      "breakfast",
      "snack"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.9
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 4545853c-7086-4914-9115-54b010a6b4f5, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Aggregated quality_score: 0.55
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D10C8D0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:49:44 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: fffb8329-f1f6-45ee-ada3-d398fb9bffe4
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723CB75DD0>
DEBUG:root:Calculating reach...
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:root:Reach calculation - quality_score: 0.88, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.528, reach_level: Search-only (no feed distribution)
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:root:Reach calculation completed.
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:49:44] "POST /process_review HTTP/1.1" 200 -
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:49:44 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: a8e1b619-4ae5-424b-aca7-39657bd1a414
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.55, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.33, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:49:44] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Karachi Darbar', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 1500.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'Amazing chicken karahi with perfect spice level!', 'hashtags': ['karahi', 'spicy', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:PIL.PngImagePlugin:STREAM b'IHDR' 16 13
DEBUG:PIL.PngImagePlugin:STREAM b'sRGB' 41 1
DEBUG:PIL.PngImagePlugin:STREAM b'gAMA' 54 4
DEBUG:PIL.PngImagePlugin:STREAM b'pHYs' 70 9
DEBUG:PIL.PngImagePlugin:STREAM b'IDAT' 91 65445
ERROR:root:Error processing review: cannot access local variable 'image_id' where it is not associated with a value
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:50:02] "[35m[1mPOST /process_review HTTP/1.1[0m" 500 -
DEBUG:root:Review data prepared: {'restaurantName': 'Karachi Darbar', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 1500.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'Amazing chicken karahi with perfect spice level!', 'hashtags': ['karahi', 'spicy', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:root:Analyzing image with image_id: 19e87061-92f9-40d3-bc6b-66281ba8ac04
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:52:28] "GET /?pakistani_cuisine=0.5&italian_cuisine=0.6&chinese_cuisine=0.2&quality_expectation=7 HTTP/1.1" 200 -
DEBUG:root:Raw Gemini response for image_id 19e87061-92f9-40d3-bc6b-66281ba8ac04:
```json
[
  {
    "image_id": "19e87061-92f9-40d3-bc6b-66281ba8ac04",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand holding a multi-colored soft-serve ice cream cone against a blurred background of greenery and neutral-colored planters. The ice cream has layers of pink, orange, yellow, light blue, and white. The cone is wrapped in a white paper with pink dots. The hand has bright pink nail polish.",
      "confidence": 0.98,
      "quality": 0.95,
      "appeal_score": 0.9
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.99
      },
      {
        "name": "soft serve",
        "confidence": 0.98
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "soft serve",
      "cone",
      "dessert",
      "sweet",
      "colorful",
      "hand",
      "summer",
      "treat"
    ],
    "ambience_features": [
      "greenery",
      "outdoor setting",
      "planters"
    ],
    "thumbnail_rank": 0.85
  }
]
```
Raw response for image_id 19e87061-92f9-40d3-bc6b-66281ba8ac04:
```json
[
  {
    "image_id": "19e87061-92f9-40d3-bc6b-66281ba8ac04",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand holding a multi-colored soft-serve ice cream cone against a blurred background of greenery and neutral-colored planters. The ice cream has layers of pink, orange, yellow, light blue, and white. The cone is wrapped in a white paper with pink dots. The hand has bright pink nail polish.",
      "confidence": 0.98,
      "quality": 0.95,
      "appeal_score": 0.9
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.99
      },
      {
        "name": "soft serve",
        "confidence": 0.98
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "soft serve",
      "cone",
      "dessert",
      "sweet",
      "colorful",
      "hand",
      "summer",
      "treat"
    ],
    "ambience_features": [
      "greenery",
      "outdoor setting",
      "planters"
    ],
    "thumbnail_rank": 0.85
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 19e87061-92f9-40d3-bc6b-66281ba8ac04:
[
  {
    "image_id": "19e87061-92f9-40d3-bc6b-66281ba8ac04",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand holding a multi-colored soft-serve ice cream cone against a blurred background of greenery and neutral-colored planters. The ice cream has layers of pink, orange, yellow, light blue, and white. The cone is wrapped in a white paper with pink dots. The hand has bright pink nail polish.",
      "confidence": 0.98,
      "quality": 0.95,
      "appeal_score": 0.9
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.99
      },
      {
        "name": "soft serve",
        "confidence": 0.98
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "soft serve",
      "cone",
      "dessert",
      "sweet",
      "colorful",
      "hand",
      "summer",
      "treat"
    ],
    "ambience_features": [
      "greenery",
      "outdoor setting",
      "planters"
    ],
    "thumbnail_rank": 0.85
  }
]
Cleaned response for image_id 19e87061-92f9-40d3-bc6b-66281ba8ac04:
[
  {
    "image_id": "19e87061-92f9-40d3-bc6b-66281ba8ac04",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand holding a multi-colored soft-serve ice cream cone against a blurred background of greenery and neutral-colored planters. The ice cream has layers of pink, orange, yellow, light blue, and white. The cone is wrapped in a white paper with pink dots. The hand has bright pink nail polish.",
      "confidence": 0.98,
      "quality": 0.95,
      "appeal_score": 0.9
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.99
      },
      {
        "name": "soft serve",
        "confidence": 0.98
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "soft serve",
      "cone",
      "dessert",
      "sweet",
      "colorful",
      "hand",
      "summer",
      "treat"
    ],
    "ambience_features": [
      "greenery",
      "outdoor setting",
      "planters"
    ],
    "thumbnail_rank": 0.85
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 19e87061-92f9-40d3-bc6b-66281ba8ac04, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Aggregated quality_score: 0.95
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D2DE290>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D2DEA10>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:52:31 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: 28164788-3635-4ab5-afbb-a2b4580fbe84
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.95, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.57, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:52:32] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Chaman Icecream', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 200.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'best icecream', 'hashtags': ['family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:root:Analyzing image with image_id: 7922828e-d4e7-4286-8c15-011bc5b62c05
DEBUG:root:Raw Gemini response for image_id 7922828e-d4e7-4286-8c15-011bc5b62c05:
```json
[
  {
    "image_id": "7922828e-d4e7-4286-8c15-011bc5b62c05",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand holds a colorful soft-serve ice cream cone with multiple swirled layers of pink, orange, yellow, and blue. The ice cream is in a waffle cone wrapped with a pink and white patterned paper. The background is blurred with green foliage and large planters.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.9
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.98
      },
      {
        "name": "soft serve",
        "confidence": 0.95
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "dessert",
      "sweet",
      "treat",
      "colorful",
      "summer",
      "refreshing"
    ],
    "ambience_features": [
      "outdoor",
      "natural light",
      "greenery"
    ],
    "thumbnail_rank": 1.0
  }
]
```
Raw response for image_id 7922828e-d4e7-4286-8c15-011bc5b62c05:
```json
[
  {
    "image_id": "7922828e-d4e7-4286-8c15-011bc5b62c05",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand holds a colorful soft-serve ice cream cone with multiple swirled layers of pink, orange, yellow, and blue. The ice cream is in a waffle cone wrapped with a pink and white patterned paper. The background is blurred with green foliage and large planters.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.9
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.98
      },
      {
        "name": "soft serve",
        "confidence": 0.95
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "dessert",
      "sweet",
      "treat",
      "colorful",
      "summer",
      "refreshing"
    ],
    "ambience_features": [
      "outdoor",
      "natural light",
      "greenery"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 7922828e-d4e7-4286-8c15-011bc5b62c05:
[
  {
    "image_id": "7922828e-d4e7-4286-8c15-011bc5b62c05",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand holds a colorful soft-serve ice cream cone with multiple swirled layers of pink, orange, yellow, and blue. The ice cream is in a waffle cone wrapped with a pink and white patterned paper. The background is blurred with green foliage and large planters.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.9
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.98
      },
      {
        "name": "soft serve",
        "confidence": 0.95
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "dessert",
      "sweet",
      "treat",
      "colorful",
      "summer",
      "refreshing"
    ],
    "ambience_features": [
      "outdoor",
      "natural light",
      "greenery"
    ],
    "thumbnail_rank": 1.0
  }
]
Cleaned response for image_id 7922828e-d4e7-4286-8c15-011bc5b62c05:
[
  {
    "image_id": "7922828e-d4e7-4286-8c15-011bc5b62c05",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand holds a colorful soft-serve ice cream cone with multiple swirled layers of pink, orange, yellow, and blue. The ice cream is in a waffle cone wrapped with a pink and white patterned paper. The background is blurred with green foliage and large planters.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.9
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.98
      },
      {
        "name": "soft serve",
        "confidence": 0.95
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "dessert",
      "sweet",
      "treat",
      "colorful",
      "summer",
      "refreshing"
    ],
    "ambience_features": [
      "outdoor",
      "natural light",
      "greenery"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 7922828e-d4e7-4286-8c15-011bc5b62c05, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Aggregated quality_score: 0.88
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D10EB50>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D10E910>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:53:03 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: f6f542ba-67e8-4d90-ba18-641f2f2600bc
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.88, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.528, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:53:03] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: icecream, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'icecream' and search_type 'text'
DEBUG:root:Expanded synonyms for keywords ['icecream']: []
DEBUG:root:Keywords: ['icecream'], Synonyms: []
DEBUG:root:Generating text embedding for query 'icecream' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'icecream', length: 768
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D2B8250>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D2BA1D0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:53:16 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:53:27 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 0 keyword search results.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1200794585 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11397945850000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09746501575000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09894731850000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10294731850000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12373608675 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1111405095 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10902911900000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1001601245 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.17516012450000001 (threshold: 0.2)
DEBUG:root:Search completed, returning 0 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:53:39] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: icecream, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'icecream' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['icecream']: []
DEBUG:root:Keywords: ['icecream'], Synonyms: []
DEBUG:root:Generating text embedding for query 'icecream' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:root:Search initiated with query: icecream, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'icecream' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['icecream']: []
DEBUG:root:Keywords: ['icecream'], Synonyms: []
DEBUG:root:Generating text embedding for query 'icecream' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'icecream', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D120890>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D2BB0D0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:53:49 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:root:Generated text embedding for query 'icecream', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D122350>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D2B98D0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:53:50 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 text-to-image search results from Qdrant.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1200794585 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11397945850000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09746501575000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09894731850000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10294731850000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12373608675 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1111405095 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10902911900000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1001601245 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.17516012450000001 (threshold: 0.2)
DEBUG:root:Search completed, returning 0 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:54:09] "POST /search HTTP/1.1" 200 -
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 text-to-image search results from Qdrant.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1200794585 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11397945850000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09746501575000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09894731850000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10294731850000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12373608675 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1111405095 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10902911900000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1001601245 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.17516012450000001 (threshold: 0.2)
DEBUG:root:Search completed, returning 0 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:54:12] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: karahi, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'karahi' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['karahi']: ['curry', 'stew']
DEBUG:root:Keywords: ['karahi'], Synonyms: ['stew', 'curry']
DEBUG:root:Generating text embedding for query 'karahi' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'karahi', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D2D8F90>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D2DB6D0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:54:41 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 text-to-image search results from Qdrant.
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.4143987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.06999999999999999, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.4253987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.075, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.3393987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.06999999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.2366582004166667, keyword_score: 0.3333333333333333, semantic_score: 0.036366135, quality_score: 0.092, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.22835820041666668, keyword_score: 0.3333333333333333, semantic_score: 0.036366135, quality_score: 0.088, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.85
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.24007298566666668, keyword_score: 0.3333333333333333, semantic_score: 0.016425276, quality_score: 0.074, personal_score: 0.1, geo_score: 0.85, thumbnail_rank: 0.9400000000000001
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09565325625000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10801055350000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11248299275000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10638299275000002 (threshold: 0.2)
DEBUG:root:Search completed, returning 6 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:54:45] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: burger, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting search with query 'burger' and search_type 'image'
DEBUG:root:Expanded synonyms for keywords ['burger']: []
DEBUG:root:Keywords: ['burger'], Synonyms: []
DEBUG:root:Generating text embedding for query 'burger' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'burger', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723BB72490>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002723ACA9EB0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002723D10D090>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 08:55:20 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 text-to-image search results from Qdrant.
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.46753909999999993, keyword_score: 1.0, semantic_score: 0.0497564, quality_score: 0.088, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.9
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1017507175 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.46491179124999993, keyword_score: 1.0, semantic_score: 0.031447165, quality_score: 0.08524999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.95
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.47540606924999995, keyword_score: 1.0, semantic_score: 0.024424277, quality_score: 0.074, personal_score: 0.1, geo_score: 0.85, thumbnail_rank: 0.9400000000000001
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09932296375 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10332296375000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10558810900000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11168810900000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09783500525000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.17283500525 (threshold: 0.2)
DEBUG:root:Search completed, returning 3 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 13:55:34] "POST /search HTTP/1.1" 200 -
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Detected change in 'C:\\Users\\mamuj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\json\\__init__.py', reloading
INFO:werkzeug: * Detected change in 'C:\\Users\\mamuj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\os.py', reloading
INFO:werkzeug: * Detected change in 'C:\\Users\\mamuj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\_collections_abc.py', reloading
INFO:werkzeug: * Detected change in 'C:\\Users\\mamuj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\abc.py', reloading
INFO:werkzeug: * Detected change in 'C:\\Users\\mamuj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\_py_abc.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\dotenv\\__init__.py', reloading
INFO:werkzeug: * Detected change in 'C:\\Users\\mamuj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\datetime.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\google\\generativeai\\__init__.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\PIL\\__init__.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\PIL\\Image.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\PIL\\ImagePalette.py', reloading
INFO:werkzeug: * Detected change in 'C:\\Users\\mamuj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\collections\\__init__.py', reloading
INFO:werkzeug: * Detected change in 'C:\\Users\\mamuj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\collections\\abc.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\PIL\\ImageCms.py', reloading
INFO:werkzeug: * Detected change in 'C:\\Users\\mamuj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\enum.py', reloading
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001D58A04AE50>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001D5897560F0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001D589A94A90>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:01:15 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 120-019-553
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\numpy\\core\\_methods.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\catalogue\\__init__.py', reloading
INFO:werkzeug: * Detected change in 'C:\\Users\\mamuj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\importlib\\__init__.py', reloading
INFO:werkzeug: * Detected change in 'C:\\Users\\mamuj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\importlib\\metadata\\__init__.py', reloading
INFO:werkzeug: * Detected change in 'C:\\Users\\mamuj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\importlib\\abc.py', reloading
INFO:werkzeug: * Detected change in 'C:\\Users\\mamuj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\importlib\\_abc.py', reloading
INFO:werkzeug: * Detected change in 'C:\\Users\\mamuj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\importlib\\_bootstrap.py', reloading
INFO:werkzeug: * Detected change in 'C:\\Users\\mamuj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\importlib\\_bootstrap_external.py', reloading
INFO:werkzeug: * Detected change in 'C:\\Users\\mamuj\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\zipimport.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\qdrant_client\\http\\api\\points_api.py', reloading
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000265ADCF3750>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000265ADB660F0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000265AC3B6A90>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:01:25 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 120-019-553
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:01:41] "GET /?pakistani_cuisine=0.5&italian_cuisine=0.6&chinese_cuisine=0.2&quality_expectation=7 HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: karahi, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'karahi'
DEBUG:root:Expanded synonyms for keywords ['karahi']: ['curry', 'stew']
DEBUG:root:Keywords: ['karahi'], Synonyms: ['curry', 'stew']
DEBUG:root:Generating text embedding for query 'karahi' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user HTTP/1.1" 307 0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user/ HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'karahi', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000265AFAC0F50>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000265ADB660F0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000265AFAC2310>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:01:58 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 text-to-image search results from Qdrant.
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:02:02 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:02:09 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 5 keyword search results.
DEBUG:root:Combined 10 unique results from text-to-image and text-to-text searches.
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.4143987783333333 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.4253987783333333 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.3393987783333333 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.2366582004166667 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.22835820041666668 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.24007298566666668 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09565325625000001 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10801055350000002 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11248299275000001 (threshold: 0.5)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10638299275000002 (threshold: 0.5)
DEBUG:root:Search completed, returning 0 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:02:16] "POST /search HTTP/1.1" 200 -
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C4D91F90>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000136C4B260F0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C4B8BB90>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:02:42 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 120-019-553
DEBUG:root:Search initiated with query: karahi, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'karahi'
DEBUG:root:Expanded synonyms for keywords ['karahi']: ['curry', 'stew']
DEBUG:root:Keywords: ['karahi'], Synonyms: ['curry', 'stew']
DEBUG:root:Generating text embedding for query 'karahi' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user HTTP/1.1" 307 0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user/ HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'karahi', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:02:44 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 text-to-image search results from Qdrant.
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:02:49 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:02:54 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 5 keyword search results.
DEBUG:root:Combined 10 unique results from text-to-image and text-to-text searches.
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.4143987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.06999999999999999, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.4253987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.075, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.3393987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.06999999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.2366582004166667, keyword_score: 0.3333333333333333, semantic_score: 0.036366135, quality_score: 0.092, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.22835820041666668, keyword_score: 0.3333333333333333, semantic_score: 0.036366135, quality_score: 0.088, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.85
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.24007298566666668, keyword_score: 0.3333333333333333, semantic_score: 0.016425276, quality_score: 0.074, personal_score: 0.1, geo_score: 0.85, thumbnail_rank: 0.9400000000000001
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09565325625000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10801055350000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11248299275000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10638299275000002 (threshold: 0.2)
DEBUG:root:Search completed, returning 6 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:03:00] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: burger, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'burger'
DEBUG:root:Expanded synonyms for keywords ['burger']: []
DEBUG:root:Keywords: ['burger'], Synonyms: []
DEBUG:root:Generating text embedding for query 'burger' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'burger', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C48F6710>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000136C4B260F0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C4DB1810>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:03:23 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 text-to-image search results from Qdrant.
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:03:25 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:03:28 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 2 keyword search results.
DEBUG:root:Combined 10 unique results from text-to-image and text-to-text searches.
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.46753909999999993, keyword_score: 1.0, semantic_score: 0.0497564, quality_score: 0.088, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.9
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1017507175 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.46491179124999993, keyword_score: 1.0, semantic_score: 0.031447165, quality_score: 0.08524999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.95
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.47540606924999995, keyword_score: 1.0, semantic_score: 0.024424277, quality_score: 0.074, personal_score: 0.1, geo_score: 0.85, thumbnail_rank: 0.9400000000000001
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09932296375 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10332296375000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10558810900000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11168810900000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09783500525000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.17283500525 (threshold: 0.2)
DEBUG:root:Search completed, returning 3 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:03:31] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: icecream, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'icecream'
DEBUG:root:Expanded synonyms for keywords ['icecream']: []
DEBUG:root:Keywords: ['icecream'], Synonyms: []
DEBUG:root:Generating text embedding for query 'icecream' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'icecream', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C4B62FD0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000136C4B260F0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C4B62C90>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:03:49 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 text-to-image search results from Qdrant.
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:03:55 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:04:02 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 0 keyword search results.
DEBUG:root:Combined 10 unique results from text-to-image and text-to-text searches.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1200794585 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11397945850000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09746501575000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09894731850000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10294731850000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12373608675 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1111405095 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10902911900000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1001601245 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.17516012450000001 (threshold: 0.2)
DEBUG:root:Search completed, returning 0 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:04:08] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: cone, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'cone'
DEBUG:root:Expanded synonyms for keywords ['cone']: []
DEBUG:root:Keywords: ['cone'], Synonyms: []
DEBUG:root:Generating text embedding for query 'cone' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'cone', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C4B62890>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000136C4B260F0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C59B1DD0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:04:16 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 text-to-image search results from Qdrant.
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:04:19 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:04:23 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 1 keyword search results.
DEBUG:root:Combined 10 unique results from text-to-image and text-to-text searches.
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.461647999, keyword_score: 1.0, semantic_score: 0.030591996, quality_score: 0.095, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.85
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.117747999 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10724921550000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09505612880000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.0990561288 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09212623882500001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1063738151 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.17020249315 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09520249315000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.18120249314999998 (threshold: 0.2)
DEBUG:root:Search completed, returning 1 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:04:29] "POST /search HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Bakery', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 1500.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'best ambiance', 'hashtags': ['family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:root:Assigned image_id: f590fb9e-504d-4b54-bf54-c125feec5ccb
DEBUG:root:Opening image for image_id: f590fb9e-504d-4b54-bf54-c125feec5ccb
DEBUG:root:Image converted to JPEG for image_id: f590fb9e-504d-4b54-bf54-c125feec5ccb
DEBUG:root:Sending image to Gemini model for image_id: f590fb9e-504d-4b54-bf54-c125feec5ccb
DEBUG:root:Raw Gemini response for image_id f590fb9e-504d-4b54-bf54-c125feec5ccb:
```json
[
  {
    "image_id": "f590fb9e-504d-4b54-bf54-c125feec5ccb",
    "scene": "ambiance",
    "visual": {
      "description": "A glimpse into a bustling Pakistani kitchen. Chefs in white uniforms are seen preparing food behind a glass partition. Shelves filled with round, possibly bamboo steamers, are prominently displayed. The overall impression is one of a clean and efficient food preparation environment.",
      "confidence": 0.9,
      "quality": 0.85,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "kitchen",
      "chefs",
      "pakistani cuisine",
      "preparation",
      "steamers",
      "food service",
      "restaurant"
    ],
    "ambience_features": [
      "clean",
      "organized",
      "professional",
      "warm lighting",
      "glass partition"
    ],
    "thumbnail_rank": 1.0
  }
]
```
Raw response for image_id f590fb9e-504d-4b54-bf54-c125feec5ccb:
```json
[
  {
    "image_id": "f590fb9e-504d-4b54-bf54-c125feec5ccb",
    "scene": "ambiance",
    "visual": {
      "description": "A glimpse into a bustling Pakistani kitchen. Chefs in white uniforms are seen preparing food behind a glass partition. Shelves filled with round, possibly bamboo steamers, are prominently displayed. The overall impression is one of a clean and efficient food preparation environment.",
      "confidence": 0.9,
      "quality": 0.85,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "kitchen",
      "chefs",
      "pakistani cuisine",
      "preparation",
      "steamers",
      "food service",
      "restaurant"
    ],
    "ambience_features": [
      "clean",
      "organized",
      "professional",
      "warm lighting",
      "glass partition"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id f590fb9e-504d-4b54-bf54-c125feec5ccb:
[
  {
    "image_id": "f590fb9e-504d-4b54-bf54-c125feec5ccb",
    "scene": "ambiance",
    "visual": {
      "description": "A glimpse into a bustling Pakistani kitchen. Chefs in white uniforms are seen preparing food behind a glass partition. Shelves filled with round, possibly bamboo steamers, are prominently displayed. The overall impression is one of a clean and efficient food preparation environment.",
      "confidence": 0.9,
      "quality": 0.85,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "kitchen",
      "chefs",
      "pakistani cuisine",
      "preparation",
      "steamers",
      "food service",
      "restaurant"
    ],
    "ambience_features": [
      "clean",
      "organized",
      "professional",
      "warm lighting",
      "glass partition"
    ],
    "thumbnail_rank": 1.0
  }
]
Cleaned response for image_id f590fb9e-504d-4b54-bf54-c125feec5ccb:
[
  {
    "image_id": "f590fb9e-504d-4b54-bf54-c125feec5ccb",
    "scene": "ambiance",
    "visual": {
      "description": "A glimpse into a bustling Pakistani kitchen. Chefs in white uniforms are seen preparing food behind a glass partition. Shelves filled with round, possibly bamboo steamers, are prominently displayed. The overall impression is one of a clean and efficient food preparation environment.",
      "confidence": 0.9,
      "quality": 0.85,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "kitchen",
      "chefs",
      "pakistani cuisine",
      "preparation",
      "steamers",
      "food service",
      "restaurant"
    ],
    "ambience_features": [
      "clean",
      "organized",
      "professional",
      "warm lighting",
      "glass partition"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id f590fb9e-504d-4b54-bf54-c125feec5ccb, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Aggregated quality_score: 0.85
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C4DDC910>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000136C4B260F0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C4DDFF10>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:05:15 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: 894c6f8e-a049-410a-8293-ad24ec6c6dd7
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.85, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.51, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:05:15] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: ambiance, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'ambiance'
DEBUG:root:Expanded synonyms for keywords ['ambiance']: []
DEBUG:root:Keywords: ['ambiance'], Synonyms: []
DEBUG:root:Generating text embedding for query 'ambiance' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'ambiance', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C6B3C390>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000136C4B260F0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C6B3FA50>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:05:34 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 text-to-image search results from Qdrant.
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:05:41 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:05:49 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 0 keyword search results.
DEBUG:root:Combined 10 unique results from text-to-image and text-to-text searches.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11513968625 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11214374475000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10604374475 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.17349198325 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09849198325000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.18449198325 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09417630240000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12068941175 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10755641457500001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.0989708108 (threshold: 0.2)
DEBUG:root:Search completed, returning 0 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:05:55] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: bakery, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'bakery'
DEBUG:root:Expanded synonyms for keywords ['bakery']: []
DEBUG:root:Keywords: ['bakery'], Synonyms: []
DEBUG:root:Generating text embedding for query 'bakery' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'bakery', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C6AFD150>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000136C4B260F0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C6AFEC90>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:06:07 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 text-to-image search results from Qdrant.
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:06:11 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:06:15 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 0 keyword search results.
DEBUG:root:Combined 10 unique results from text-to-image and text-to-text searches.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12077321825 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1889557865 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10295578650000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.17795578650000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12430297325 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.096866587 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11131655550000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.109334178 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10247182675000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09847182675000002 (threshold: 0.2)
DEBUG:root:Search completed, returning 0 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:06:21] "POST /search HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:06:26] "GET /?pakistani_cuisine=0.5&italian_cuisine=0.6&chinese_cuisine=0.2&quality_expectation=7 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:09:02] "GET /?pakistani_cuisine=0.5&italian_cuisine=0.6&chinese_cuisine=0.2&quality_expectation=7 HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: karahi, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'karahi'
DEBUG:root:Expanded synonyms for keywords ['karahi']: ['curry', 'stew']
DEBUG:root:Keywords: ['karahi'], Synonyms: ['curry', 'stew']
DEBUG:root:Generating text embedding for query 'karahi' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'karahi', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C4E67410>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000136C4B260F0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C4E656D0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:09:17 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 text-to-image search results from Qdrant.
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:09:21 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:09:31 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 4 keyword search results.
DEBUG:root:Combined 10 unique results from text-to-image and text-to-text searches.
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.4253987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.075, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.4143987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.06999999999999999, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.3393987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.06999999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.2366582004166667, keyword_score: 0.3333333333333333, semantic_score: 0.036366135, quality_score: 0.092, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.22835820041666668, keyword_score: 0.3333333333333333, semantic_score: 0.036366135, quality_score: 0.088, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.85
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11723902925 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.24007298566666668, keyword_score: 0.3333333333333333, semantic_score: 0.016425276, quality_score: 0.074, personal_score: 0.1, geo_score: 0.85, thumbnail_rank: 0.9400000000000001
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09565325625000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10801055350000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11248299275000001 (threshold: 0.2)
DEBUG:root:Search completed, returning 6 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:09:43] "POST /search HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:17:47] "GET /?pakistani_cuisine=0.5&italian_cuisine=0.6&chinese_cuisine=0.2&quality_expectation=7 HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Karachi Darbar', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 1500.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'Amazing chicken karahi with perfect spice level!', 'hashtags': ['karahi', 'spicy', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:root:Assigned image_id: d2716a8d-0db3-45c5-ba28-65ceee2206da
DEBUG:root:Opening image for image_id: d2716a8d-0db3-45c5-ba28-65ceee2206da
DEBUG:root:Image converted to JPEG for image_id: d2716a8d-0db3-45c5-ba28-65ceee2206da
DEBUG:root:Sending image to Gemini model for image_id: d2716a8d-0db3-45c5-ba28-65ceee2206da
DEBUG:root:Raw Gemini response for image_id d2716a8d-0db3-45c5-ba28-65ceee2206da:
```json
[
  {
    "image_id": "d2716a8d-0db3-45c5-ba28-65ceee2206da",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand holding a colorful soft-serve ice cream cone with multiple swirls of pink, orange, yellow, and blue. The cone is wrapped in a white paper with pink polka dots. The background is blurred, showing greenery and large planters.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.92
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.98
      },
      {
        "name": "soft serve",
        "confidence": 0.97
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "dessert",
      "sweet",
      "colorful",
      "cone",
      "soft serve",
      "hand-held",
      "summer",
      "treat"
    ],
    "ambience_features": [
      "outdoor",
      "greenery",
      "planters"
    ],
    "thumbnail_rank": 1.5
  }
]
```
Raw response for image_id d2716a8d-0db3-45c5-ba28-65ceee2206da:
```json
[
  {
    "image_id": "d2716a8d-0db3-45c5-ba28-65ceee2206da",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand holding a colorful soft-serve ice cream cone with multiple swirls of pink, orange, yellow, and blue. The cone is wrapped in a white paper with pink polka dots. The background is blurred, showing greenery and large planters.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.92
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.98
      },
      {
        "name": "soft serve",
        "confidence": 0.97
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "dessert",
      "sweet",
      "colorful",
      "cone",
      "soft serve",
      "hand-held",
      "summer",
      "treat"
    ],
    "ambience_features": [
      "outdoor",
      "greenery",
      "planters"
    ],
    "thumbnail_rank": 1.5
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id d2716a8d-0db3-45c5-ba28-65ceee2206da:
[
  {
    "image_id": "d2716a8d-0db3-45c5-ba28-65ceee2206da",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand holding a colorful soft-serve ice cream cone with multiple swirls of pink, orange, yellow, and blue. The cone is wrapped in a white paper with pink polka dots. The background is blurred, showing greenery and large planters.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.92
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.98
      },
      {
        "name": "soft serve",
        "confidence": 0.97
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "dessert",
      "sweet",
      "colorful",
      "cone",
      "soft serve",
      "hand-held",
      "summer",
      "treat"
    ],
    "ambience_features": [
      "outdoor",
      "greenery",
      "planters"
    ],
    "thumbnail_rank": 1.5
  }
]
Cleaned response for image_id d2716a8d-0db3-45c5-ba28-65ceee2206da:
[
  {
    "image_id": "d2716a8d-0db3-45c5-ba28-65ceee2206da",
    "scene": "dish_closeup",
    "visual": {
      "description": "A hand holding a colorful soft-serve ice cream cone with multiple swirls of pink, orange, yellow, and blue. The cone is wrapped in a white paper with pink polka dots. The background is blurred, showing greenery and large planters.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.92
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.98
      },
      {
        "name": "soft serve",
        "confidence": 0.97
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "dessert",
      "sweet",
      "colorful",
      "cone",
      "soft serve",
      "hand-held",
      "summer",
      "treat"
    ],
    "ambience_features": [
      "outdoor",
      "greenery",
      "planters"
    ],
    "thumbnail_rank": 1.5
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id d2716a8d-0db3-45c5-ba28-65ceee2206da, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Aggregated quality_score: 0.88
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C6BA91D0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000136C4B260F0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C4B88A50>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:18:09 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: 22b798ba-7ede-4293-9add-2e82bb60d934
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.88, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.528, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:18:09] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: karahi, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'karahi'
DEBUG:root:Expanded synonyms for keywords ['karahi']: ['curry', 'stew']
DEBUG:root:Keywords: ['karahi'], Synonyms: ['curry', 'stew']
DEBUG:root:Generating text embedding for query 'karahi' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'karahi', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C4E710D0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000136C4B260F0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C4B78910>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:18:29 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 text-to-image search results from Qdrant.
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:18:38 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:19:01 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 3 keyword search results.
DEBUG:root:Combined 10 unique results from text-to-image and text-to-text searches.
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.4253987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.075, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.3393987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.06999999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 2, score: 0.6666666666666666
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.5
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.4143987783333333, keyword_score: 0.6666666666666666, semantic_score: 0.03826178, quality_score: 0.06999999999999999, personal_score: 0.5, geo_score: 0.85, thumbnail_rank: 0.8
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.2366582004166667, keyword_score: 0.3333333333333333, semantic_score: 0.036366135, quality_score: 0.092, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.22835820041666668, keyword_score: 0.3333333333333333, semantic_score: 0.036366135, quality_score: 0.088, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.85
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11723902925 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 1, score: 0.3333333333333333
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.24007298566666668, keyword_score: 0.3333333333333333, semantic_score: 0.016425276, quality_score: 0.074, personal_score: 0.1, geo_score: 0.85, thumbnail_rank: 0.9400000000000001
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09565325625000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10801055350000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11248299275000001 (threshold: 0.2)
DEBUG:root:Search completed, returning 6 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:19:18] "POST /search HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:19:48] "GET /?pakistani_cuisine=0.5&italian_cuisine=0.6&chinese_cuisine=0.2&quality_expectation=7 HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: burger, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'burger'
DEBUG:root:Expanded synonyms for keywords ['burger']: []
DEBUG:root:Keywords: ['burger'], Synonyms: []
DEBUG:root:Generating text embedding for query 'burger' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'burger', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C6B42D50>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000136C4B260F0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C59D5790>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:21:07 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 text-to-image search results from Qdrant.
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:21:16 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:21:28 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 2 keyword search results.
DEBUG:root:Combined 10 unique results from text-to-image and text-to-text searches.
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.46753909999999993, keyword_score: 1.0, semantic_score: 0.0497564, quality_score: 0.088, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.9
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1017507175 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.46491179124999993, keyword_score: 1.0, semantic_score: 0.031447165, quality_score: 0.08524999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.95
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1164045675 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.47540606924999995, keyword_score: 1.0, semantic_score: 0.024424277, quality_score: 0.074, personal_score: 0.1, geo_score: 0.85, thumbnail_rank: 0.9400000000000001
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09932296375 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10332296375000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11168810900000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.136688109 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10558810900000001 (threshold: 0.2)
DEBUG:root:Search completed, returning 3 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:21:40] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: karahi, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'karahi'
DEBUG:root:Expanded synonyms for keywords ['karahi']: ['curry', 'stew']
DEBUG:root:Keywords: ['karahi'], Synonyms: ['curry', 'stew']
DEBUG:root:Generating text embedding for query 'karahi' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'karahi', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C32705D0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000136C4B260F0> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000136C6B3D2D0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 09:22:06 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\thinc\\api.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\qdrant_client\\grpc\\__init__.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\google\\api_core\\gapic_v1\\__init__.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\google\\api_core\\gapic_v1\\client_info.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\google\\api_core\\client_info.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\numpy\\typing\\__init__.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\PIL\\GifImagePlugin.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\PIL\\ImageFile.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\numpy\\_typing\\__init__.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\numpy\\_typing\\_nested_sequence.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\numpy\\_typing\\_nbit.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\numpy\\_typing\\_shape.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\numpy\\_typing\\_dtype_like.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\numpy\\_typing\\_array_like.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\numpy\\_typing\\_generic_alias.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\pydantic\\_migration.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\pydantic\\aliases.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\pydantic\\_internal\\_internal_dataclass.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\pydantic\\_internal\\_generate_schema.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\qdrant_client\\grpc\\points_pb2.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\qdrant_client\\grpc\\collections_pb2.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\qdrant_client\\grpc\\snapshots_service_pb2.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\qdrant_client\\grpc\\json_with_int_pb2.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\qdrant_client\\grpc\\collections_service_pb2_grpc.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\qdrant_client\\grpc\\points_service_pb2_grpc.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\qdrant_client\\grpc\\snapshots_service_pb2_grpc.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\flask\\__init__.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\flask\\json\\__init__.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\flask\\app.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\flask\\globals.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\werkzeug\\datastructures\\__init__.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\werkzeug\\utils.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\werkzeug\\wrappers\\__init__.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\flask\\typing.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\flask\\scaffold.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\flask\\wrappers.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\werkzeug\\wrappers\\request.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\werkzeug\\wrappers\\response.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\werkzeug\\_internal.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\werkzeug\\sansio\\response.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\werkzeug\\datastructures\\headers.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\werkzeug\\datastructures\\structures.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\werkzeug\\sansio\\request.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\scipy\\sparse\\__init__.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\scipy\\sparse\\_base.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\scipy\\sparse\\_csr.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\scipy\\sparse\\_csc.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\scipy\\sparse\\_lil.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\scipy\\sparse\\_dok.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\scipy\\sparse\\_coo.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\scipy\\sparse\\_dia.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\scipy\\sparse\\_bsr.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\scipy\\sparse\\_construct.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\scipy\\sparse\\_extract.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\scipy\\sparse\\_matrix.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\scipy\\sparse\\_matrix_io.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\PIL\\_util.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\PIL\\ImageMode.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\PIL\\PyAccess.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\nomic\\dataset.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\google\\ai\\generativelanguage_v1beta\\types\\file.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\proto\\modules.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\flask\\templating.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\jinja2\\__init__.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\jinja2\\environment.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\werkzeug\\datastructures\\file_storage.py', reloading
INFO:werkzeug: * Detected change in 'D:\\Khapey\\Khapey-MVP\\venv\\Lib\\site-packages\\werkzeug\\datastructures\\mixins.py', reloading
DEBUG:root:Initializing KhapeyMVP...
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002277157C2D0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000227714DA600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002277185BF90>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:07:12 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C5CE3D3A10>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C5CE7AA600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C5CE948C90>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:07:16 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 105-820-945
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:08:38] "GET / HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:08:38] "[33mGET /favicon.ico HTTP/1.1[0m" 404 -
DEBUG:root:Review data prepared: {'restaurantName': 'Karachi Darbar', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 1500.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'Amazing chicken karahi with perfect spice level!', 'hashtags': ['karahi', 'spicy', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/2...
DEBUG:root:Assigned image_id: 1dafa047-2407-4b40-bc79-0b0acf81d236
DEBUG:root:Opening image for image_id: 1dafa047-2407-4b40-bc79-0b0acf81d236
DEBUG:PIL.Image:Importing BlpImagePlugin
DEBUG:PIL.Image:Importing BmpImagePlugin
DEBUG:PIL.Image:Importing BufrStubImagePlugin
DEBUG:PIL.Image:Importing CurImagePlugin
DEBUG:PIL.Image:Importing DcxImagePlugin
DEBUG:PIL.Image:Importing DdsImagePlugin
DEBUG:PIL.Image:Importing EpsImagePlugin
DEBUG:PIL.Image:Importing FitsImagePlugin
DEBUG:PIL.Image:Importing FliImagePlugin
DEBUG:PIL.Image:Importing FpxImagePlugin
DEBUG:PIL.Image:Image: failed to import FpxImagePlugin: No module named 'olefile'
DEBUG:PIL.Image:Importing FtexImagePlugin
DEBUG:PIL.Image:Importing GbrImagePlugin
DEBUG:PIL.Image:Importing GifImagePlugin
DEBUG:PIL.Image:Importing GribStubImagePlugin
DEBUG:PIL.Image:Importing Hdf5StubImagePlugin
DEBUG:PIL.Image:Importing IcnsImagePlugin
DEBUG:PIL.Image:Importing IcoImagePlugin
DEBUG:PIL.Image:Importing ImImagePlugin
DEBUG:PIL.Image:Importing ImtImagePlugin
DEBUG:PIL.Image:Importing IptcImagePlugin
DEBUG:PIL.Image:Importing JpegImagePlugin
DEBUG:PIL.Image:Importing Jpeg2KImagePlugin
DEBUG:PIL.Image:Importing McIdasImagePlugin
DEBUG:PIL.Image:Importing MicImagePlugin
DEBUG:PIL.Image:Image: failed to import MicImagePlugin: No module named 'olefile'
DEBUG:PIL.Image:Importing MpegImagePlugin
DEBUG:PIL.Image:Importing MpoImagePlugin
DEBUG:PIL.Image:Importing MspImagePlugin
DEBUG:PIL.Image:Importing PalmImagePlugin
DEBUG:PIL.Image:Importing PcdImagePlugin
DEBUG:PIL.Image:Importing PcxImagePlugin
DEBUG:PIL.Image:Importing PdfImagePlugin
DEBUG:PIL.Image:Importing PixarImagePlugin
DEBUG:PIL.Image:Importing PngImagePlugin
DEBUG:PIL.Image:Importing PpmImagePlugin
DEBUG:PIL.Image:Importing PsdImagePlugin
DEBUG:PIL.Image:Importing QoiImagePlugin
DEBUG:PIL.Image:Importing SgiImagePlugin
DEBUG:PIL.Image:Importing SpiderImagePlugin
DEBUG:PIL.Image:Importing SunImagePlugin
DEBUG:PIL.Image:Importing TgaImagePlugin
DEBUG:PIL.Image:Importing TiffImagePlugin
DEBUG:PIL.Image:Importing WebPImagePlugin
DEBUG:PIL.Image:Importing WmfImagePlugin
DEBUG:PIL.Image:Importing XbmImagePlugin
DEBUG:PIL.Image:Importing XpmImagePlugin
DEBUG:PIL.Image:Importing XVThumbImagePlugin
DEBUG:root:Image converted to JPEG for image_id: 1dafa047-2407-4b40-bc79-0b0acf81d236
DEBUG:root:Sending image to Gemini model for image_id: 1dafa047-2407-4b40-bc79-0b0acf81d236
DEBUG:root:Raw Gemini response for image_id 1dafa047-2407-4b40-bc79-0b0acf81d236:
```json
[
  {
    "image_id": "1dafa047-2407-4b40-bc79-0b0acf81d236",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a traditional copper pot filled with a yellowish, soupy curry. A hand is visible stirring the contents with a metal ladle.",
      "confidence": 0.95,
      "quality": 0.60,
      "appeal_score": 0.70
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.85
      },
      {
        "name": "nihari",
        "confidence": 0.50
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "pot",
      "copper",
      "ladle",
      "traditional",
      "soup",
      "Pakistani food"
    ],
    "ambience_features": [
      "traditional pot"
    ],
    "thumbnail_rank": 0.85
  }
]
```
Raw response for image_id 1dafa047-2407-4b40-bc79-0b0acf81d236:
```json
[
  {
    "image_id": "1dafa047-2407-4b40-bc79-0b0acf81d236",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a traditional copper pot filled with a yellowish, soupy curry. A hand is visible stirring the contents with a metal ladle.",
      "confidence": 0.95,
      "quality": 0.60,
      "appeal_score": 0.70
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.85
      },
      {
        "name": "nihari",
        "confidence": 0.50
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "pot",
      "copper",
      "ladle",
      "traditional",
      "soup",
      "Pakistani food"
    ],
    "ambience_features": [
      "traditional pot"
    ],
    "thumbnail_rank": 0.85
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 1dafa047-2407-4b40-bc79-0b0acf81d236:
[
  {
    "image_id": "1dafa047-2407-4b40-bc79-0b0acf81d236",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a traditional copper pot filled with a yellowish, soupy curry. A hand is visible stirring the contents with a metal ladle.",
      "confidence": 0.95,
      "quality": 0.60,
      "appeal_score": 0.70
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.85
      },
      {
        "name": "nihari",
        "confidence": 0.50
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "pot",
      "copper",
      "ladle",
      "traditional",
      "soup",
      "Pakistani food"
    ],
    "ambience_features": [
      "traditional pot"
    ],
    "thumbnail_rank": 0.85
  }
]
Cleaned response for image_id 1dafa047-2407-4b40-bc79-0b0acf81d236:
[
  {
    "image_id": "1dafa047-2407-4b40-bc79-0b0acf81d236",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a traditional copper pot filled with a yellowish, soupy curry. A hand is visible stirring the contents with a metal ladle.",
      "confidence": 0.95,
      "quality": 0.60,
      "appeal_score": 0.70
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.85
      },
      {
        "name": "nihari",
        "confidence": 0.50
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "pot",
      "copper",
      "ladle",
      "traditional",
      "soup",
      "Pakistani food"
    ],
    "ambience_features": [
      "traditional pot"
    ],
    "thumbnail_rank": 0.85
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user HTTP/1.1" 307 0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user/ HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 1dafa047-2407-4b40-bc79-0b0acf81d236, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Processing image 2/2...
DEBUG:root:Assigned image_id: 65738289-cd30-43cd-9419-36fa48705c20
DEBUG:root:Opening image for image_id: 65738289-cd30-43cd-9419-36fa48705c20
DEBUG:root:Image converted to JPEG for image_id: 65738289-cd30-43cd-9419-36fa48705c20
DEBUG:root:Sending image to Gemini model for image_id: 65738289-cd30-43cd-9419-36fa48705c20
DEBUG:root:Raw Gemini response for image_id 65738289-cd30-43cd-9419-36fa48705c20:
```json
[
  {
    "image_id": "65738289-cd30-43cd-9419-36fa48705c20",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of pakoras being fried in hot oil in a traditional karahi, with several freshly fried pakoras resting on a flat griddle in the foreground. The pakoras appear golden brown and crispy.",
      "confidence": 0.9,
      "quality": 0.7,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.95
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakora",
      "fried",
      "snack",
      "street food",
      "karahi",
      "crispy",
      "golden brown",
      "tea time"
    ],
    "ambience_features": [
      "street food stall",
      "cooking"
    ],
    "thumbnail_rank": 0.75
  }
]
```
Raw response for image_id 65738289-cd30-43cd-9419-36fa48705c20:
```json
[
  {
    "image_id": "65738289-cd30-43cd-9419-36fa48705c20",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of pakoras being fried in hot oil in a traditional karahi, with several freshly fried pakoras resting on a flat griddle in the foreground. The pakoras appear golden brown and crispy.",
      "confidence": 0.9,
      "quality": 0.7,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.95
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakora",
      "fried",
      "snack",
      "street food",
      "karahi",
      "crispy",
      "golden brown",
      "tea time"
    ],
    "ambience_features": [
      "street food stall",
      "cooking"
    ],
    "thumbnail_rank": 0.75
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 65738289-cd30-43cd-9419-36fa48705c20:
[
  {
    "image_id": "65738289-cd30-43cd-9419-36fa48705c20",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of pakoras being fried in hot oil in a traditional karahi, with several freshly fried pakoras resting on a flat griddle in the foreground. The pakoras appear golden brown and crispy.",
      "confidence": 0.9,
      "quality": 0.7,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.95
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakora",
      "fried",
      "snack",
      "street food",
      "karahi",
      "crispy",
      "golden brown",
      "tea time"
    ],
    "ambience_features": [
      "street food stall",
      "cooking"
    ],
    "thumbnail_rank": 0.75
  }
]
Cleaned response for image_id 65738289-cd30-43cd-9419-36fa48705c20:
[
  {
    "image_id": "65738289-cd30-43cd-9419-36fa48705c20",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of pakoras being fried in hot oil in a traditional karahi, with several freshly fried pakoras resting on a flat griddle in the foreground. The pakoras appear golden brown and crispy.",
      "confidence": 0.9,
      "quality": 0.7,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.95
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakora",
      "fried",
      "snack",
      "street food",
      "karahi",
      "crispy",
      "golden brown",
      "tea time"
    ],
    "ambience_features": [
      "street food stall",
      "cooking"
    ],
    "thumbnail_rank": 0.75
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 65738289-cd30-43cd-9419-36fa48705c20, length: 768
DEBUG:root:Image 2 processed successfully.
DEBUG:root:Aggregated quality_score: 0.6499999999999999
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C5D0983F10>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C5CE7AA600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C5D0982650>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:08:55 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: b7eeb5c1-31ac-450c-a012-08bcf2430db5
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.6499999999999999, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.38999999999999996, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:08:56] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: burgers, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'burgers'
DEBUG:root:Expanded synonyms for keywords ['burgers']: []
DEBUG:root:Keywords: ['burgers'], Synonyms: []
DEBUG:root:Generating text embedding for query 'burgers' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'burgers', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C5D098E950>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C5CE7AA600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C5D098C050>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:09:12 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 text-to-image search results from Qdrant.
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:09:13 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:09:14 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 0 keyword search results.
DEBUG:root:Combined 10 unique results from text-to-image and text-to-text searches.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1176578855 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10394982250000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.118067987 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11531681675000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12609074325000003 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.25
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.13946858575 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.0988766895 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10287668950000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.112893217 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.137893217 (threshold: 0.2)
DEBUG:root:Search completed, returning 0 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:09:15] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: beef burger, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'beef burger'
DEBUG:root:Expanded synonyms for keywords ['beef', 'burger']: []
DEBUG:root:Keywords: ['beef', 'burger'], Synonyms: []
DEBUG:root:Generating text embedding for query 'beef burger' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'beef burger', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C5D06C9890>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C5CE7AA600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C5D06C9A10>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:09:45 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 text-to-image search results from Qdrant.
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:09:48 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:09:49 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 2 keyword search results.
DEBUG:root:Combined 10 unique results from text-to-image and text-to-text searches.
DEBUG:root:Keyword score calculation - matches: 1, score: 0.5
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.294900165, keyword_score: 0.5, semantic_score: 0.05920066, quality_score: 0.088, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.9
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10425034600000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 1, score: 0.5
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.292153196, keyword_score: 0.5, semantic_score: 0.040412784, quality_score: 0.08524999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.95
DEBUG:root:Keyword score calculation - matches: 2, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.1
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.47735880324999996, keyword_score: 1.0, semantic_score: 0.032235213, quality_score: 0.074, personal_score: 0.1, geo_score: 0.85, thumbnail_rank: 0.9400000000000001
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.25
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.14004729875 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10074577200000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10474577200000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11503999925000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10533240000000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11363240000000001 (threshold: 0.2)
DEBUG:root:Search completed, returning 3 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:09:51] "POST /search HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:12:09] "GET / HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: ice cream, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'ice cream'
DEBUG:root:Expanded synonyms for keywords ['ice', 'cream']: []
DEBUG:root:Keywords: ['ice', 'cream'], Synonyms: []
DEBUG:root:Generating text embedding for query 'ice cream' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'ice cream', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C5D06C8D10>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C5CE7AA600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C5D06CA890>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:12:20 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 text-to-image search results from Qdrant.
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:12:21 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 10 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:12:22 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 0 keyword search results.
DEBUG:root:Combined 10 unique results from text-to-image and text-to-text searches.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1212703425 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11517034250000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1462703425 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11141983500000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1158081435 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09980622625000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10380622625000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.25
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1379119285 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1118539035 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09727582825000002 (threshold: 0.2)
DEBUG:root:Search completed, returning 0 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:12:24] "POST /search HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Coco Cubano', 'branchName': 'Gulberg', 'serviceType': 'dineIn', 'totalBill': 4500.0, 'rateUserExperience': {'foodTaste': 5, 'ambience': 5, 'staff': 4, 'willRecommend': 4}, 'averageRating': 4.5, 'userThoughts': "Visited this place today and loved it. Food, ambiance, service everything was amazing.\r\nSpecial thanks to hakeem Khan and the owner for having us at the restaurant. I'll recommend everyone to visit this place.\r\n", 'hashtags': ['ambiencemexicantacosnachos']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/3...
DEBUG:root:Assigned image_id: e96d4f8d-7262-4a30-98cf-9a9a8b40ceda
DEBUG:root:Opening image for image_id: e96d4f8d-7262-4a30-98cf-9a9a8b40ceda
DEBUG:root:Image converted to JPEG for image_id: e96d4f8d-7262-4a30-98cf-9a9a8b40ceda
DEBUG:root:Sending image to Gemini model for image_id: e96d4f8d-7262-4a30-98cf-9a9a8b40ceda
DEBUG:root:Raw Gemini response for image_id e96d4f8d-7262-4a30-98cf-9a9a8b40ceda:
[
  {
    "image_id": "e96d4f8d-7262-4a30-98cf-9a9a8b40ceda",
    "scene": "ambiance",
    "visual": {
      "description": "A cozy and dimly lit indoor seating area of a restaurant, featuring several groups of people dining at tables. A fireplace is visible in the foreground, adding to the warm atmosphere. The decor includes hanging plants and decorative lighting.",
      "confidence": 0.95,
      "quality": 0.8,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "dinner"
    },
    "items": [],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "restaurant",
      "dining",
      "people",
      "cozy",
      "fireplace",
      "indoor",
      "ambiance",
      "lighting",
      "evening"
    ],
    "ambience_features": [
      "fireplace",
      "hanging plants",
      "decorative lighting",
      "warm lighting"
    ],
    "thumbnail_rank": 1.0
  }
]
Raw response for image_id e96d4f8d-7262-4a30-98cf-9a9a8b40ceda:
[
  {
    "image_id": "e96d4f8d-7262-4a30-98cf-9a9a8b40ceda",
    "scene": "ambiance",
    "visual": {
      "description": "A cozy and dimly lit indoor seating area of a restaurant, featuring several groups of people dining at tables. A fireplace is visible in the foreground, adding to the warm atmosphere. The decor includes hanging plants and decorative lighting.",
      "confidence": 0.95,
      "quality": 0.8,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "dinner"
    },
    "items": [],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "restaurant",
      "dining",
      "people",
      "cozy",
      "fireplace",
      "indoor",
      "ambiance",
      "lighting",
      "evening"
    ],
    "ambience_features": [
      "fireplace",
      "hanging plants",
      "decorative lighting",
      "warm lighting"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
DEBUG:root:Cleaned response for image_id e96d4f8d-7262-4a30-98cf-9a9a8b40ceda:
[
  {
    "image_id": "e96d4f8d-7262-4a30-98cf-9a9a8b40ceda",
    "scene": "ambiance",
    "visual": {
      "description": "A cozy and dimly lit indoor seating area of a restaurant, featuring several groups of people dining at tables. A fireplace is visible in the foreground, adding to the warm atmosphere. The decor includes hanging plants and decorative lighting.",
      "confidence": 0.95,
      "quality": 0.8,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "dinner"
    },
    "items": [],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "restaurant",
      "dining",
      "people",
      "cozy",
      "fireplace",
      "indoor",
      "ambiance",
      "lighting",
      "evening"
    ],
    "ambience_features": [
      "fireplace",
      "hanging plants",
      "decorative lighting",
      "warm lighting"
    ],
    "thumbnail_rank": 1.0
  }
]
Cleaned response for image_id e96d4f8d-7262-4a30-98cf-9a9a8b40ceda:
[
  {
    "image_id": "e96d4f8d-7262-4a30-98cf-9a9a8b40ceda",
    "scene": "ambiance",
    "visual": {
      "description": "A cozy and dimly lit indoor seating area of a restaurant, featuring several groups of people dining at tables. A fireplace is visible in the foreground, adding to the warm atmosphere. The decor includes hanging plants and decorative lighting.",
      "confidence": 0.95,
      "quality": 0.8,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "dinner"
    },
    "items": [],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "restaurant",
      "dining",
      "people",
      "cozy",
      "fireplace",
      "indoor",
      "ambiance",
      "lighting",
      "evening"
    ],
    "ambience_features": [
      "fireplace",
      "hanging plants",
      "decorative lighting",
      "warm lighting"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id e96d4f8d-7262-4a30-98cf-9a9a8b40ceda, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Processing image 2/3...
DEBUG:root:Assigned image_id: ef4fa01b-bd08-4936-a4b0-a2fa59075afc
DEBUG:root:Opening image for image_id: ef4fa01b-bd08-4936-a4b0-a2fa59075afc
DEBUG:root:Image converted to JPEG for image_id: ef4fa01b-bd08-4936-a4b0-a2fa59075afc
DEBUG:root:Sending image to Gemini model for image_id: ef4fa01b-bd08-4936-a4b0-a2fa59075afc
DEBUG:root:Raw Gemini response for image_id ef4fa01b-bd08-4936-a4b0-a2fa59075afc:
[
  {
    "image_id": "ef4fa01b-bd08-4936-a4b0-a2fa59075afc",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of two crispy tacos filled with fried seafood and topped with a creamy sauce, diced peppers, and cilantro. The tacos are presented in a woven basket lined with patterned paper, with a side of tortilla chips also drizzled with sauce.",
      "confidence": 0.98,
      "quality": 0.92,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "tacos",
        "confidence": 0.95
      },
      {
        "name": "fried seafood",
        "confidence": 0.92
      },
      {
        "name": "tortilla chips",
        "confidence": 0.88
      },
      {
        "name": "sauce",
        "confidence": 0.90
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "tacos",
      "seafood",
      "fried",
      "basket",
      "chips",
      "sauce",
      "peppers",
      "cilantro"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.9
  }
]
Raw response for image_id ef4fa01b-bd08-4936-a4b0-a2fa59075afc:
[
  {
    "image_id": "ef4fa01b-bd08-4936-a4b0-a2fa59075afc",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of two crispy tacos filled with fried seafood and topped with a creamy sauce, diced peppers, and cilantro. The tacos are presented in a woven basket lined with patterned paper, with a side of tortilla chips also drizzled with sauce.",
      "confidence": 0.98,
      "quality": 0.92,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "tacos",
        "confidence": 0.95
      },
      {
        "name": "fried seafood",
        "confidence": 0.92
      },
      {
        "name": "tortilla chips",
        "confidence": 0.88
      },
      {
        "name": "sauce",
        "confidence": 0.90
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "tacos",
      "seafood",
      "fried",
      "basket",
      "chips",
      "sauce",
      "peppers",
      "cilantro"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.9
  }
]
==================================================
DEBUG:root:Cleaned response for image_id ef4fa01b-bd08-4936-a4b0-a2fa59075afc:
[
  {
    "image_id": "ef4fa01b-bd08-4936-a4b0-a2fa59075afc",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of two crispy tacos filled with fried seafood and topped with a creamy sauce, diced peppers, and cilantro. The tacos are presented in a woven basket lined with patterned paper, with a side of tortilla chips also drizzled with sauce.",
      "confidence": 0.98,
      "quality": 0.92,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "tacos",
        "confidence": 0.95
      },
      {
        "name": "fried seafood",
        "confidence": 0.92
      },
      {
        "name": "tortilla chips",
        "confidence": 0.88
      },
      {
        "name": "sauce",
        "confidence": 0.90
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "tacos",
      "seafood",
      "fried",
      "basket",
      "chips",
      "sauce",
      "peppers",
      "cilantro"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.9
  }
]
Cleaned response for image_id ef4fa01b-bd08-4936-a4b0-a2fa59075afc:
[
  {
    "image_id": "ef4fa01b-bd08-4936-a4b0-a2fa59075afc",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of two crispy tacos filled with fried seafood and topped with a creamy sauce, diced peppers, and cilantro. The tacos are presented in a woven basket lined with patterned paper, with a side of tortilla chips also drizzled with sauce.",
      "confidence": 0.98,
      "quality": 0.92,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "tacos",
        "confidence": 0.95
      },
      {
        "name": "fried seafood",
        "confidence": 0.92
      },
      {
        "name": "tortilla chips",
        "confidence": 0.88
      },
      {
        "name": "sauce",
        "confidence": 0.90
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "tacos",
      "seafood",
      "fried",
      "basket",
      "chips",
      "sauce",
      "peppers",
      "cilantro"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.9
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id ef4fa01b-bd08-4936-a4b0-a2fa59075afc, length: 768
DEBUG:root:Image 2 processed successfully.
DEBUG:root:Processing image 3/3...
DEBUG:root:Assigned image_id: 4c59c93a-ffaa-45ae-a98e-71885e39b9ae
DEBUG:root:Opening image for image_id: 4c59c93a-ffaa-45ae-a98e-71885e39b9ae
DEBUG:root:Image converted to JPEG for image_id: 4c59c93a-ffaa-45ae-a98e-71885e39b9ae
DEBUG:root:Sending image to Gemini model for image_id: 4c59c93a-ffaa-45ae-a98e-71885e39b9ae
DEBUG:root:Raw Gemini response for image_id 4c59c93a-ffaa-45ae-a98e-71885e39b9ae:
{"image_id": "4c59c93a-ffaa-45ae-a98e-71885e39b9ae", "scene": "dish_closeup", "visual": {"description": "A plate of nachos with toppings, including salsa, guacamole, sour cream, and what appears to be shredded chicken or beef. The nachos are golden brown and crisp. The dish is served in a dark green bowl.", "confidence": 0.9, "quality": 0.85, "appeal_score": 0.8}, "context": {"ambiance": "unknown", "lighting": "daylight", "meal_timing": "any"}, "items": [{"name": "nachos", "confidence": 0.95}, {"name": "salsa", "confidence": 0.8}, {"name": "guacamole", "confidence": 0.75}, {"name": "sour cream", "confidence": 0.7}], "flag_type": "none", "penalty_score": 0, "keywords": ["nachos", "mexican", "appetizer", "snack", "cheese", "salsa", "guacamole", "sour cream", "crispy"], "ambience_features": ["table", "fork"], "thumbnail_rank": 1.0}
Raw response for image_id 4c59c93a-ffaa-45ae-a98e-71885e39b9ae:
{"image_id": "4c59c93a-ffaa-45ae-a98e-71885e39b9ae", "scene": "dish_closeup", "visual": {"description": "A plate of nachos with toppings, including salsa, guacamole, sour cream, and what appears to be shredded chicken or beef. The nachos are golden brown and crisp. The dish is served in a dark green bowl.", "confidence": 0.9, "quality": 0.85, "appeal_score": 0.8}, "context": {"ambiance": "unknown", "lighting": "daylight", "meal_timing": "any"}, "items": [{"name": "nachos", "confidence": 0.95}, {"name": "salsa", "confidence": 0.8}, {"name": "guacamole", "confidence": 0.75}, {"name": "sour cream", "confidence": 0.7}], "flag_type": "none", "penalty_score": 0, "keywords": ["nachos", "mexican", "appetizer", "snack", "cheese", "salsa", "guacamole", "sour cream", "crispy"], "ambience_features": ["table", "fork"], "thumbnail_rank": 1.0}
==================================================
DEBUG:root:Cleaned response for image_id 4c59c93a-ffaa-45ae-a98e-71885e39b9ae:
{"image_id": "4c59c93a-ffaa-45ae-a98e-71885e39b9ae", "scene": "dish_closeup", "visual": {"description": "A plate of nachos with toppings, including salsa, guacamole, sour cream, and what appears to be shredded chicken or beef. The nachos are golden brown and crisp. The dish is served in a dark green bowl.", "confidence": 0.9, "quality": 0.85, "appeal_score": 0.8}, "context": {"ambiance": "unknown", "lighting": "daylight", "meal_timing": "any"}, "items": [{"name": "nachos", "confidence": 0.95}, {"name": "salsa", "confidence": 0.8}, {"name": "guacamole", "confidence": 0.75}, {"name": "sour cream", "confidence": 0.7}], "flag_type": "none", "penalty_score": 0, "keywords": ["nachos", "mexican", "appetizer", "snack", "cheese", "salsa", "guacamole", "sour cream", "crispy"], "ambience_features": ["table", "fork"], "thumbnail_rank": 1.0}
Cleaned response for image_id 4c59c93a-ffaa-45ae-a98e-71885e39b9ae:
{"image_id": "4c59c93a-ffaa-45ae-a98e-71885e39b9ae", "scene": "dish_closeup", "visual": {"description": "A plate of nachos with toppings, including salsa, guacamole, sour cream, and what appears to be shredded chicken or beef. The nachos are golden brown and crisp. The dish is served in a dark green bowl.", "confidence": 0.9, "quality": 0.85, "appeal_score": 0.8}, "context": {"ambiance": "unknown", "lighting": "daylight", "meal_timing": "any"}, "items": [{"name": "nachos", "confidence": 0.95}, {"name": "salsa", "confidence": 0.8}, {"name": "guacamole", "confidence": 0.75}, {"name": "sour cream", "confidence": 0.7}], "flag_type": "none", "penalty_score": 0, "keywords": ["nachos", "mexican", "appetizer", "snack", "cheese", "salsa", "guacamole", "sour cream", "crispy"], "ambience_features": ["table", "fork"], "thumbnail_rank": 1.0}
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 4c59c93a-ffaa-45ae-a98e-71885e39b9ae, length: 768
DEBUG:root:Image 3 processed successfully.
DEBUG:root:Aggregated quality_score: 0.8566666666666668
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C5CE966690>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C5CE7AA600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C5D07CD010>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:21:01 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: 40a9271e-a986-462a-b810-607a01822f36
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.8566666666666668, reputation_score: 2.025, penalty_multiplier: 1.0, initial_reach: 0.514, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:21:02] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Asian Wok', 'branchName': 'DHA Raya', 'serviceType': 'dineIn', 'totalBill': 6000.0, 'rateUserExperience': {'foodTaste': 5, 'ambience': 5, 'staff': 4, 'willRecommend': 4}, 'averageRating': 4.5, 'userThoughts': 'Food was really delicious quantity was very good for a family. This is our second visit in one week. Ambiance was beautiful and serving is flawless.\r\n', 'hashtags': ['ambienceasianchineseseafood']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/3...
DEBUG:root:Assigned image_id: 8ddd3bd7-c270-4935-80e4-a87f01218584
DEBUG:root:Opening image for image_id: 8ddd3bd7-c270-4935-80e4-a87f01218584
DEBUG:PIL.TiffImagePlugin:tag: Orientation (274) - type: short (3) - value: b'\x01\x00'
DEBUG:PIL.TiffImagePlugin:tag: XResolution (282) - type: rational (5) Tag Location: 34 - Data Location: 86 - value: b'H\x00\x00\x00\x01\x00\x00\x00'
DEBUG:PIL.TiffImagePlugin:tag: YResolution (283) - type: rational (5) Tag Location: 46 - Data Location: 94 - value: b'H\x00\x00\x00\x01\x00\x00\x00'
DEBUG:PIL.TiffImagePlugin:tag: ResolutionUnit (296) - type: short (3) - value: b'\x02\x00'
DEBUG:PIL.TiffImagePlugin:tag: YCbCrPositioning (531) - type: short (3) - value: b'\x01\x00'
DEBUG:PIL.TiffImagePlugin:tag: ExifIFD (34665) - type: long (4) - value: b'f\x00\x00\x00'
DEBUG:root:Image converted to JPEG for image_id: 8ddd3bd7-c270-4935-80e4-a87f01218584
DEBUG:root:Sending image to Gemini model for image_id: 8ddd3bd7-c270-4935-80e4-a87f01218584
DEBUG:root:Raw Gemini response for image_id 8ddd3bd7-c270-4935-80e4-a87f01218584:
```json
[
  {
    "image_id": "8ddd3bd7-c270-4935-80e4-a87f01218584",
    "scene": "dish_closeup",
    "visual": {
      "description": "A plate of stir-fried noodles, French fries, and fried rice. The noodles are coated in a savory sauce and appear to have chicken and green peppers. The fried rice is mixed with carrots and green onions. The lighting is warm and somewhat dim, typical of a restaurant setting. There are serving tongs and another dish with fries in the background.",
      "confidence": 0.95,
      "quality": 0.8,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "chicken chow mein",
        "confidence": 0.85
      },
      {
        "name": "fried rice",
        "confidence": 0.9
      },
      {
        "name": "french fries",
        "confidence": 0.95
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "noodles",
      "fried rice",
      "fries",
      "chicken",
      "dinner",
      "lunch",
      "asian fusion"
    ],
    "ambience_features": [
      "restaurant",
      "table",
      "serving tongs"
    ],
    "thumbnail_rank": 0.9
  }
]
```
Raw response for image_id 8ddd3bd7-c270-4935-80e4-a87f01218584:
```json
[
  {
    "image_id": "8ddd3bd7-c270-4935-80e4-a87f01218584",
    "scene": "dish_closeup",
    "visual": {
      "description": "A plate of stir-fried noodles, French fries, and fried rice. The noodles are coated in a savory sauce and appear to have chicken and green peppers. The fried rice is mixed with carrots and green onions. The lighting is warm and somewhat dim, typical of a restaurant setting. There are serving tongs and another dish with fries in the background.",
      "confidence": 0.95,
      "quality": 0.8,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "chicken chow mein",
        "confidence": 0.85
      },
      {
        "name": "fried rice",
        "confidence": 0.9
      },
      {
        "name": "french fries",
        "confidence": 0.95
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "noodles",
      "fried rice",
      "fries",
      "chicken",
      "dinner",
      "lunch",
      "asian fusion"
    ],
    "ambience_features": [
      "restaurant",
      "table",
      "serving tongs"
    ],
    "thumbnail_rank": 0.9
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 8ddd3bd7-c270-4935-80e4-a87f01218584:
[
  {
    "image_id": "8ddd3bd7-c270-4935-80e4-a87f01218584",
    "scene": "dish_closeup",
    "visual": {
      "description": "A plate of stir-fried noodles, French fries, and fried rice. The noodles are coated in a savory sauce and appear to have chicken and green peppers. The fried rice is mixed with carrots and green onions. The lighting is warm and somewhat dim, typical of a restaurant setting. There are serving tongs and another dish with fries in the background.",
      "confidence": 0.95,
      "quality": 0.8,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "chicken chow mein",
        "confidence": 0.85
      },
      {
        "name": "fried rice",
        "confidence": 0.9
      },
      {
        "name": "french fries",
        "confidence": 0.95
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "noodles",
      "fried rice",
      "fries",
      "chicken",
      "dinner",
      "lunch",
      "asian fusion"
    ],
    "ambience_features": [
      "restaurant",
      "table",
      "serving tongs"
    ],
    "thumbnail_rank": 0.9
  }
]
Cleaned response for image_id 8ddd3bd7-c270-4935-80e4-a87f01218584:
[
  {
    "image_id": "8ddd3bd7-c270-4935-80e4-a87f01218584",
    "scene": "dish_closeup",
    "visual": {
      "description": "A plate of stir-fried noodles, French fries, and fried rice. The noodles are coated in a savory sauce and appear to have chicken and green peppers. The fried rice is mixed with carrots and green onions. The lighting is warm and somewhat dim, typical of a restaurant setting. There are serving tongs and another dish with fries in the background.",
      "confidence": 0.95,
      "quality": 0.8,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "chicken chow mein",
        "confidence": 0.85
      },
      {
        "name": "fried rice",
        "confidence": 0.9
      },
      {
        "name": "french fries",
        "confidence": 0.95
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "noodles",
      "fried rice",
      "fries",
      "chicken",
      "dinner",
      "lunch",
      "asian fusion"
    ],
    "ambience_features": [
      "restaurant",
      "table",
      "serving tongs"
    ],
    "thumbnail_rank": 0.9
  }
]
==================================================
DEBUG:PIL.TiffImagePlugin:tag: Orientation (274) - type: short (3) - value: b'\x01\x00'
DEBUG:PIL.TiffImagePlugin:tag: XResolution (282) - type: rational (5) Tag Location: 34 - Data Location: 86 - value: b'H\x00\x00\x00\x01\x00\x00\x00'
DEBUG:PIL.TiffImagePlugin:tag: YResolution (283) - type: rational (5) Tag Location: 46 - Data Location: 94 - value: b'H\x00\x00\x00\x01\x00\x00\x00'
DEBUG:PIL.TiffImagePlugin:tag: ResolutionUnit (296) - type: short (3) - value: b'\x02\x00'
DEBUG:PIL.TiffImagePlugin:tag: YCbCrPositioning (531) - type: short (3) - value: b'\x01\x00'
DEBUG:PIL.TiffImagePlugin:tag: ExifIFD (34665) - type: long (4) - value: b'f\x00\x00\x00'
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 8ddd3bd7-c270-4935-80e4-a87f01218584, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Processing image 2/3...
DEBUG:root:Assigned image_id: 17bfcf10-49ed-4d6f-8ea7-93ad3c6246af
DEBUG:root:Opening image for image_id: 17bfcf10-49ed-4d6f-8ea7-93ad3c6246af
DEBUG:PIL.TiffImagePlugin:tag: Orientation (274) - type: short (3) - value: b'\x01\x00'
DEBUG:PIL.TiffImagePlugin:tag: XResolution (282) - type: rational (5) Tag Location: 34 - Data Location: 86 - value: b'H\x00\x00\x00\x01\x00\x00\x00'
DEBUG:PIL.TiffImagePlugin:tag: YResolution (283) - type: rational (5) Tag Location: 46 - Data Location: 94 - value: b'H\x00\x00\x00\x01\x00\x00\x00'
DEBUG:PIL.TiffImagePlugin:tag: ResolutionUnit (296) - type: short (3) - value: b'\x02\x00'
DEBUG:PIL.TiffImagePlugin:tag: YCbCrPositioning (531) - type: short (3) - value: b'\x01\x00'
DEBUG:PIL.TiffImagePlugin:tag: ExifIFD (34665) - type: long (4) - value: b'f\x00\x00\x00'
DEBUG:root:Image converted to JPEG for image_id: 17bfcf10-49ed-4d6f-8ea7-93ad3c6246af
DEBUG:root:Sending image to Gemini model for image_id: 17bfcf10-49ed-4d6f-8ea7-93ad3c6246af
DEBUG:root:Raw Gemini response for image_id 17bfcf10-49ed-4d6f-8ea7-93ad3c6246af:
```json
[
  {
    "image_id": "17bfcf10-49ed-4d6f-8ea7-93ad3c6246af",
    "scene": "dish_closeup",
    "visual": {
      "description": "A plate with a portion of rice, some meat pieces in a dark sauce, and two pieces of fried shrimp. A chicken bone is also visible on the plate with a spoon on the rice.",
      "confidence": 0.85,
      "quality": 0.6,
      "appeal_score": 0.4
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "fried shrimp",
        "confidence": 0.95
      },
      {
        "name": "rice",
        "confidence": 0.9
      },
      {
        "name": "meat in sauce",
        "confidence": 0.7
      },
      {
        "name": "chicken bone",
        "confidence": 0.8
      }
    ],
    "flag_type": "half_eaten",
    "penalty_score": 2,
    "keywords": [
      "rice",
      "shrimp",
      "fried",
      "meat",
      "bone",
      "spoon"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.7
  }
]
```
Raw response for image_id 17bfcf10-49ed-4d6f-8ea7-93ad3c6246af:
```json
[
  {
    "image_id": "17bfcf10-49ed-4d6f-8ea7-93ad3c6246af",
    "scene": "dish_closeup",
    "visual": {
      "description": "A plate with a portion of rice, some meat pieces in a dark sauce, and two pieces of fried shrimp. A chicken bone is also visible on the plate with a spoon on the rice.",
      "confidence": 0.85,
      "quality": 0.6,
      "appeal_score": 0.4
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "fried shrimp",
        "confidence": 0.95
      },
      {
        "name": "rice",
        "confidence": 0.9
      },
      {
        "name": "meat in sauce",
        "confidence": 0.7
      },
      {
        "name": "chicken bone",
        "confidence": 0.8
      }
    ],
    "flag_type": "half_eaten",
    "penalty_score": 2,
    "keywords": [
      "rice",
      "shrimp",
      "fried",
      "meat",
      "bone",
      "spoon"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.7
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 17bfcf10-49ed-4d6f-8ea7-93ad3c6246af:
[
  {
    "image_id": "17bfcf10-49ed-4d6f-8ea7-93ad3c6246af",
    "scene": "dish_closeup",
    "visual": {
      "description": "A plate with a portion of rice, some meat pieces in a dark sauce, and two pieces of fried shrimp. A chicken bone is also visible on the plate with a spoon on the rice.",
      "confidence": 0.85,
      "quality": 0.6,
      "appeal_score": 0.4
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "fried shrimp",
        "confidence": 0.95
      },
      {
        "name": "rice",
        "confidence": 0.9
      },
      {
        "name": "meat in sauce",
        "confidence": 0.7
      },
      {
        "name": "chicken bone",
        "confidence": 0.8
      }
    ],
    "flag_type": "half_eaten",
    "penalty_score": 2,
    "keywords": [
      "rice",
      "shrimp",
      "fried",
      "meat",
      "bone",
      "spoon"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.7
  }
]
Cleaned response for image_id 17bfcf10-49ed-4d6f-8ea7-93ad3c6246af:
[
  {
    "image_id": "17bfcf10-49ed-4d6f-8ea7-93ad3c6246af",
    "scene": "dish_closeup",
    "visual": {
      "description": "A plate with a portion of rice, some meat pieces in a dark sauce, and two pieces of fried shrimp. A chicken bone is also visible on the plate with a spoon on the rice.",
      "confidence": 0.85,
      "quality": 0.6,
      "appeal_score": 0.4
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "mixed",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "fried shrimp",
        "confidence": 0.95
      },
      {
        "name": "rice",
        "confidence": 0.9
      },
      {
        "name": "meat in sauce",
        "confidence": 0.7
      },
      {
        "name": "chicken bone",
        "confidence": 0.8
      }
    ],
    "flag_type": "half_eaten",
    "penalty_score": 2,
    "keywords": [
      "rice",
      "shrimp",
      "fried",
      "meat",
      "bone",
      "spoon"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.7
  }
]
==================================================
DEBUG:PIL.TiffImagePlugin:tag: Orientation (274) - type: short (3) - value: b'\x01\x00'
DEBUG:PIL.TiffImagePlugin:tag: XResolution (282) - type: rational (5) Tag Location: 34 - Data Location: 86 - value: b'H\x00\x00\x00\x01\x00\x00\x00'
DEBUG:PIL.TiffImagePlugin:tag: YResolution (283) - type: rational (5) Tag Location: 46 - Data Location: 94 - value: b'H\x00\x00\x00\x01\x00\x00\x00'
DEBUG:PIL.TiffImagePlugin:tag: ResolutionUnit (296) - type: short (3) - value: b'\x02\x00'
DEBUG:PIL.TiffImagePlugin:tag: YCbCrPositioning (531) - type: short (3) - value: b'\x01\x00'
DEBUG:PIL.TiffImagePlugin:tag: ExifIFD (34665) - type: long (4) - value: b'f\x00\x00\x00'
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 17bfcf10-49ed-4d6f-8ea7-93ad3c6246af, length: 768
DEBUG:root:Image 2 processed successfully.
DEBUG:root:Processing image 3/3...
DEBUG:root:Assigned image_id: 397f7c1f-438a-46a4-a40a-0df142715f03
DEBUG:root:Opening image for image_id: 397f7c1f-438a-46a4-a40a-0df142715f03
DEBUG:root:Image converted to JPEG for image_id: 397f7c1f-438a-46a4-a40a-0df142715f03
DEBUG:root:Sending image to Gemini model for image_id: 397f7c1f-438a-46a4-a40a-0df142715f03
DEBUG:root:Raw Gemini response for image_id 397f7c1f-438a-46a4-a40a-0df142715f03:
```json
[
  {
    "image_id": "397f7c1f-438a-46a4-a40a-0df142715f03",
    "scene": "ambiance",
    "visual": {
      "description": "A view from a table inside a restaurant, looking towards a large window displaying city lights. The ceiling has a distinctive wooden slatted design with embedded lights. Several tables are visible with diners, and there are dishes and drinks on the tables, including a hot pot in the foreground and a green beverage. The overall impression is of a modern and sophisticated dining environment.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "dinner"
    },
    "items": [
      {
        "name": "hot pot",
        "confidence": 0.8
      },
      {
        "name": "beverage",
        "confidence": 0.7
      },
      {
        "name": "biryani",
        "confidence": 0.1
      },
      {
        "name": "nihari",
        "confidence": 0.05
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "restaurant",
      "dining",
      "indoor",
      "modern",
      "ceiling design",
      "city lights",
      "hot pot",
      "beverage",
      "dinner"
    ],
    "ambience_features": [
      "wooden ceiling",
      "ambient lighting",
      "window view",
      "modern decor"
    ],
    "thumbnail_rank": 0.8
  }
]
```
Raw response for image_id 397f7c1f-438a-46a4-a40a-0df142715f03:
```json
[
  {
    "image_id": "397f7c1f-438a-46a4-a40a-0df142715f03",
    "scene": "ambiance",
    "visual": {
      "description": "A view from a table inside a restaurant, looking towards a large window displaying city lights. The ceiling has a distinctive wooden slatted design with embedded lights. Several tables are visible with diners, and there are dishes and drinks on the tables, including a hot pot in the foreground and a green beverage. The overall impression is of a modern and sophisticated dining environment.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "dinner"
    },
    "items": [
      {
        "name": "hot pot",
        "confidence": 0.8
      },
      {
        "name": "beverage",
        "confidence": 0.7
      },
      {
        "name": "biryani",
        "confidence": 0.1
      },
      {
        "name": "nihari",
        "confidence": 0.05
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "restaurant",
      "dining",
      "indoor",
      "modern",
      "ceiling design",
      "city lights",
      "hot pot",
      "beverage",
      "dinner"
    ],
    "ambience_features": [
      "wooden ceiling",
      "ambient lighting",
      "window view",
      "modern decor"
    ],
    "thumbnail_rank": 0.8
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 397f7c1f-438a-46a4-a40a-0df142715f03:
[
  {
    "image_id": "397f7c1f-438a-46a4-a40a-0df142715f03",
    "scene": "ambiance",
    "visual": {
      "description": "A view from a table inside a restaurant, looking towards a large window displaying city lights. The ceiling has a distinctive wooden slatted design with embedded lights. Several tables are visible with diners, and there are dishes and drinks on the tables, including a hot pot in the foreground and a green beverage. The overall impression is of a modern and sophisticated dining environment.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "dinner"
    },
    "items": [
      {
        "name": "hot pot",
        "confidence": 0.8
      },
      {
        "name": "beverage",
        "confidence": 0.7
      },
      {
        "name": "biryani",
        "confidence": 0.1
      },
      {
        "name": "nihari",
        "confidence": 0.05
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "restaurant",
      "dining",
      "indoor",
      "modern",
      "ceiling design",
      "city lights",
      "hot pot",
      "beverage",
      "dinner"
    ],
    "ambience_features": [
      "wooden ceiling",
      "ambient lighting",
      "window view",
      "modern decor"
    ],
    "thumbnail_rank": 0.8
  }
]
Cleaned response for image_id 397f7c1f-438a-46a4-a40a-0df142715f03:
[
  {
    "image_id": "397f7c1f-438a-46a4-a40a-0df142715f03",
    "scene": "ambiance",
    "visual": {
      "description": "A view from a table inside a restaurant, looking towards a large window displaying city lights. The ceiling has a distinctive wooden slatted design with embedded lights. Several tables are visible with diners, and there are dishes and drinks on the tables, including a hot pot in the foreground and a green beverage. The overall impression is of a modern and sophisticated dining environment.",
      "confidence": 0.95,
      "quality": 0.88,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "dinner"
    },
    "items": [
      {
        "name": "hot pot",
        "confidence": 0.8
      },
      {
        "name": "beverage",
        "confidence": 0.7
      },
      {
        "name": "biryani",
        "confidence": 0.1
      },
      {
        "name": "nihari",
        "confidence": 0.05
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "restaurant",
      "dining",
      "indoor",
      "modern",
      "ceiling design",
      "city lights",
      "hot pot",
      "beverage",
      "dinner"
    ],
    "ambience_features": [
      "wooden ceiling",
      "ambient lighting",
      "window view",
      "modern decor"
    ],
    "thumbnail_rank": 0.8
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 397f7c1f-438a-46a4-a40a-0df142715f03, length: 768
DEBUG:root:Image 3 processed successfully.
DEBUG:root:Aggregated quality_score: 0.7599999999999999
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C5D0BCCFD0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C5CE7AA600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C5D0BCD590>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:24:26 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: fb611195-0278-4897-af94-f145a9d568a7
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.7599999999999999, reputation_score: 2.025, penalty_multiplier: 0.98, initial_reach: 0.4468799999999999, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:24:26] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Andaaz Restaurant', 'branchName': 'Androon Lahore', 'serviceType': 'dineIn', 'totalBill': 4000.0, 'rateUserExperience': {'foodTaste': 5, 'ambience': 5, 'staff': 4, 'willRecommend': 4}, 'averageRating': 4.5, 'userThoughts': "Do you know what is beautiful? The mesmerizing sound of the azan, fresh air,  desi khana\U0001f495 That's what I experienced yesterday!\r\n\r\nThe serene view of badshahi mosque was felt like a dream. We were there, at the rooftop, waiting for azan to broke our fast. The waiting was worthwhile\U0001f525", 'hashtags': ['ambiencedesihistorybbq']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/4...
DEBUG:root:Assigned image_id: 9b57f5b9-f22a-4793-972c-f5a6a2d407c2
DEBUG:root:Opening image for image_id: 9b57f5b9-f22a-4793-972c-f5a6a2d407c2
DEBUG:PIL.TiffImagePlugin:tag: Orientation (274) - type: short (3) - value: b'\x01\x00'
DEBUG:PIL.TiffImagePlugin:tag: XResolution (282) - type: rational (5) Tag Location: 34 - Data Location: 86 - value: b'H\x00\x00\x00\x01\x00\x00\x00'
DEBUG:PIL.TiffImagePlugin:tag: YResolution (283) - type: rational (5) Tag Location: 46 - Data Location: 94 - value: b'H\x00\x00\x00\x01\x00\x00\x00'
DEBUG:PIL.TiffImagePlugin:tag: ResolutionUnit (296) - type: short (3) - value: b'\x02\x00'
DEBUG:PIL.TiffImagePlugin:tag: YCbCrPositioning (531) - type: short (3) - value: b'\x01\x00'
DEBUG:PIL.TiffImagePlugin:tag: ExifIFD (34665) - type: long (4) - value: b'f\x00\x00\x00'
DEBUG:root:Image converted to JPEG for image_id: 9b57f5b9-f22a-4793-972c-f5a6a2d407c2
DEBUG:root:Sending image to Gemini model for image_id: 9b57f5b9-f22a-4793-972c-f5a6a2d407c2
DEBUG:root:Raw Gemini response for image_id 9b57f5b9-f22a-4793-972c-f5a6a2d407c2:
```json
[
  {
    "image_id": "9b57f5b9-f22a-4793-972c-f5a6a2d407c2",
    "scene": "dish_closeup",
    "visual": {
      "description": "A table set for a meal on a rooftop, with a view of a historical building with domes and minarets. The table is laid with plates of food, glasses of drinks, and a brass lantern. One plate in the foreground shows grilled chicken pieces with a side of curry. Another plate has a naan wrap filled with a seekh kebab. A covered serving dish is in the center of the table.",
      "confidence": 0.95,
      "quality": 0.9,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "grilled chicken",
        "confidence": 0.9
      },
      {
        "name": "seekh kebab wrap",
        "confidence": 0.85
      },
      {
        "name": "naan",
        "confidence": 0.8
      },
      {
        "name": "curry",
        "confidence": 0.75
      },
      {
        "name": "naan",
        "confidence": 0.8
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "rooftop dining",
      "pakistani food",
      "grilled chicken",
      "seekh kebab",
      "naan",
      "curry",
      "lantern",
      "historical view",
      "outdoor seating",
      "table setting"
    ],
    "ambience_features": [
      "rooftop",
      "view",
      "lantern",
      "formal"
    ],
    "thumbnail_rank": 1.0
  }
]
```
Raw response for image_id 9b57f5b9-f22a-4793-972c-f5a6a2d407c2:
```json
[
  {
    "image_id": "9b57f5b9-f22a-4793-972c-f5a6a2d407c2",
    "scene": "dish_closeup",
    "visual": {
      "description": "A table set for a meal on a rooftop, with a view of a historical building with domes and minarets. The table is laid with plates of food, glasses of drinks, and a brass lantern. One plate in the foreground shows grilled chicken pieces with a side of curry. Another plate has a naan wrap filled with a seekh kebab. A covered serving dish is in the center of the table.",
      "confidence": 0.95,
      "quality": 0.9,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "grilled chicken",
        "confidence": 0.9
      },
      {
        "name": "seekh kebab wrap",
        "confidence": 0.85
      },
      {
        "name": "naan",
        "confidence": 0.8
      },
      {
        "name": "curry",
        "confidence": 0.75
      },
      {
        "name": "naan",
        "confidence": 0.8
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "rooftop dining",
      "pakistani food",
      "grilled chicken",
      "seekh kebab",
      "naan",
      "curry",
      "lantern",
      "historical view",
      "outdoor seating",
      "table setting"
    ],
    "ambience_features": [
      "rooftop",
      "view",
      "lantern",
      "formal"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 9b57f5b9-f22a-4793-972c-f5a6a2d407c2:
[
  {
    "image_id": "9b57f5b9-f22a-4793-972c-f5a6a2d407c2",
    "scene": "dish_closeup",
    "visual": {
      "description": "A table set for a meal on a rooftop, with a view of a historical building with domes and minarets. The table is laid with plates of food, glasses of drinks, and a brass lantern. One plate in the foreground shows grilled chicken pieces with a side of curry. Another plate has a naan wrap filled with a seekh kebab. A covered serving dish is in the center of the table.",
      "confidence": 0.95,
      "quality": 0.9,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "grilled chicken",
        "confidence": 0.9
      },
      {
        "name": "seekh kebab wrap",
        "confidence": 0.85
      },
      {
        "name": "naan",
        "confidence": 0.8
      },
      {
        "name": "curry",
        "confidence": 0.75
      },
      {
        "name": "naan",
        "confidence": 0.8
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "rooftop dining",
      "pakistani food",
      "grilled chicken",
      "seekh kebab",
      "naan",
      "curry",
      "lantern",
      "historical view",
      "outdoor seating",
      "table setting"
    ],
    "ambience_features": [
      "rooftop",
      "view",
      "lantern",
      "formal"
    ],
    "thumbnail_rank": 1.0
  }
]
Cleaned response for image_id 9b57f5b9-f22a-4793-972c-f5a6a2d407c2:
[
  {
    "image_id": "9b57f5b9-f22a-4793-972c-f5a6a2d407c2",
    "scene": "dish_closeup",
    "visual": {
      "description": "A table set for a meal on a rooftop, with a view of a historical building with domes and minarets. The table is laid with plates of food, glasses of drinks, and a brass lantern. One plate in the foreground shows grilled chicken pieces with a side of curry. Another plate has a naan wrap filled with a seekh kebab. A covered serving dish is in the center of the table.",
      "confidence": 0.95,
      "quality": 0.9,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "grilled chicken",
        "confidence": 0.9
      },
      {
        "name": "seekh kebab wrap",
        "confidence": 0.85
      },
      {
        "name": "naan",
        "confidence": 0.8
      },
      {
        "name": "curry",
        "confidence": 0.75
      },
      {
        "name": "naan",
        "confidence": 0.8
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "rooftop dining",
      "pakistani food",
      "grilled chicken",
      "seekh kebab",
      "naan",
      "curry",
      "lantern",
      "historical view",
      "outdoor seating",
      "table setting"
    ],
    "ambience_features": [
      "rooftop",
      "view",
      "lantern",
      "formal"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
DEBUG:PIL.TiffImagePlugin:tag: Orientation (274) - type: short (3) - value: b'\x01\x00'
DEBUG:PIL.TiffImagePlugin:tag: XResolution (282) - type: rational (5) Tag Location: 34 - Data Location: 86 - value: b'H\x00\x00\x00\x01\x00\x00\x00'
DEBUG:PIL.TiffImagePlugin:tag: YResolution (283) - type: rational (5) Tag Location: 46 - Data Location: 94 - value: b'H\x00\x00\x00\x01\x00\x00\x00'
DEBUG:PIL.TiffImagePlugin:tag: ResolutionUnit (296) - type: short (3) - value: b'\x02\x00'
DEBUG:PIL.TiffImagePlugin:tag: YCbCrPositioning (531) - type: short (3) - value: b'\x01\x00'
DEBUG:PIL.TiffImagePlugin:tag: ExifIFD (34665) - type: long (4) - value: b'f\x00\x00\x00'
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 9b57f5b9-f22a-4793-972c-f5a6a2d407c2, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Processing image 2/4...
DEBUG:root:Assigned image_id: 273bc290-dfb8-4e04-9dcf-33cb60927577
DEBUG:root:Opening image for image_id: 273bc290-dfb8-4e04-9dcf-33cb60927577
DEBUG:root:Image converted to JPEG for image_id: 273bc290-dfb8-4e04-9dcf-33cb60927577
DEBUG:root:Sending image to Gemini model for image_id: 273bc290-dfb8-4e04-9dcf-33cb60927577
DEBUG:root:Raw Gemini response for image_id 273bc290-dfb8-4e04-9dcf-33cb60927577:
{"image_id": "273bc290-dfb8-4e04-9dcf-33cb60927577", "scene": "ambiance", "visual": {"description": "An interior view of a room with traditional Pakistani decor. There are ornate wooden pillars, patterned carpets on the floor and walls, and shelves displaying pottery and artifacts. A daybed with cushions and a low table are visible in the background.", "confidence": 0.95, "quality": 0.8, "appeal_score": 0.7}, "context": {"ambiance": "indoor", "lighting": "mixed", "meal_timing": "any"}, "items": [], "flag_type": "none", "penalty_score": 0, "keywords": ["pakistani", "interior", "decor", "traditional", "pillars", "carpets", "pottery", "artifacts", "daybed", "room"], "ambience_features": ["ornate pillars", "patterned carpets", "traditional artifacts"], "thumbnail_rank": 1.0}
Raw response for image_id 273bc290-dfb8-4e04-9dcf-33cb60927577:
{"image_id": "273bc290-dfb8-4e04-9dcf-33cb60927577", "scene": "ambiance", "visual": {"description": "An interior view of a room with traditional Pakistani decor. There are ornate wooden pillars, patterned carpets on the floor and walls, and shelves displaying pottery and artifacts. A daybed with cushions and a low table are visible in the background.", "confidence": 0.95, "quality": 0.8, "appeal_score": 0.7}, "context": {"ambiance": "indoor", "lighting": "mixed", "meal_timing": "any"}, "items": [], "flag_type": "none", "penalty_score": 0, "keywords": ["pakistani", "interior", "decor", "traditional", "pillars", "carpets", "pottery", "artifacts", "daybed", "room"], "ambience_features": ["ornate pillars", "patterned carpets", "traditional artifacts"], "thumbnail_rank": 1.0}
==================================================
DEBUG:root:Cleaned response for image_id 273bc290-dfb8-4e04-9dcf-33cb60927577:
{"image_id": "273bc290-dfb8-4e04-9dcf-33cb60927577", "scene": "ambiance", "visual": {"description": "An interior view of a room with traditional Pakistani decor. There are ornate wooden pillars, patterned carpets on the floor and walls, and shelves displaying pottery and artifacts. A daybed with cushions and a low table are visible in the background.", "confidence": 0.95, "quality": 0.8, "appeal_score": 0.7}, "context": {"ambiance": "indoor", "lighting": "mixed", "meal_timing": "any"}, "items": [], "flag_type": "none", "penalty_score": 0, "keywords": ["pakistani", "interior", "decor", "traditional", "pillars", "carpets", "pottery", "artifacts", "daybed", "room"], "ambience_features": ["ornate pillars", "patterned carpets", "traditional artifacts"], "thumbnail_rank": 1.0}
Cleaned response for image_id 273bc290-dfb8-4e04-9dcf-33cb60927577:
{"image_id": "273bc290-dfb8-4e04-9dcf-33cb60927577", "scene": "ambiance", "visual": {"description": "An interior view of a room with traditional Pakistani decor. There are ornate wooden pillars, patterned carpets on the floor and walls, and shelves displaying pottery and artifacts. A daybed with cushions and a low table are visible in the background.", "confidence": 0.95, "quality": 0.8, "appeal_score": 0.7}, "context": {"ambiance": "indoor", "lighting": "mixed", "meal_timing": "any"}, "items": [], "flag_type": "none", "penalty_score": 0, "keywords": ["pakistani", "interior", "decor", "traditional", "pillars", "carpets", "pottery", "artifacts", "daybed", "room"], "ambience_features": ["ornate pillars", "patterned carpets", "traditional artifacts"], "thumbnail_rank": 1.0}
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 273bc290-dfb8-4e04-9dcf-33cb60927577, length: 768
DEBUG:root:Image 2 processed successfully.
DEBUG:root:Processing image 3/4...
DEBUG:root:Assigned image_id: a2ee7711-3bf1-456b-a291-96776a3fa386
DEBUG:root:Opening image for image_id: a2ee7711-3bf1-456b-a291-96776a3fa386
DEBUG:root:Image converted to JPEG for image_id: a2ee7711-3bf1-456b-a291-96776a3fa386
DEBUG:root:Sending image to Gemini model for image_id: a2ee7711-3bf1-456b-a291-96776a3fa386
DEBUG:root:Raw Gemini response for image_id a2ee7711-3bf1-456b-a291-96776a3fa386:
```json
[
  {
    "image_id": "a2ee7711-3bf1-456b-a291-96776a3fa386",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a Pakistani dish, likely Bhuna Gosht, served in a traditional brass karahi. The meat is coated in a rich, dark brown gravy with visible fried onions and garnished with fresh green cilantro. The lighting is warm and slightly dim, highlighting the texture and richness of the dish.",
      "confidence": 0.95,
      "quality": 0.8,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "Bhuna Gosht",
        "confidence": 0.9
      },
      {
        "name": "Karahi",
        "confidence": 0.95
      },
      {
        "name": "Cilantro",
        "confidence": 0.85
      },
      {
        "name": "Fried Onions",
        "confidence": 0.8
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "bhuna gosht",
      "meat curry",
      "traditional dish",
      "karahi",
      "cilantro garnish",
      "rich gravy",
      "fried onions",
      "dinner",
      "lunch"
    ],
    "ambience_features": [
      "dim lighting",
      "warm lighting",
      "traditional serving ware"
    ],
    "thumbnail_rank": 1.0
  }
]
```
Raw response for image_id a2ee7711-3bf1-456b-a291-96776a3fa386:
```json
[
  {
    "image_id": "a2ee7711-3bf1-456b-a291-96776a3fa386",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a Pakistani dish, likely Bhuna Gosht, served in a traditional brass karahi. The meat is coated in a rich, dark brown gravy with visible fried onions and garnished with fresh green cilantro. The lighting is warm and slightly dim, highlighting the texture and richness of the dish.",
      "confidence": 0.95,
      "quality": 0.8,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "Bhuna Gosht",
        "confidence": 0.9
      },
      {
        "name": "Karahi",
        "confidence": 0.95
      },
      {
        "name": "Cilantro",
        "confidence": 0.85
      },
      {
        "name": "Fried Onions",
        "confidence": 0.8
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "bhuna gosht",
      "meat curry",
      "traditional dish",
      "karahi",
      "cilantro garnish",
      "rich gravy",
      "fried onions",
      "dinner",
      "lunch"
    ],
    "ambience_features": [
      "dim lighting",
      "warm lighting",
      "traditional serving ware"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id a2ee7711-3bf1-456b-a291-96776a3fa386:
[
  {
    "image_id": "a2ee7711-3bf1-456b-a291-96776a3fa386",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a Pakistani dish, likely Bhuna Gosht, served in a traditional brass karahi. The meat is coated in a rich, dark brown gravy with visible fried onions and garnished with fresh green cilantro. The lighting is warm and slightly dim, highlighting the texture and richness of the dish.",
      "confidence": 0.95,
      "quality": 0.8,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "Bhuna Gosht",
        "confidence": 0.9
      },
      {
        "name": "Karahi",
        "confidence": 0.95
      },
      {
        "name": "Cilantro",
        "confidence": 0.85
      },
      {
        "name": "Fried Onions",
        "confidence": 0.8
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "bhuna gosht",
      "meat curry",
      "traditional dish",
      "karahi",
      "cilantro garnish",
      "rich gravy",
      "fried onions",
      "dinner",
      "lunch"
    ],
    "ambience_features": [
      "dim lighting",
      "warm lighting",
      "traditional serving ware"
    ],
    "thumbnail_rank": 1.0
  }
]
Cleaned response for image_id a2ee7711-3bf1-456b-a291-96776a3fa386:
[
  {
    "image_id": "a2ee7711-3bf1-456b-a291-96776a3fa386",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a Pakistani dish, likely Bhuna Gosht, served in a traditional brass karahi. The meat is coated in a rich, dark brown gravy with visible fried onions and garnished with fresh green cilantro. The lighting is warm and slightly dim, highlighting the texture and richness of the dish.",
      "confidence": 0.95,
      "quality": 0.8,
      "appeal_score": 0.85
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "Bhuna Gosht",
        "confidence": 0.9
      },
      {
        "name": "Karahi",
        "confidence": 0.95
      },
      {
        "name": "Cilantro",
        "confidence": 0.85
      },
      {
        "name": "Fried Onions",
        "confidence": 0.8
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "bhuna gosht",
      "meat curry",
      "traditional dish",
      "karahi",
      "cilantro garnish",
      "rich gravy",
      "fried onions",
      "dinner",
      "lunch"
    ],
    "ambience_features": [
      "dim lighting",
      "warm lighting",
      "traditional serving ware"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id a2ee7711-3bf1-456b-a291-96776a3fa386, length: 768
DEBUG:root:Image 3 processed successfully.
DEBUG:root:Processing image 4/4...
DEBUG:root:Assigned image_id: 565d5fd5-c389-41dc-841d-1af888fca1e1
DEBUG:root:Opening image for image_id: 565d5fd5-c389-41dc-841d-1af888fca1e1
DEBUG:root:Image converted to JPEG for image_id: 565d5fd5-c389-41dc-841d-1af888fca1e1
DEBUG:root:Sending image to Gemini model for image_id: 565d5fd5-c389-41dc-841d-1af888fca1e1
DEBUG:root:Raw Gemini response for image_id 565d5fd5-c389-41dc-841d-1af888fca1e1:
```json
[
  {
    "image_id": "565d5fd5-c389-41dc-841d-1af888fca1e1",
    "scene": "dish_closeup",
    "visual": {
      "description": "A spread of Pakistani dishes, including several curries and seekh kebabs, served in traditional brass bowls. The lighting is warm and low, highlighting the rich textures of the food.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "dinner"
    },
    "items": [
      {
        "name": "seekh kebab",
        "confidence": 0.85
      },
      {
        "name": "palak gosht",
        "confidence": 0.75
      },
      {
        "name": "dal makhani",
        "confidence": 0.7
      },
      {
        "name": "karahi",
        "confidence": 0.65
      },
      {
        "name": "naan",
        "confidence": 0.5
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "Pakistani food",
      "curries",
      "kebabs",
      "brass bowls",
      "traditional",
      "dinner spread",
      "dal",
      "palak gosht",
      "karahi"
    ],
    "ambience_features": [
      "traditional serving",
      "warm lighting"
    ],
    "thumbnail_rank": 1.0
  }
]
```
Raw response for image_id 565d5fd5-c389-41dc-841d-1af888fca1e1:
```json
[
  {
    "image_id": "565d5fd5-c389-41dc-841d-1af888fca1e1",
    "scene": "dish_closeup",
    "visual": {
      "description": "A spread of Pakistani dishes, including several curries and seekh kebabs, served in traditional brass bowls. The lighting is warm and low, highlighting the rich textures of the food.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "dinner"
    },
    "items": [
      {
        "name": "seekh kebab",
        "confidence": 0.85
      },
      {
        "name": "palak gosht",
        "confidence": 0.75
      },
      {
        "name": "dal makhani",
        "confidence": 0.7
      },
      {
        "name": "karahi",
        "confidence": 0.65
      },
      {
        "name": "naan",
        "confidence": 0.5
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "Pakistani food",
      "curries",
      "kebabs",
      "brass bowls",
      "traditional",
      "dinner spread",
      "dal",
      "palak gosht",
      "karahi"
    ],
    "ambience_features": [
      "traditional serving",
      "warm lighting"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 565d5fd5-c389-41dc-841d-1af888fca1e1:
[
  {
    "image_id": "565d5fd5-c389-41dc-841d-1af888fca1e1",
    "scene": "dish_closeup",
    "visual": {
      "description": "A spread of Pakistani dishes, including several curries and seekh kebabs, served in traditional brass bowls. The lighting is warm and low, highlighting the rich textures of the food.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "dinner"
    },
    "items": [
      {
        "name": "seekh kebab",
        "confidence": 0.85
      },
      {
        "name": "palak gosht",
        "confidence": 0.75
      },
      {
        "name": "dal makhani",
        "confidence": 0.7
      },
      {
        "name": "karahi",
        "confidence": 0.65
      },
      {
        "name": "naan",
        "confidence": 0.5
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "Pakistani food",
      "curries",
      "kebabs",
      "brass bowls",
      "traditional",
      "dinner spread",
      "dal",
      "palak gosht",
      "karahi"
    ],
    "ambience_features": [
      "traditional serving",
      "warm lighting"
    ],
    "thumbnail_rank": 1.0
  }
]
Cleaned response for image_id 565d5fd5-c389-41dc-841d-1af888fca1e1:
[
  {
    "image_id": "565d5fd5-c389-41dc-841d-1af888fca1e1",
    "scene": "dish_closeup",
    "visual": {
      "description": "A spread of Pakistani dishes, including several curries and seekh kebabs, served in traditional brass bowls. The lighting is warm and low, highlighting the rich textures of the food.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "dinner"
    },
    "items": [
      {
        "name": "seekh kebab",
        "confidence": 0.85
      },
      {
        "name": "palak gosht",
        "confidence": 0.75
      },
      {
        "name": "dal makhani",
        "confidence": 0.7
      },
      {
        "name": "karahi",
        "confidence": 0.65
      },
      {
        "name": "naan",
        "confidence": 0.5
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "Pakistani food",
      "curries",
      "kebabs",
      "brass bowls",
      "traditional",
      "dinner spread",
      "dal",
      "palak gosht",
      "karahi"
    ],
    "ambience_features": [
      "traditional serving",
      "warm lighting"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 565d5fd5-c389-41dc-841d-1af888fca1e1, length: 768
DEBUG:root:Image 4 processed successfully.
DEBUG:root:Aggregated quality_score: 0.8
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C5D0998F50>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C5CE7AA600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C5CEB13B10>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:27:47 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: c996fb18-c845-4d74-90cf-36a087c98ad0
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.8, reputation_score: 2.025, penalty_multiplier: 1.0, initial_reach: 0.48, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:27:47] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Sweet Creme', 'branchName': 'Gulberg', 'serviceType': 'takeaway', 'totalBill': 1000.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 0, 'staff': 4, 'willRecommend': 4}, 'averageRating': 3.0, 'userThoughts': "When I visit there it's late at night my first impression was strong smell of gutter but somehow I managed to stay there and afterwards I ordered thier Lava cake whatever it's. Really good in taste chill ice-cream with hot cake a unique combo the price was quite reasonable for that product.", 'hashtags': ['icecreamdessertsweetcold']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:root:Assigned image_id: 2a0bc3cd-a4f8-4f53-be26-62220251b8d9
DEBUG:root:Opening image for image_id: 2a0bc3cd-a4f8-4f53-be26-62220251b8d9
DEBUG:root:Image converted to JPEG for image_id: 2a0bc3cd-a4f8-4f53-be26-62220251b8d9
DEBUG:root:Sending image to Gemini model for image_id: 2a0bc3cd-a4f8-4f53-be26-62220251b8d9
INFO:werkzeug: * Detected change in 'D:\\Khapey-MVP\\app.py', reloading
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C05D265210>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C05CEEA600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C05D1C2ED0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:35:04 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 105-820-945
DEBUG:root:Review data prepared: {'restaurantName': 'Sweet Creme', 'branchName': 'Gulberg', 'serviceType': 'takeaway', 'totalBill': 1000.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 0, 'staff': 4, 'willRecommend': 4}, 'averageRating': 3.0, 'userThoughts': "When I visit there it's late at night my first impression was strong smell of gutter but somehow I managed to stay there and afterwards I ordered thier Lava cake whatever it's. Really good in taste chill ice-cream with hot cake a unique combo the price was quite reasonable for that product.", 'hashtags': ['icecreamdessertsweetcold']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/1...
DEBUG:root:Assigned image_id: 6e937364-3b24-432b-b9f5-c4281dd528f8
DEBUG:root:Opening image for image_id: 6e937364-3b24-432b-b9f5-c4281dd528f8
DEBUG:PIL.Image:Importing BlpImagePlugin
DEBUG:PIL.Image:Importing BmpImagePlugin
DEBUG:PIL.Image:Importing BufrStubImagePlugin
DEBUG:PIL.Image:Importing CurImagePlugin
DEBUG:PIL.Image:Importing DcxImagePlugin
DEBUG:PIL.Image:Importing DdsImagePlugin
DEBUG:PIL.Image:Importing EpsImagePlugin
DEBUG:PIL.Image:Importing FitsImagePlugin
DEBUG:PIL.Image:Importing FliImagePlugin
DEBUG:PIL.Image:Importing FpxImagePlugin
DEBUG:PIL.Image:Image: failed to import FpxImagePlugin: No module named 'olefile'
DEBUG:PIL.Image:Importing FtexImagePlugin
DEBUG:PIL.Image:Importing GbrImagePlugin
DEBUG:PIL.Image:Importing GifImagePlugin
DEBUG:PIL.Image:Importing GribStubImagePlugin
DEBUG:PIL.Image:Importing Hdf5StubImagePlugin
DEBUG:PIL.Image:Importing IcnsImagePlugin
DEBUG:PIL.Image:Importing IcoImagePlugin
DEBUG:PIL.Image:Importing ImImagePlugin
DEBUG:PIL.Image:Importing ImtImagePlugin
DEBUG:PIL.Image:Importing IptcImagePlugin
DEBUG:PIL.Image:Importing JpegImagePlugin
DEBUG:PIL.Image:Importing Jpeg2KImagePlugin
DEBUG:PIL.Image:Importing McIdasImagePlugin
DEBUG:PIL.Image:Importing MicImagePlugin
DEBUG:PIL.Image:Image: failed to import MicImagePlugin: No module named 'olefile'
DEBUG:PIL.Image:Importing MpegImagePlugin
DEBUG:PIL.Image:Importing MpoImagePlugin
DEBUG:PIL.Image:Importing MspImagePlugin
DEBUG:PIL.Image:Importing PalmImagePlugin
DEBUG:PIL.Image:Importing PcdImagePlugin
DEBUG:PIL.Image:Importing PcxImagePlugin
DEBUG:PIL.Image:Importing PdfImagePlugin
DEBUG:PIL.Image:Importing PixarImagePlugin
DEBUG:PIL.Image:Importing PngImagePlugin
DEBUG:PIL.Image:Importing PpmImagePlugin
DEBUG:PIL.Image:Importing PsdImagePlugin
DEBUG:PIL.Image:Importing QoiImagePlugin
DEBUG:PIL.Image:Importing SgiImagePlugin
DEBUG:PIL.Image:Importing SpiderImagePlugin
DEBUG:PIL.Image:Importing SunImagePlugin
DEBUG:PIL.Image:Importing TgaImagePlugin
DEBUG:PIL.Image:Importing TiffImagePlugin
DEBUG:PIL.Image:Importing WebPImagePlugin
DEBUG:PIL.Image:Importing WmfImagePlugin
DEBUG:PIL.Image:Importing XbmImagePlugin
DEBUG:PIL.Image:Importing XpmImagePlugin
DEBUG:PIL.Image:Importing XVThumbImagePlugin
DEBUG:root:Image converted to JPEG for image_id: 6e937364-3b24-432b-b9f5-c4281dd528f8
DEBUG:root:Sending image to Gemini model for image_id: 6e937364-3b24-432b-b9f5-c4281dd528f8
DEBUG:root:Raw Gemini response for image_id 6e937364-3b24-432b-b9f5-c4281dd528f8:
```json
[
  {
    "image_id": "6e937364-3b24-432b-b9f5-c4281dd528f8",
    "scene": "dish_closeup",
    "visual": {
      "description": "A blue box containing a brownie and a dessert topped with chocolate sauce and whipped cream.",
      "confidence": 0.85,
      "quality": 0.7,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "brownie",
        "confidence": 0.95
      },
      {
        "name": "dessert",
        "confidence": 0.8
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "dessert",
      "brownie",
      "chocolate",
      "sweet"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.7
  }
]
```
Raw response for image_id 6e937364-3b24-432b-b9f5-c4281dd528f8:
```json
[
  {
    "image_id": "6e937364-3b24-432b-b9f5-c4281dd528f8",
    "scene": "dish_closeup",
    "visual": {
      "description": "A blue box containing a brownie and a dessert topped with chocolate sauce and whipped cream.",
      "confidence": 0.85,
      "quality": 0.7,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "brownie",
        "confidence": 0.95
      },
      {
        "name": "dessert",
        "confidence": 0.8
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "dessert",
      "brownie",
      "chocolate",
      "sweet"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.7
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 6e937364-3b24-432b-b9f5-c4281dd528f8:
[
  {
    "image_id": "6e937364-3b24-432b-b9f5-c4281dd528f8",
    "scene": "dish_closeup",
    "visual": {
      "description": "A blue box containing a brownie and a dessert topped with chocolate sauce and whipped cream.",
      "confidence": 0.85,
      "quality": 0.7,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "brownie",
        "confidence": 0.95
      },
      {
        "name": "dessert",
        "confidence": 0.8
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "dessert",
      "brownie",
      "chocolate",
      "sweet"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.7
  }
]
Cleaned response for image_id 6e937364-3b24-432b-b9f5-c4281dd528f8:
[
  {
    "image_id": "6e937364-3b24-432b-b9f5-c4281dd528f8",
    "scene": "dish_closeup",
    "visual": {
      "description": "A blue box containing a brownie and a dessert topped with chocolate sauce and whipped cream.",
      "confidence": 0.85,
      "quality": 0.7,
      "appeal_score": 0.75
    },
    "context": {
      "ambiance": "none",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "brownie",
        "confidence": 0.95
      },
      {
        "name": "dessert",
        "confidence": 0.8
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "dessert",
      "brownie",
      "chocolate",
      "sweet"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.7
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user HTTP/1.1" 307 0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user/ HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 6e937364-3b24-432b-b9f5-c4281dd528f8, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Aggregated quality_score: 0.7
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C05D25FC10>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C05CEEA600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C05EF83F90>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:36:51 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: ef9fda15-5e33-4f73-8790-266f657c692e
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.7, reputation_score: 1.4250000000000003, penalty_multiplier: 1.0, initial_reach: 0.42, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:36:51] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Manolo Gelato', 'branchName': 'Packages Mall', 'serviceType': 'takeaway', 'totalBill': 1000.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 0, 'staff': 4, 'willRecommend': 4}, 'averageRating': 3.0, 'userThoughts': 'This place is very very healthy. Although they serve you icecreams butmade fresh with healthy ingredients and very very reasonable. A must visit place.', 'hashtags': ['icecreamdessertsweetcold']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/2...
DEBUG:root:Assigned image_id: 1d986702-990b-4899-bb03-17244ce57099
DEBUG:root:Opening image for image_id: 1d986702-990b-4899-bb03-17244ce57099
DEBUG:root:Image converted to JPEG for image_id: 1d986702-990b-4899-bb03-17244ce57099
DEBUG:root:Sending image to Gemini model for image_id: 1d986702-990b-4899-bb03-17244ce57099
DEBUG:root:Raw Gemini response for image_id 1d986702-990b-4899-bb03-17244ce57099:
{"image_id": "1d986702-990b-4899-bb03-17244ce57099", "scene": "dish_closeup", "visual": {"description": "A close-up shot of various flavors of ice cream displayed in tubs with scoops. The ice cream varieties include green, white, and dark-colored options, some with toppings or swirls.", "confidence": 0.95, "quality": 0.80, "appeal_score": 0.75}, "context": {"ambiance": "none", "lighting": "mixed", "meal_timing": "any"}, "items": [{"name": "ice cream", "confidence": 0.98}], "flag_type": "none", "penalty_score": 0, "keywords": ["ice cream", "dessert", "frozen", "sweet", "flavors", "scoops", "treat"], "ambience_features": [], "thumbnail_rank": 1.0}
Raw response for image_id 1d986702-990b-4899-bb03-17244ce57099:
{"image_id": "1d986702-990b-4899-bb03-17244ce57099", "scene": "dish_closeup", "visual": {"description": "A close-up shot of various flavors of ice cream displayed in tubs with scoops. The ice cream varieties include green, white, and dark-colored options, some with toppings or swirls.", "confidence": 0.95, "quality": 0.80, "appeal_score": 0.75}, "context": {"ambiance": "none", "lighting": "mixed", "meal_timing": "any"}, "items": [{"name": "ice cream", "confidence": 0.98}], "flag_type": "none", "penalty_score": 0, "keywords": ["ice cream", "dessert", "frozen", "sweet", "flavors", "scoops", "treat"], "ambience_features": [], "thumbnail_rank": 1.0}
==================================================
DEBUG:root:Cleaned response for image_id 1d986702-990b-4899-bb03-17244ce57099:
{"image_id": "1d986702-990b-4899-bb03-17244ce57099", "scene": "dish_closeup", "visual": {"description": "A close-up shot of various flavors of ice cream displayed in tubs with scoops. The ice cream varieties include green, white, and dark-colored options, some with toppings or swirls.", "confidence": 0.95, "quality": 0.80, "appeal_score": 0.75}, "context": {"ambiance": "none", "lighting": "mixed", "meal_timing": "any"}, "items": [{"name": "ice cream", "confidence": 0.98}], "flag_type": "none", "penalty_score": 0, "keywords": ["ice cream", "dessert", "frozen", "sweet", "flavors", "scoops", "treat"], "ambience_features": [], "thumbnail_rank": 1.0}
Cleaned response for image_id 1d986702-990b-4899-bb03-17244ce57099:
{"image_id": "1d986702-990b-4899-bb03-17244ce57099", "scene": "dish_closeup", "visual": {"description": "A close-up shot of various flavors of ice cream displayed in tubs with scoops. The ice cream varieties include green, white, and dark-colored options, some with toppings or swirls.", "confidence": 0.95, "quality": 0.80, "appeal_score": 0.75}, "context": {"ambiance": "none", "lighting": "mixed", "meal_timing": "any"}, "items": [{"name": "ice cream", "confidence": 0.98}], "flag_type": "none", "penalty_score": 0, "keywords": ["ice cream", "dessert", "frozen", "sweet", "flavors", "scoops", "treat"], "ambience_features": [], "thumbnail_rank": 1.0}
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 1d986702-990b-4899-bb03-17244ce57099, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Processing image 2/2...
DEBUG:root:Assigned image_id: b514946a-4c2e-4613-92f3-931e8b6b9161
DEBUG:root:Opening image for image_id: b514946a-4c2e-4613-92f3-931e8b6b9161
DEBUG:root:Image converted to JPEG for image_id: b514946a-4c2e-4613-92f3-931e8b6b9161
DEBUG:root:Sending image to Gemini model for image_id: b514946a-4c2e-4613-92f3-931e8b6b9161
DEBUG:root:Raw Gemini response for image_id b514946a-4c2e-4613-92f3-931e8b6b9161:
```json
[
  {
    "image_id": "b514946a-4c2e-4613-92f3-931e8b6b9161",
    "scene": "dish_closeup",
    "visual": {
      "description": "A person is holding a soft-serve ice cream cone. The ice cream is white and swirled. The cone is a waffle cone. There is a bottle of water and other people in the background.",
      "confidence": 0.95,
      "quality": 0.8,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.98
      },
      {
        "name": "soft-serve ice cream",
        "confidence": 0.97
      },
      {
        "name": "waffle cone",
        "confidence": 0.95
      },
      {
        "name": "bottled water",
        "confidence": 0.9
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "dessert",
      "sweet",
      "cold",
      "cone",
      "waffle",
      "frozen",
      "refreshing",
      "treat"
    ],
    "ambience_features": [
      "indoor seating",
      "bright lighting",
      "casual dining"
    ],
    "thumbnail_rank": 1.0
  }
]
```
Raw response for image_id b514946a-4c2e-4613-92f3-931e8b6b9161:
```json
[
  {
    "image_id": "b514946a-4c2e-4613-92f3-931e8b6b9161",
    "scene": "dish_closeup",
    "visual": {
      "description": "A person is holding a soft-serve ice cream cone. The ice cream is white and swirled. The cone is a waffle cone. There is a bottle of water and other people in the background.",
      "confidence": 0.95,
      "quality": 0.8,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.98
      },
      {
        "name": "soft-serve ice cream",
        "confidence": 0.97
      },
      {
        "name": "waffle cone",
        "confidence": 0.95
      },
      {
        "name": "bottled water",
        "confidence": 0.9
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "dessert",
      "sweet",
      "cold",
      "cone",
      "waffle",
      "frozen",
      "refreshing",
      "treat"
    ],
    "ambience_features": [
      "indoor seating",
      "bright lighting",
      "casual dining"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id b514946a-4c2e-4613-92f3-931e8b6b9161:
[
  {
    "image_id": "b514946a-4c2e-4613-92f3-931e8b6b9161",
    "scene": "dish_closeup",
    "visual": {
      "description": "A person is holding a soft-serve ice cream cone. The ice cream is white and swirled. The cone is a waffle cone. There is a bottle of water and other people in the background.",
      "confidence": 0.95,
      "quality": 0.8,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.98
      },
      {
        "name": "soft-serve ice cream",
        "confidence": 0.97
      },
      {
        "name": "waffle cone",
        "confidence": 0.95
      },
      {
        "name": "bottled water",
        "confidence": 0.9
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "dessert",
      "sweet",
      "cold",
      "cone",
      "waffle",
      "frozen",
      "refreshing",
      "treat"
    ],
    "ambience_features": [
      "indoor seating",
      "bright lighting",
      "casual dining"
    ],
    "thumbnail_rank": 1.0
  }
]
Cleaned response for image_id b514946a-4c2e-4613-92f3-931e8b6b9161:
[
  {
    "image_id": "b514946a-4c2e-4613-92f3-931e8b6b9161",
    "scene": "dish_closeup",
    "visual": {
      "description": "A person is holding a soft-serve ice cream cone. The ice cream is white and swirled. The cone is a waffle cone. There is a bottle of water and other people in the background.",
      "confidence": 0.95,
      "quality": 0.8,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "daylight",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "ice cream cone",
        "confidence": 0.98
      },
      {
        "name": "soft-serve ice cream",
        "confidence": 0.97
      },
      {
        "name": "waffle cone",
        "confidence": 0.95
      },
      {
        "name": "bottled water",
        "confidence": 0.9
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "ice cream",
      "dessert",
      "sweet",
      "cold",
      "cone",
      "waffle",
      "frozen",
      "refreshing",
      "treat"
    ],
    "ambience_features": [
      "indoor seating",
      "bright lighting",
      "casual dining"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id b514946a-4c2e-4613-92f3-931e8b6b9161, length: 768
DEBUG:root:Image 2 processed successfully.
DEBUG:root:Aggregated quality_score: 0.8
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C05EF83410>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C05CEEA600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C05EF83490>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:39:16 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: abf72451-dac7-4a14-87e8-64ed65f7bc2d
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.8, reputation_score: 1.4250000000000003, penalty_multiplier: 1.0, initial_reach: 0.48, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:39:17] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Waris Nihari', 'branchName': 'Androon', 'serviceType': 'dineIn', 'totalBill': 1000.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 2, 'staff': 4, 'willRecommend': 4}, 'averageRating': 3.5, 'userThoughts': 'In the heart of Urdu bazaar Lahore. This place is a must try if u r looking for authentic nihari and that too in reasonable price.\r\nTaste is really good.\r\nQuality and quantity is really good\r\nStaff is little slow in response and support\r\nParking is an issue due to limited road width', 'hashtags': ['desiniharinaan']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/2...
DEBUG:root:Assigned image_id: d381fb7a-5f87-4509-95b2-03221538bf85
DEBUG:root:Opening image for image_id: d381fb7a-5f87-4509-95b2-03221538bf85
DEBUG:root:Image converted to JPEG for image_id: d381fb7a-5f87-4509-95b2-03221538bf85
DEBUG:root:Sending image to Gemini model for image_id: d381fb7a-5f87-4509-95b2-03221538bf85
DEBUG:root:Raw Gemini response for image_id d381fb7a-5f87-4509-95b2-03221538bf85:
```json
[
  {
    "image_id": "d381fb7a-5f87-4509-95b2-03221538bf85",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of Pakistani food, featuring a fluffy naan bread stacked on a plate, and a bowl of rich, red curry with tender meat pieces. A small dish of shredded vegetables is also visible on the side. The lighting is dim, suggesting an evening setting.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "warm",
      "meal_timing": "dinner"
    },
    "items": [
      {
        "name": "naan",
        "confidence": 0.98
      },
      {
        "name": "nihari",
        "confidence": 0.92
      },
      {
        "name": "salad",
        "confidence": 0.75
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "naan",
      "nihari",
      "curry",
      "meat",
      "pakistani food",
      "traditional",
      "dinner",
      "outdoor dining",
      "cuisine"
    ],
    "ambience_features": [
      "dim lighting",
      "table setting",
      "outdoor"
    ],
    "thumbnail_rank": 1.0
  }
]
```
Raw response for image_id d381fb7a-5f87-4509-95b2-03221538bf85:
```json
[
  {
    "image_id": "d381fb7a-5f87-4509-95b2-03221538bf85",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of Pakistani food, featuring a fluffy naan bread stacked on a plate, and a bowl of rich, red curry with tender meat pieces. A small dish of shredded vegetables is also visible on the side. The lighting is dim, suggesting an evening setting.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "warm",
      "meal_timing": "dinner"
    },
    "items": [
      {
        "name": "naan",
        "confidence": 0.98
      },
      {
        "name": "nihari",
        "confidence": 0.92
      },
      {
        "name": "salad",
        "confidence": 0.75
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "naan",
      "nihari",
      "curry",
      "meat",
      "pakistani food",
      "traditional",
      "dinner",
      "outdoor dining",
      "cuisine"
    ],
    "ambience_features": [
      "dim lighting",
      "table setting",
      "outdoor"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id d381fb7a-5f87-4509-95b2-03221538bf85:
[
  {
    "image_id": "d381fb7a-5f87-4509-95b2-03221538bf85",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of Pakistani food, featuring a fluffy naan bread stacked on a plate, and a bowl of rich, red curry with tender meat pieces. A small dish of shredded vegetables is also visible on the side. The lighting is dim, suggesting an evening setting.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "warm",
      "meal_timing": "dinner"
    },
    "items": [
      {
        "name": "naan",
        "confidence": 0.98
      },
      {
        "name": "nihari",
        "confidence": 0.92
      },
      {
        "name": "salad",
        "confidence": 0.75
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "naan",
      "nihari",
      "curry",
      "meat",
      "pakistani food",
      "traditional",
      "dinner",
      "outdoor dining",
      "cuisine"
    ],
    "ambience_features": [
      "dim lighting",
      "table setting",
      "outdoor"
    ],
    "thumbnail_rank": 1.0
  }
]
Cleaned response for image_id d381fb7a-5f87-4509-95b2-03221538bf85:
[
  {
    "image_id": "d381fb7a-5f87-4509-95b2-03221538bf85",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of Pakistani food, featuring a fluffy naan bread stacked on a plate, and a bowl of rich, red curry with tender meat pieces. A small dish of shredded vegetables is also visible on the side. The lighting is dim, suggesting an evening setting.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "outdoor",
      "lighting": "warm",
      "meal_timing": "dinner"
    },
    "items": [
      {
        "name": "naan",
        "confidence": 0.98
      },
      {
        "name": "nihari",
        "confidence": 0.92
      },
      {
        "name": "salad",
        "confidence": 0.75
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "naan",
      "nihari",
      "curry",
      "meat",
      "pakistani food",
      "traditional",
      "dinner",
      "outdoor dining",
      "cuisine"
    ],
    "ambience_features": [
      "dim lighting",
      "table setting",
      "outdoor"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id d381fb7a-5f87-4509-95b2-03221538bf85, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Processing image 2/2...
DEBUG:root:Assigned image_id: febc5b92-a2ca-4c1d-a3d1-fed34c19ff38
DEBUG:root:Opening image for image_id: febc5b92-a2ca-4c1d-a3d1-fed34c19ff38
DEBUG:root:Image converted to JPEG for image_id: febc5b92-a2ca-4c1d-a3d1-fed34c19ff38
DEBUG:root:Sending image to Gemini model for image_id: febc5b92-a2ca-4c1d-a3d1-fed34c19ff38
DEBUG:root:Raw Gemini response for image_id febc5b92-a2ca-4c1d-a3d1-fed34c19ff38:
```json
[
  {
    "image_id": "febc5b92-a2ca-4c1d-a3d1-fed34c19ff38",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a stack of Pakistani flatbreads, possibly parathas or rotis, resting on a large metal pot. In the background, a young man in a light brown shirt and green hair covering sits, and another man is visible on the right, looking at his phone. The overall lighting is dim and warm, suggesting an indoor setting.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "paratha",
        "confidence": 0.8
      },
      {
        "name": "roti",
        "confidence": 0.7
      },
      {
        "name": "naan",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "flatbread",
      "paratha",
      "roti",
      "naan",
      "restaurant",
      "food stall",
      "man",
      "mobile phone"
    ],
    "ambience_features": [
      "dim lighting",
      "warm lighting",
      "indoor seating"
    ],
    "thumbnail_rank": 1.0
  }
]
```
Raw response for image_id febc5b92-a2ca-4c1d-a3d1-fed34c19ff38:
```json
[
  {
    "image_id": "febc5b92-a2ca-4c1d-a3d1-fed34c19ff38",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a stack of Pakistani flatbreads, possibly parathas or rotis, resting on a large metal pot. In the background, a young man in a light brown shirt and green hair covering sits, and another man is visible on the right, looking at his phone. The overall lighting is dim and warm, suggesting an indoor setting.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "paratha",
        "confidence": 0.8
      },
      {
        "name": "roti",
        "confidence": 0.7
      },
      {
        "name": "naan",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "flatbread",
      "paratha",
      "roti",
      "naan",
      "restaurant",
      "food stall",
      "man",
      "mobile phone"
    ],
    "ambience_features": [
      "dim lighting",
      "warm lighting",
      "indoor seating"
    ],
    "thumbnail_rank": 1.0
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id febc5b92-a2ca-4c1d-a3d1-fed34c19ff38:
[
  {
    "image_id": "febc5b92-a2ca-4c1d-a3d1-fed34c19ff38",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a stack of Pakistani flatbreads, possibly parathas or rotis, resting on a large metal pot. In the background, a young man in a light brown shirt and green hair covering sits, and another man is visible on the right, looking at his phone. The overall lighting is dim and warm, suggesting an indoor setting.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "paratha",
        "confidence": 0.8
      },
      {
        "name": "roti",
        "confidence": 0.7
      },
      {
        "name": "naan",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "flatbread",
      "paratha",
      "roti",
      "naan",
      "restaurant",
      "food stall",
      "man",
      "mobile phone"
    ],
    "ambience_features": [
      "dim lighting",
      "warm lighting",
      "indoor seating"
    ],
    "thumbnail_rank": 1.0
  }
]
Cleaned response for image_id febc5b92-a2ca-4c1d-a3d1-fed34c19ff38:
[
  {
    "image_id": "febc5b92-a2ca-4c1d-a3d1-fed34c19ff38",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of a stack of Pakistani flatbreads, possibly parathas or rotis, resting on a large metal pot. In the background, a young man in a light brown shirt and green hair covering sits, and another man is visible on the right, looking at his phone. The overall lighting is dim and warm, suggesting an indoor setting.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.6
    },
    "context": {
      "ambiance": "indoor",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "paratha",
        "confidence": 0.8
      },
      {
        "name": "roti",
        "confidence": 0.7
      },
      {
        "name": "naan",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakistani food",
      "flatbread",
      "paratha",
      "roti",
      "naan",
      "restaurant",
      "food stall",
      "man",
      "mobile phone"
    ],
    "ambience_features": [
      "dim lighting",
      "warm lighting",
      "indoor seating"
    ],
    "thumbnail_rank": 1.0
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id febc5b92-a2ca-4c1d-a3d1-fed34c19ff38, length: 768
DEBUG:root:Image 2 processed successfully.
DEBUG:root:Aggregated quality_score: 0.7
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C05F0AF310>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C05CEEA600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C05F0AEE10>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:43:15 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: 98a39680-2be0-4b6b-88f2-c2ed0e7f1237
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.7, reputation_score: 1.6250000000000002, penalty_multiplier: 1.0, initial_reach: 0.42, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:43:16] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: ice cream, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'ice cream'
DEBUG:root:Expanded synonyms for keywords ['ice', 'cream']: []
DEBUG:root:Keywords: ['ice', 'cream'], Synonyms: []
DEBUG:root:Generating text embedding for query 'ice cream' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'ice cream', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C05EDDA4D0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C05CEEA600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C05EF4E150>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:46:04 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 6 text-to-image search results from Qdrant.
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:46:05 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 6 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:46:06 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 0 keyword search results.
DEBUG:root:Combined 6 unique results from text-to-image and text-to-text searches.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.122557785 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09994338350000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.25
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.14814366175 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.16666666666666666
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1237010243 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.125
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12975005350000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10943454066666668 (threshold: 0.2)
DEBUG:root:Search completed, returning 0 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:46:07] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: dessert, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'dessert'
DEBUG:root:Expanded synonyms for keywords ['dessert']: []
DEBUG:root:Keywords: ['dessert'], Synonyms: []
DEBUG:root:Generating text embedding for query 'dessert' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'dessert', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C05F0B7E50>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C05CEEA600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C05F0B40D0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:46:32 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 6 text-to-image search results from Qdrant.
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:46:35 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 6 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:46:37 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 2 keyword search results.
DEBUG:root:Combined 6 unique results from text-to-image and text-to-text searches.
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.44923140599999994, keyword_score: 1.0, semantic_score: 0.030925624, quality_score: 0.06999999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.7
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.46525929149999995, keyword_score: 1.0, semantic_score: 0.027037166, quality_score: 0.08, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.25
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1476035145 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.125
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12962910025000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.16666666666666666
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1219676830365 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10873774261666667 (threshold: 0.2)
DEBUG:root:Search completed, returning 2 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:46:39] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: ice-cream, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'ice-cream'
DEBUG:root:Expanded synonyms for keywords ['ice', 'cream']: []
DEBUG:root:Keywords: ['ice', 'cream'], Synonyms: []
DEBUG:root:Generating text embedding for query 'ice-cream' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'ice-cream', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C05F0A4DD0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C05CEEA600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C05F0A4510>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:46:52 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 6 text-to-image search results from Qdrant.
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:47:01 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 6 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:47:03 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 0 keyword search results.
DEBUG:root:Combined 6 unique results from text-to-image and text-to-text searches.
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12145192750000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.09990256375 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.25
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.14892247274999998 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.16666666666666666
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12425953561000001 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.125
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.13013565675 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11028417766666668 (threshold: 0.2)
DEBUG:root:Search completed, returning 0 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:47:05] "POST /search HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: brownie, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'brownie'
DEBUG:root:Expanded synonyms for keywords ['brownie']: []
DEBUG:root:Keywords: ['brownie'], Synonyms: []
DEBUG:root:Generating text embedding for query 'brownie' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'brownie', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C05F0B5AD0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C05CEEA600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C05F0B6E90>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:47:17 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 6 text-to-image search results from Qdrant.
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:47:20 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 6 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:47:22 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 1 keyword search results.
DEBUG:root:Combined 6 unique results from text-to-image and text-to-text searches.
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.45445232124999996, keyword_score: 1.0, semantic_score: 0.051809285, quality_score: 0.06999999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.7
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11429082875 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.25
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.14854919425000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11093509666666668 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.125
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.13013272250000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.16666666666666666
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12174521821 (threshold: 0.2)
DEBUG:root:Search completed, returning 1 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:47:23] "POST /search HTTP/1.1" 200 -
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000017EDF0509D0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x0000017EDED8A600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000017EDEF24850>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:52:07 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C130CA6150>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C1309EA600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C11871D2D0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:52:12 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 105-820-945
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:52:23] "[33mGET /favicon.ico HTTP/1.1[0m" 404 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:52:35] "GET / HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:52:38] "GET / HTTP/1.1" 200 -
DEBUG:root:Review data prepared: {'restaurantName': 'Karachi Darbar', 'branchName': 'DHA Branch', 'serviceType': 'dineIn', 'totalBill': 1500.0, 'rateUserExperience': {'foodTaste': 4, 'ambience': 4, 'staff': 3, 'willRecommend': 4}, 'averageRating': 3.75, 'userThoughts': 'Amazing chicken karahi with perfect spice level!', 'hashtags': ['karahi', 'spicy', 'family']}
DEBUG:root:Starting analyze_review...
DEBUG:root:Processing image 1/3...
DEBUG:root:Assigned image_id: 74cc6fcc-5a4b-4d2a-8203-59a468dfefd1
DEBUG:root:Opening image for image_id: 74cc6fcc-5a4b-4d2a-8203-59a468dfefd1
DEBUG:PIL.Image:Importing BlpImagePlugin
DEBUG:PIL.Image:Importing BmpImagePlugin
DEBUG:PIL.Image:Importing BufrStubImagePlugin
DEBUG:PIL.Image:Importing CurImagePlugin
DEBUG:PIL.Image:Importing DcxImagePlugin
DEBUG:PIL.Image:Importing DdsImagePlugin
DEBUG:PIL.Image:Importing EpsImagePlugin
DEBUG:PIL.Image:Importing FitsImagePlugin
DEBUG:PIL.Image:Importing FliImagePlugin
DEBUG:PIL.Image:Importing FpxImagePlugin
DEBUG:PIL.Image:Image: failed to import FpxImagePlugin: No module named 'olefile'
DEBUG:PIL.Image:Importing FtexImagePlugin
DEBUG:PIL.Image:Importing GbrImagePlugin
DEBUG:PIL.Image:Importing GifImagePlugin
DEBUG:PIL.Image:Importing GribStubImagePlugin
DEBUG:PIL.Image:Importing Hdf5StubImagePlugin
DEBUG:PIL.Image:Importing IcnsImagePlugin
DEBUG:PIL.Image:Importing IcoImagePlugin
DEBUG:PIL.Image:Importing ImImagePlugin
DEBUG:PIL.Image:Importing ImtImagePlugin
DEBUG:PIL.Image:Importing IptcImagePlugin
DEBUG:PIL.Image:Importing JpegImagePlugin
DEBUG:PIL.Image:Importing Jpeg2KImagePlugin
DEBUG:PIL.Image:Importing McIdasImagePlugin
DEBUG:PIL.Image:Importing MicImagePlugin
DEBUG:PIL.Image:Image: failed to import MicImagePlugin: No module named 'olefile'
DEBUG:PIL.Image:Importing MpegImagePlugin
DEBUG:PIL.Image:Importing MpoImagePlugin
DEBUG:PIL.Image:Importing MspImagePlugin
DEBUG:PIL.Image:Importing PalmImagePlugin
DEBUG:PIL.Image:Importing PcdImagePlugin
DEBUG:PIL.Image:Importing PcxImagePlugin
DEBUG:PIL.Image:Importing PdfImagePlugin
DEBUG:PIL.Image:Importing PixarImagePlugin
DEBUG:PIL.Image:Importing PngImagePlugin
DEBUG:PIL.Image:Importing PpmImagePlugin
DEBUG:PIL.Image:Importing PsdImagePlugin
DEBUG:PIL.Image:Importing QoiImagePlugin
DEBUG:PIL.Image:Importing SgiImagePlugin
DEBUG:PIL.Image:Importing SpiderImagePlugin
DEBUG:PIL.Image:Importing SunImagePlugin
DEBUG:PIL.Image:Importing TgaImagePlugin
DEBUG:PIL.Image:Importing TiffImagePlugin
DEBUG:PIL.Image:Importing WebPImagePlugin
DEBUG:PIL.Image:Importing WmfImagePlugin
DEBUG:PIL.Image:Importing XbmImagePlugin
DEBUG:PIL.Image:Importing XpmImagePlugin
DEBUG:PIL.Image:Importing XVThumbImagePlugin
DEBUG:root:Image converted to JPEG for image_id: 74cc6fcc-5a4b-4d2a-8203-59a468dfefd1
DEBUG:root:Sending image to Gemini model for image_id: 74cc6fcc-5a4b-4d2a-8203-59a468dfefd1
DEBUG:root:Raw Gemini response for image_id 74cc6fcc-5a4b-4d2a-8203-59a468dfefd1:
```json
[
  {
    "image_id": "74cc6fcc-5a4b-4d2a-8203-59a468dfefd1",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a traditional Pakistani curry being stirred in a large, ornate pot. The curry appears to be a rich, yellowish-brown color, with visible spices and a slightly oily sheen. The pot itself is made of copper or brass, with intricate embossed patterns and a rustic, well-used appearance.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.9
      },
      {
        "name": "nihari",
        "confidence": 0.7
      },
      {
        "name": "haleem",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "pakistani food",
      "traditional",
      "pot",
      "copper",
      "spices",
      "rich",
      "savory",
      "authentic"
    ],
    "ambience_features": [
      "traditional pot",
      "warm lighting"
    ],
    "thumbnail_rank": 0.85
  }
]
```
Raw response for image_id 74cc6fcc-5a4b-4d2a-8203-59a468dfefd1:
```json
[
  {
    "image_id": "74cc6fcc-5a4b-4d2a-8203-59a468dfefd1",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a traditional Pakistani curry being stirred in a large, ornate pot. The curry appears to be a rich, yellowish-brown color, with visible spices and a slightly oily sheen. The pot itself is made of copper or brass, with intricate embossed patterns and a rustic, well-used appearance.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.9
      },
      {
        "name": "nihari",
        "confidence": 0.7
      },
      {
        "name": "haleem",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "pakistani food",
      "traditional",
      "pot",
      "copper",
      "spices",
      "rich",
      "savory",
      "authentic"
    ],
    "ambience_features": [
      "traditional pot",
      "warm lighting"
    ],
    "thumbnail_rank": 0.85
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 74cc6fcc-5a4b-4d2a-8203-59a468dfefd1:
[
  {
    "image_id": "74cc6fcc-5a4b-4d2a-8203-59a468dfefd1",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a traditional Pakistani curry being stirred in a large, ornate pot. The curry appears to be a rich, yellowish-brown color, with visible spices and a slightly oily sheen. The pot itself is made of copper or brass, with intricate embossed patterns and a rustic, well-used appearance.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.9
      },
      {
        "name": "nihari",
        "confidence": 0.7
      },
      {
        "name": "haleem",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "pakistani food",
      "traditional",
      "pot",
      "copper",
      "spices",
      "rich",
      "savory",
      "authentic"
    ],
    "ambience_features": [
      "traditional pot",
      "warm lighting"
    ],
    "thumbnail_rank": 0.85
  }
]
Cleaned response for image_id 74cc6fcc-5a4b-4d2a-8203-59a468dfefd1:
[
  {
    "image_id": "74cc6fcc-5a4b-4d2a-8203-59a468dfefd1",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up shot of a traditional Pakistani curry being stirred in a large, ornate pot. The curry appears to be a rich, yellowish-brown color, with visible spices and a slightly oily sheen. The pot itself is made of copper or brass, with intricate embossed patterns and a rustic, well-used appearance.",
      "confidence": 0.95,
      "quality": 0.7,
      "appeal_score": 0.8
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "curry",
        "confidence": 0.9
      },
      {
        "name": "nihari",
        "confidence": 0.7
      },
      {
        "name": "haleem",
        "confidence": 0.6
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "curry",
      "pakistani food",
      "traditional",
      "pot",
      "copper",
      "spices",
      "rich",
      "savory",
      "authentic"
    ],
    "ambience_features": [
      "traditional pot",
      "warm lighting"
    ],
    "thumbnail_rank": 0.85
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user HTTP/1.1" 307 0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user/ HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 74cc6fcc-5a4b-4d2a-8203-59a468dfefd1, length: 768
DEBUG:root:Image 1 processed successfully.
DEBUG:root:Processing image 2/3...
DEBUG:root:Assigned image_id: 1d5adf82-a205-4fb4-9c00-617e7d11163b
DEBUG:root:Opening image for image_id: 1d5adf82-a205-4fb4-9c00-617e7d11163b
DEBUG:root:Image converted to JPEG for image_id: 1d5adf82-a205-4fb4-9c00-617e7d11163b
DEBUG:root:Sending image to Gemini model for image_id: 1d5adf82-a205-4fb4-9c00-617e7d11163b
DEBUG:root:Raw Gemini response for image_id 1d5adf82-a205-4fb4-9c00-617e7d11163b:
```json
[
  {
    "image_id": "1d5adf82-a205-4fb4-9c00-617e7d11163b",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of several fried pakoras being prepared on a flat griddle, with a large wok of hot oil in the background where more pakoras are being fried.",
      "confidence": 0.95,
      "quality": 0.6,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "mixed",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.98
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakora",
      "fried",
      "snacks",
      "street food",
      "griddle",
      "wok",
      "oil",
      "cooking",
      "preparation"
    ],
    "ambience_features": [
      "cooking",
      "street food"
    ],
    "thumbnail_rank": 0.75
  }
]
```
Raw response for image_id 1d5adf82-a205-4fb4-9c00-617e7d11163b:
```json
[
  {
    "image_id": "1d5adf82-a205-4fb4-9c00-617e7d11163b",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of several fried pakoras being prepared on a flat griddle, with a large wok of hot oil in the background where more pakoras are being fried.",
      "confidence": 0.95,
      "quality": 0.6,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "mixed",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.98
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakora",
      "fried",
      "snacks",
      "street food",
      "griddle",
      "wok",
      "oil",
      "cooking",
      "preparation"
    ],
    "ambience_features": [
      "cooking",
      "street food"
    ],
    "thumbnail_rank": 0.75
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 1d5adf82-a205-4fb4-9c00-617e7d11163b:
[
  {
    "image_id": "1d5adf82-a205-4fb4-9c00-617e7d11163b",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of several fried pakoras being prepared on a flat griddle, with a large wok of hot oil in the background where more pakoras are being fried.",
      "confidence": 0.95,
      "quality": 0.6,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "mixed",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.98
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakora",
      "fried",
      "snacks",
      "street food",
      "griddle",
      "wok",
      "oil",
      "cooking",
      "preparation"
    ],
    "ambience_features": [
      "cooking",
      "street food"
    ],
    "thumbnail_rank": 0.75
  }
]
Cleaned response for image_id 1d5adf82-a205-4fb4-9c00-617e7d11163b:
[
  {
    "image_id": "1d5adf82-a205-4fb4-9c00-617e7d11163b",
    "scene": "dish_closeup",
    "visual": {
      "description": "A close-up of several fried pakoras being prepared on a flat griddle, with a large wok of hot oil in the background where more pakoras are being fried.",
      "confidence": 0.95,
      "quality": 0.6,
      "appeal_score": 0.7
    },
    "context": {
      "ambiance": "mixed",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "pakora",
        "confidence": 0.98
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "pakora",
      "fried",
      "snacks",
      "street food",
      "griddle",
      "wok",
      "oil",
      "cooking",
      "preparation"
    ],
    "ambience_features": [
      "cooking",
      "street food"
    ],
    "thumbnail_rank": 0.75
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 1d5adf82-a205-4fb4-9c00-617e7d11163b, length: 768
DEBUG:root:Image 2 processed successfully.
DEBUG:root:Processing image 3/3...
DEBUG:root:Assigned image_id: 4307360d-b7f7-46b9-a873-4bfe21f52a48
DEBUG:root:Opening image for image_id: 4307360d-b7f7-46b9-a873-4bfe21f52a48
DEBUG:root:Image converted to JPEG for image_id: 4307360d-b7f7-46b9-a873-4bfe21f52a48
DEBUG:root:Sending image to Gemini model for image_id: 4307360d-b7f7-46b9-a873-4bfe21f52a48
DEBUG:root:Raw Gemini response for image_id 4307360d-b7f7-46b9-a873-4bfe21f52a48:
```json
[
  {
    "image_id": "4307360d-b7f7-46b9-a873-4bfe21f52a48",
    "scene": "dish_closeup",
    "visual": {
      "description": "A plate with a large puri and two small portions of what appears to be a meat curry and a sweet dish.",
      "confidence": 0.8,
      "quality": 0.4,
      "appeal_score": 0.5
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.9
      },
      {
        "name": "meat curry",
        "confidence": 0.6
      },
      {
        "name": "sweet dish",
        "confidence": 0.5
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "curry",
      "sweet",
      "Pakistani food"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.85
  }
]
```
Raw response for image_id 4307360d-b7f7-46b9-a873-4bfe21f52a48:
```json
[
  {
    "image_id": "4307360d-b7f7-46b9-a873-4bfe21f52a48",
    "scene": "dish_closeup",
    "visual": {
      "description": "A plate with a large puri and two small portions of what appears to be a meat curry and a sweet dish.",
      "confidence": 0.8,
      "quality": 0.4,
      "appeal_score": 0.5
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.9
      },
      {
        "name": "meat curry",
        "confidence": 0.6
      },
      {
        "name": "sweet dish",
        "confidence": 0.5
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "curry",
      "sweet",
      "Pakistani food"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.85
  }
]
```
==================================================
DEBUG:root:Cleaned response for image_id 4307360d-b7f7-46b9-a873-4bfe21f52a48:
[
  {
    "image_id": "4307360d-b7f7-46b9-a873-4bfe21f52a48",
    "scene": "dish_closeup",
    "visual": {
      "description": "A plate with a large puri and two small portions of what appears to be a meat curry and a sweet dish.",
      "confidence": 0.8,
      "quality": 0.4,
      "appeal_score": 0.5
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.9
      },
      {
        "name": "meat curry",
        "confidence": 0.6
      },
      {
        "name": "sweet dish",
        "confidence": 0.5
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "curry",
      "sweet",
      "Pakistani food"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.85
  }
]
Cleaned response for image_id 4307360d-b7f7-46b9-a873-4bfe21f52a48:
[
  {
    "image_id": "4307360d-b7f7-46b9-a873-4bfe21f52a48",
    "scene": "dish_closeup",
    "visual": {
      "description": "A plate with a large puri and two small portions of what appears to be a meat curry and a sweet dish.",
      "confidence": 0.8,
      "quality": 0.4,
      "appeal_score": 0.5
    },
    "context": {
      "ambiance": "unknown",
      "lighting": "warm",
      "meal_timing": "any"
    },
    "items": [
      {
        "name": "puri",
        "confidence": 0.9
      },
      {
        "name": "meat curry",
        "confidence": 0.6
      },
      {
        "name": "sweet dish",
        "confidence": 0.5
      }
    ],
    "flag_type": "none",
    "penalty_score": 0,
    "keywords": [
      "puri",
      "curry",
      "sweet",
      "Pakistani food"
    ],
    "ambience_features": [],
    "thumbnail_rank": 0.85
  }
]
==================================================
DEBUG:root:Generating image embedding with nomic-embed-vision-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/image HTTP/1.1" 200 None
DEBUG:root:Generated image embedding, length: 768
DEBUG:root:Embedding assigned for image_id 4307360d-b7f7-46b9-a873-4bfe21f52a48, length: 768
DEBUG:root:Image 3 processed successfully.
DEBUG:root:Aggregated quality_score: 0.5666666666666665
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C132BDA6D0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C1309EA600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C132BD8CD0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:53:09 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: PUT https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points?wait=true "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'PUT']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Stored review in Qdrant with point_id: 52d47bf3-4fb8-40dc-826b-0ea142175c91
DEBUG:root:Calculating reach...
DEBUG:root:Reach calculation - quality_score: 0.5666666666666665, reputation_score: 1.725, penalty_multiplier: 1.0, initial_reach: 0.3399999999999999, reach_level: Search-only (no feed distribution)
DEBUG:root:Reach calculation completed.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:53:10] "POST /process_review HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: tacos, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'tacos'
DEBUG:root:Expanded synonyms for keywords ['tacos']: []
DEBUG:root:Keywords: ['tacos'], Synonyms: []
DEBUG:root:Generating text embedding for query 'tacos' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'tacos', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C132BCC310>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C1309EA600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001C132BCDDD0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:53:33 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 7 text-to-image search results from Qdrant.
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:53:34 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 7 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:53:35 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 1 keyword search results.
DEBUG:root:Combined 7 unique results from text-to-image and text-to-text searches.
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.46671611341666663, keyword_score: 1.0, semantic_score: 0.034997787, quality_score: 0.08566666666666668, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.9666666666666667
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.098006972 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11340965825 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.25
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.14709780575 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.16666666666666666
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12265689891666667 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.125
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12810378160000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.16666666666666666
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12102064283750001 (threshold: 0.2)
DEBUG:root:Search completed, returning 1 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:53:35] "POST /search HTTP/1.1" 200 -
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EA6ECC5D10>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001EA6EB0A600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001EA569CCFD0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:54:53 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000229FFB46110>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000229FF98A600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000229FE9D3D10>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:54:58 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 105-820-945
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:55:13] "GET / HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:55:13] "GET / HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: tacos, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'tacos'
DEBUG:root:Expanded synonyms for keywords ['tacos']: []
DEBUG:root:Keywords: ['tacos'], Synonyms: []
DEBUG:root:Generating text embedding for query 'tacos' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user HTTP/1.1" 307 0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user/ HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'tacos', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000229857ADBD0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000229FF98A600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000022986764350>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:55:21 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 7 text-to-image search results from Qdrant.
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:55:23 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 7 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:55:25 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 1 keyword search results.
DEBUG:root:Combined 7 unique results from text-to-image and text-to-text searches.
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.46671611341666663, keyword_score: 1.0, semantic_score: 0.034997787, quality_score: 0.08566666666666668, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.9666666666666667
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.098006972 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.11340965825 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.25
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.14709780575 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.16666666666666666
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12265689891666667 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.125
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12810378160000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.16666666666666666
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12102064283750001 (threshold: 0.2)
DEBUG:root:Search completed, returning 1 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:55:26] "POST /search HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:55:26] "[33mGET /default_image.png HTTP/1.1[0m" 404 -
DEBUG:root:Search initiated with query: dessert, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'dessert'
DEBUG:root:Expanded synonyms for keywords ['dessert']: []
DEBUG:root:Keywords: ['dessert'], Synonyms: []
DEBUG:root:Generating text embedding for query 'dessert' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'dessert', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000229FFD04D50>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x00000229FF98A600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000229FFD07510>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:56:46 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 7 text-to-image search results from Qdrant.
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:56:49 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 7 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:56:51 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 2 keyword search results.
DEBUG:root:Combined 7 unique results from text-to-image and text-to-text searches.
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.44923140599999994, keyword_score: 1.0, semantic_score: 0.030925624, quality_score: 0.06999999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.7
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.46525929149999995, keyword_score: 1.0, semantic_score: 0.027037166, quality_score: 0.08, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.16666666666666666
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12393765916666666 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.25
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1476035145 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.125
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12962910025000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.16666666666666666
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1219676830365 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10873774261666667 (threshold: 0.2)
DEBUG:root:Search completed, returning 2 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:56:54] "POST /search HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:56:54] "[33mGET /default_image.png HTTP/1.1[0m" 404 -
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000270687392D0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000002706845A600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000027068637390>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:58:19 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001A51DB90790>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001A51D8BA600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001A51DC21910>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:58:24 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 105-820-945
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:58:46] "GET / HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: dessert, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'dessert'
DEBUG:root:Expanded synonyms for keywords ['dessert']: []
DEBUG:root:Keywords: ['dessert'], Synonyms: []
DEBUG:root:Generating text embedding for query 'dessert' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user HTTP/1.1" 307 0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user/ HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'dessert', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001A51F7BB050>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001A51D8BA600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001A51F7A83D0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:58:56 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 7 text-to-image search results from Qdrant.
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:58:57 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 7 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 10:58:58 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 2 keyword search results.
DEBUG:root:Combined 7 unique results from text-to-image and text-to-text searches.
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.44923140599999994, keyword_score: 1.0, semantic_score: 0.030925624, quality_score: 0.06999999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.7
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.46525929149999995, keyword_score: 1.0, semantic_score: 0.027037166, quality_score: 0.08, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.16666666666666666
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12393765916666666 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.25
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1476035145 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.125
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12962910025000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.16666666666666666
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1219676830365 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10873774261666667 (threshold: 0.2)
DEBUG:root:Search completed, returning 2 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 14:58:58] "POST /search HTTP/1.1" 200 -
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001D1C2259410>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001D1C1F9A600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001D1C0021510>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 11:00:16 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
INFO:werkzeug: * Restarting with watchdog (windowsapi)
DEBUG:root:Initializing KhapeyMVP...
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001CDF0FB1910>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001CDF123A600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001CDF1500C90>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 11:00:22 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: GET https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'GET']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Qdrant collection 'khapey_reviews' already exists. Skipping creation.
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 105-820-945
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 15:00:39] "GET / HTTP/1.1" 200 -
DEBUG:root:Search initiated with query: dessert, user_profile: {'cuisineWeights': {'Pakistani': 0.5, 'Italian': 0.3, 'Chinese': 0.2}, 'qualityExpectation': 7.0}
DEBUG:root:Starting unified search with query 'dessert'
DEBUG:root:Expanded synonyms for keywords ['dessert']: []
DEBUG:root:Keywords: ['dessert'], Synonyms: []
DEBUG:root:Generating text embedding for query 'dessert' with nomic-embed-text-v1...
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user HTTP/1.1" 307 0
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "GET /v1/user/ HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api-atlas.nomic.ai:443
DEBUG:urllib3.connectionpool:https://api-atlas.nomic.ai:443 "POST /v1/embedding/text HTTP/1.1" 200 None
DEBUG:root:Generated text embedding for query 'dessert', length: 768
DEBUG:root:Performing text-to-image search using image embeddings.
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' port=6333 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001CDF15B6D10>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x000001CDF123A600> server_hostname='35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001CDF3147CD0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 11:00:48 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 7 text-to-image search results from Qdrant.
DEBUG:root:Performing text-to-text search.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 11:00:49 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/search "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 7 semantic search results from Qdrant.
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Encoding', b'gzip'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 06 Aug 2025 11:00:50 GMT'), (b'Vary', b'accept-encoding, Origin, Access-Control-Request-Method, Access-Control-Request-Headers'), (b'Transfer-Encoding', b'chunked')])
INFO:httpx:HTTP Request: POST https://35f22026-33fa-458c-b77f-9ac268313032.eu-central-1-0.aws.cloud.qdrant.io:6333/collections/khapey_reviews/points/scroll "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:root:Retrieved 2 keyword search results.
DEBUG:root:Combined 7 unique results from text-to-image and text-to-text searches.
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.44923140599999994, keyword_score: 1.0, semantic_score: 0.030925624, quality_score: 0.06999999999999999, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 0.7
DEBUG:root:Keyword score calculation - matches: 1, score: 1.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Ranked result - relevance: 0.46525929149999995, keyword_score: 1.0, semantic_score: 0.027037166, quality_score: 0.08, personal_score: 0.0, geo_score: 0.85, thumbnail_rank: 1.0
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.16666666666666666
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12393765916666666 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.25
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1476035145 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.125
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.12962910025000002 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.5, quality_score: 0.0, final_score: 0.16666666666666666
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.1219676830365 (threshold: 0.2)
DEBUG:root:Keyword score calculation - matches: 0, score: 0.0
DEBUG:root:Personal score - cuisine_score: 0.0, quality_score: 0.0, final_score: 0.0
DEBUG:root:Geo score - distance_km: 5.0, score: 0.85
DEBUG:root:Filtered out result with low relevance: 0.10873774261666667 (threshold: 0.2)
DEBUG:root:Search completed, returning 2 results after relevancy filtering.
INFO:werkzeug:127.0.0.1 - - [06/Aug/2025 15:00:50] "POST /search HTTP/1.1" 200 -
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
